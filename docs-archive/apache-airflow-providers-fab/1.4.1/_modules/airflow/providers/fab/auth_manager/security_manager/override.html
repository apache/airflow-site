



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
    <html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
        <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>airflow.providers.fab.auth_manager.security_manager.override &mdash; apache-airflow-providers-fab Documentation</title>
    <link rel="stylesheet" href="../../../../../../_static/_gen/css/main.min.css" type="text/css" />
            <link rel="stylesheet" type="text/css" href="../../../../../../_static/pygments.css" />
            <link rel="stylesheet" type="text/css" href="../../../../../../_static/_gen/css/main.min.css" />
            <link rel="stylesheet" type="text/css" href="../../../../../../_static/copybutton.css" />
            <link rel="stylesheet" type="text/css" href="../../../../../../_static/_gen/css/main-custom.min.css" />
            <link rel="stylesheet" type="text/css" href="../../../../../../_static/graphviz.css" />
            <link rel="stylesheet" type="text/css" href="../../../../../../_static/sphinx-design.5ea377869091fd0449014c60fc090103.min.css" />
            <link rel="stylesheet" type="text/css" href="../../../../../../_static/custom.css" />
            <link rel="shortcut icon" href="../../../../../../_static/pin_32.png"/>
            <link rel="index" title="Index" href="../../../../../../genindex.html" />
            <link rel="search" title="Search" href="../../../../../../search.html" />

    <link rel="canonical" href="https://airflow.apache.org/docs/apache-airflow-providers-fab/stable/_modules/airflow/providers/fab/auth_manager/security_manager/override.html" />

    <!-- Matomo -->
    <script>
        var _paq = window._paq = window._paq || [];
        /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
        /* We explicitly disable cookie tracking to avoid privacy issues */
        _paq.push(['disableCookies']);
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
        var u="https://analytics.apache.org/";
        _paq.push(['setTrackerUrl', u+'matomo.php']);
        _paq.push(['setSiteId', '13']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
        })();
    </script>
    <!-- End Matomo Code -->

    
</head><body class="td-section">
    

<header>
    <nav class="js-navbar-scroll navbar">
        <div class="navbar__icon-container">
            <a href="/">
                <svg xmlns="http://www.w3.org/2000/svg" width="155.314" height="60" viewBox="0 0 155.314 60">
                    <defs>
                        <clipPath id="clip-path">
                            <path id="Rectangle_1" d="M0 0h155.314v60H0z" fill="none" data-name="Rectangle 1"></path>
                        </clipPath>
                    </defs>
                    <g id="logo" transform="translate(-1305 -780.355)">
                        <g id="Group_2" clip-path="url(#clip-path)" data-name="Group 2" transform="translate(1305 780.355)">
                            <g id="Group_1" data-name="Group 1" transform="translate(.486 .486)">
                                <path id="Path_1" d="M1307.562 880.867l28.187-28.893a.521.521 0 0 0 .063-.666c-1.714-2.393-4.877-2.808-6.049-4.416-3.472-4.763-4.353-7.459-5.845-7.292a.456.456 0 0 0-.271.143l-10.182 10.438c-5.858 6-6.7 19.225-6.852 30.3a.552.552 0 0 0 .949.386z" fill="#017cee" data-name="Path 1" transform="translate(-1306.613 -822.232)"></path>
                                <path id="Path_2" d="M1405.512 908.489l-28.893-28.189a.521.521 0 0 0-.667-.063c-2.393 1.715-2.808 4.877-4.416 6.049-4.763 3.472-7.459 4.353-7.292 5.845a.456.456 0 0 0 .143.27l10.438 10.182c6 5.858 19.225 6.7 30.3 6.852a.552.552 0 0 0 .387-.946z" fill="#00ad46" data-name="Path 2" transform="translate(-1346.876 -850.567)"></path>
                                <path id="Path_3" d="M1373.909 902.252c-3.28-3.2-4.8-9.53 1.486-22.583-10.219 4.567-13.8 10.57-12.039 12.289z" fill="#04d659" data-name="Path 3" transform="translate(-1345.96 -850.233)"></path>
                                <path id="Path_4" d="M1433.132 782.359l-28.186 28.893a.52.52 0 0 0-.063.666c1.715 2.393 4.876 2.808 6.049 4.416 3.472 4.763 4.354 7.459 5.845 7.292a.454.454 0 0 0 .271-.143l10.182-10.438c5.858-6 6.7-19.225 6.852-30.3a.553.553 0 0 0-.95-.386z" fill="#00c7d4" data-name="Path 4" transform="translate(-1375.21 -782.123)"></path>
                                <path id="Path_5" d="M1426.9 881.155c-3.2 3.28-9.53 4.8-22.584-1.486 4.567 10.219 10.57 13.8 12.289 12.039z" fill="#11e1ee" data-name="Path 5" transform="translate(-1374.875 -850.233)"></path>
                                <path id="Path_6" d="M1307 782.919l28.893 28.186a.521.521 0 0 0 .666.063c2.393-1.715 2.808-4.877 4.416-6.049 4.763-3.472 7.459-4.353 7.292-5.845a.459.459 0 0 0-.143-.271l-10.438-10.182c-6-5.858-19.225-6.7-30.3-6.852a.552.552 0 0 0-.386.95z" fill="#e43921" data-name="Path 6" transform="translate(-1306.766 -781.97)"></path>
                                <path id="Path_7" d="M1405.8 804.711c3.28 3.2 4.8 9.53-1.486 22.584 10.219-4.567 13.8-10.571 12.039-12.289z" fill-rule="evenodd" fill="#ff7557" data-name="Path 7" transform="translate(-1374.875 -797.859)"></path>
                                <path id="Path_8" d="M1329.355 849.266c3.2-3.28 9.53-4.8 22.584 1.486-4.567-10.219-10.57-13.8-12.289-12.039z" fill="#0cb6ff" data-name="Path 8" transform="translate(-1322.503 -821.316)"></path>
                                <circle id="Ellipse_1" cx="1.26" cy="1.26" r="1.26" fill="#4a4848" data-name="Ellipse 1" transform="translate(28.18 28.171)"></circle>
                                <path id="Path_9" d="M1527.558 827.347a.229.229 0 0 1-.223-.223.458.458 0 0 1 .011-.123l2.766-7.214a.346.346 0 0 1 .357-.245h.758a.348.348 0 0 1 .357.245l2.754 7.214.022.123a.228.228 0 0 1-.223.223h-.568a.288.288 0 0 1-.19-.056.352.352 0 0 1-.089-.134l-.613-1.583h-3.657l-.613 1.583a.317.317 0 0 1-.1.134.269.269 0 0 1-.178.056zm4.795-2.732l-1.505-3.958-1.505 3.958zm3.322 4.85a.258.258 0 0 1-.189-.078.241.241 0 0 1-.067-.178v-7.4a.241.241 0 0 1 .067-.178.258.258 0 0 1 .189-.078h.513a.268.268 0 0 1 .256.256v.49a2.118 2.118 0 0 1 1.828-.858 2.092 2.092 0 0 1 1.751.736 3.135 3.135 0 0 1 .636 1.9q.011.122.011.379t-.011.379a3.168 3.168 0 0 1-.636 1.9 2.111 2.111 0 0 1-1.751.736 2.154 2.154 0 0 1-1.806-.836v2.587a.241.241 0 0 1-.067.178.223.223 0 0 1-.179.078zm2.364-2.91a1.324 1.324 0 0 0 1.149-.491 2.266 2.266 0 0 0 .4-1.293q.011-.111.011-.323 0-2.107-1.562-2.107a1.365 1.365 0 0 0-1.159.513 2.111 2.111 0 0 0-.412 1.2l-.012.424.012.435a1.862 1.862 0 0 0 .424 1.149 1.4 1.4 0 0 0 1.148.493zm5.628.9a2.329 2.329 0 0 1-1.015-.223 1.94 1.94 0 0 1-.747-.6 1.487 1.487 0 0 1-.268-.859 1.459 1.459 0 0 1 .6-1.2 3.4 3.4 0 0 1 1.65-.624l1.661-.234v-.323q0-1.137-1.3-1.137a1.4 1.4 0 0 0-.8.212 1.376 1.376 0 0 0-.468.48.305.305 0 0 1-.089.145.18.18 0 0 1-.134.045h-.48a.23.23 0 0 1-.245-.245 1.17 1.17 0 0 1 .245-.6 1.931 1.931 0 0 1 .747-.591 2.7 2.7 0 0 1 1.238-.256 2.351 2.351 0 0 1 1.8.591 2.032 2.032 0 0 1 .547 1.45v3.613a.257.257 0 0 1-.078.19.24.24 0 0 1-.178.067h-.513a.233.233 0 0 1-.257-.256v-.479a1.923 1.923 0 0 1-.714.6 2.557 2.557 0 0 1-1.203.237zm.234-.836a1.579 1.579 0 0 0 1.182-.469 1.881 1.881 0 0 0 .468-1.371v-.312l-1.293.19a2.918 2.918 0 0 0-1.193.379.761.761 0 0 0-.4.658.784.784 0 0 0 .368.691 1.585 1.585 0 0 0 .867.237zm6.643.836a2.556 2.556 0 0 1-1.873-.669 2.738 2.738 0 0 1-.714-1.9l-.011-.446.011-.446a2.7 2.7 0 0 1 .714-1.885 2.531 2.531 0 0 1 1.873-.68 2.917 2.917 0 0 1 1.36.29 2.077 2.077 0 0 1 .825.714 1.7 1.7 0 0 1 .3.848.2.2 0 0 1-.067.178.281.281 0 0 1-.19.067h-.535a.265.265 0 0 1-.168-.045.458.458 0 0 1-.111-.178 1.428 1.428 0 0 0-.535-.758 1.516 1.516 0 0 0-.87-.234 1.45 1.45 0 0 0-1.1.435 1.952 1.952 0 0 0-.435 1.3l-.011.4.011.379a1.969 1.969 0 0 0 .435 1.316 1.446 1.446 0 0 0 1.1.424 1.577 1.577 0 0 0 .87-.223 1.493 1.493 0 0 0 .535-.769.458.458 0 0 1 .111-.178.228.228 0 0 1 .168-.056h.535a.258.258 0 0 1 .19.078.2.2 0 0 1 .067.178 1.75 1.75 0 0 1-.3.847 2.078 2.078 0 0 1-.825.714 2.876 2.876 0 0 1-1.361.302zm4.078-.112a.233.233 0 0 1-.257-.256v-7.4a.241.241 0 0 1 .067-.178.259.259 0 0 1 .19-.078h.557a.267.267 0 0 1 .257.256v2.6a2.167 2.167 0 0 1 .758-.624 2.353 2.353 0 0 1 1.082-.223 2.067 2.067 0 0 1 1.661.691 2.642 2.642 0 0 1 .6 1.818v3.144a.257.257 0 0 1-.078.19.24.24 0 0 1-.178.067h-.557a.233.233 0 0 1-.256-.256V824a1.775 1.775 0 0 0-.39-1.227 1.387 1.387 0 0 0-1.1-.435 1.481 1.481 0 0 0-1.126.446 1.7 1.7 0 0 0-.412 1.215v3.088a.257.257 0 0 1-.078.19.24.24 0 0 1-.178.067zm8.846.112a2.466 2.466 0 0 1-1.84-.7 2.938 2.938 0 0 1-.747-1.94l-.011-.379.011-.368a2.953 2.953 0 0 1 .758-1.918 2.7 2.7 0 0 1 3.735.078 3.114 3.114 0 0 1 .68 2.119v.19a.257.257 0 0 1-.078.189.241.241 0 0 1-.178.067h-3.858v.1a2.11 2.11 0 0 0 .435 1.238 1.332 1.332 0 0 0 1.081.5 1.563 1.563 0 0 0 .836-.2 1.7 1.7 0 0 0 .491-.435.6.6 0 0 1 .145-.156.391.391 0 0 1 .19-.033h.547a.252.252 0 0 1 .167.056.192.192 0 0 1 .067.156.975.975 0 0 1-.312.591 2.51 2.51 0 0 1-.859.6 3.049 3.049 0 0 1-1.26.248zm1.527-3.434v-.033a1.817 1.817 0 0 0-.424-1.249 1.512 1.512 0 0 0-2.23 0 1.883 1.883 0 0 0-.4 1.249v.033z" fill="#51504f" data-name="Path 9" transform="translate(-1460.834 -808.144)"></path>
                                <path id="Path_10" d="M1527.2 827.081l-.061.061zm-.056-.279l-.08-.031zm2.766-7.214l.08.031zm1.472 0l-.081.029zm2.754 7.214l.084-.015a.064.064 0 0 0 0-.015zm.022.123h.086v-.015zm-.067.156l.06.061zm-.914.011l-.061.061.006.005zm-.089-.134l.081-.027zm-.613-1.583l.08-.031a.086.086 0 0 0-.08-.055zm-3.657 0v-.086a.086.086 0 0 0-.08.055zm-.613 1.583l-.08-.031zm-.1.134l.055.066zm4.047-2.676v.086a.086.086 0 0 0 .08-.116zm-1.505-3.958l.08-.03a.086.086 0 0 0-.16 0zm-1.505 3.958l-.08-.03a.086.086 0 0 0 .08.116zm-1.784 2.646a.128.128 0 0 1-.1-.042l-.122.121a.3.3 0 0 0 .217.092zm-.1-.042a.129.129 0 0 1-.042-.1h-.171a.3.3 0 0 0 .092.217zm-.042-.1a.38.38 0 0 1 .007-.1l-.163-.054a.514.514 0 0 0-.016.15zm.005-.092l2.765-7.214-.16-.061-2.765 7.214zm2.766-7.216a.283.283 0 0 1 .1-.143.3.3 0 0 1 .174-.046v-.172a.47.47 0 0 0-.271.076.453.453 0 0 0-.166.226zm.276-.189h.758v-.172h-.758zm.758 0a.3.3 0 0 1 .175.046.283.283 0 0 1 .1.143l.161-.059a.451.451 0 0 0-.166-.226.47.47 0 0 0-.272-.076zm.277.19l2.754 7.214.16-.061-2.754-7.214zm2.75 7.2l.022.123.169-.031-.022-.123zm.021.107a.13.13 0 0 1-.042.1l.121.121a.3.3 0 0 0 .092-.217zm-.042.1a.13.13 0 0 1-.1.042v.171a.3.3 0 0 0 .217-.092zm-.1.042h-.568v.171h.568zm-.568 0a.206.206 0 0 1-.135-.036l-.11.132a.373.373 0 0 0 .245.076zm-.129-.031a.262.262 0 0 1-.069-.1l-.162.054a.431.431 0 0 0 .11.167zm-.07-.1l-.613-1.584-.16.062.613 1.583zm-.693-1.638h-3.657v.171h3.657zm-3.737.055l-.614 1.584.16.062.613-1.583zm-.615 1.587a.235.235 0 0 1-.075.1l.111.13a.4.4 0 0 0 .126-.172zm-.074.1a.185.185 0 0 1-.124.036v.171a.354.354 0 0 0 .233-.076zm-.124.036h-.569v.171h.569zm4.306-2.677l-1.505-3.958-.16.061 1.505 3.958zm-1.666-3.958l-1.505 3.958.16.061 1.505-3.958zm-1.425 4.075h3.01v-.171h-3.01zm6.143 4.687l-.06.061zm0-7.761l.061.061zm.881 0l-.065.056.01.009zm.078.669h-.086a.086.086 0 0 0 .155.051zm3.579-.123l-.067.053zm.636 1.9h-.086zm0 .758l-.085-.007zm-.636 1.9l.067.054zm-3.557-.1l.068-.052a.086.086 0 0 0-.154.052zm-.067 2.765l-.061-.06zm2.787-3.323l-.069-.051zm.4-1.293l-.085-.008v.005zm-2.709-1.918l-.068-.052zm-.413 1.2h-.086zm-.011.423h-.085zm.011.435h-.086zm.424 1.149l.066-.054zm-1.216 3.315a.173.173 0 0 1-.129-.053l-.121.121a.342.342 0 0 0 .25.1zm-.129-.053a.157.157 0 0 1-.042-.118h-.172a.325.325 0 0 0 .092.239zm-.042-.118v-7.4h-.172v7.4zm0-7.4a.157.157 0 0 1 .042-.118l-.121-.121a.324.324 0 0 0-.092.239zm.042-.118a.173.173 0 0 1 .129-.053v-.172a.342.342 0 0 0-.25.1zm.129-.053h.513v-.172h-.513zm.513 0a.137.137 0 0 1 .113.048l.13-.111a.309.309 0 0 0-.244-.108zm.123.058a.137.137 0 0 1 .048.113h.171a.309.309 0 0 0-.108-.243zm.048.113v.49h.171v-.49zm.155.541a2.033 2.033 0 0 1 1.759-.823v-.171a2.2 2.2 0 0 0-1.9.894zm1.759-.823a2.007 2.007 0 0 1 1.683.7l.135-.106a2.177 2.177 0 0 0-1.818-.768zm1.683.7a3.045 3.045 0 0 1 .617 1.845l.171-.007a3.218 3.218 0 0 0-.654-1.946zm.617 1.85c.007.078.011.2.011.372h.171c0-.171 0-.3-.012-.387zm.011.372c0 .171 0 .294-.011.372l.17.015c.008-.086.012-.216.012-.387zm-.011.376a3.08 3.08 0 0 1-.617 1.846l.134.106a3.25 3.25 0 0 0 .654-1.945zm-.617 1.845a2.025 2.025 0 0 1-1.683.7v.171a2.2 2.2 0 0 0 1.817-.768zm-1.683.7a2.068 2.068 0 0 1-1.739-.8l-.136.1a2.239 2.239 0 0 0 1.874.87zm-1.892-.75v2.587h.172v-2.587zm0 2.587a.156.156 0 0 1-.042.118l.121.121a.325.325 0 0 0 .092-.239zm-.046.123a.138.138 0 0 1-.114.048v.172a.308.308 0 0 0 .244-.108zm-.114.048h-.546v.172h.546zm1.817-2.739a1.408 1.408 0 0 0 1.218-.526l-.138-.1a1.24 1.24 0 0 1-1.079.455zm1.217-.525a2.355 2.355 0 0 0 .419-1.341l-.171-.007a2.182 2.182 0 0 1-.385 1.246zm.418-1.336c.008-.079.012-.19.012-.332h-.172c0 .14 0 .245-.011.315zm.012-.332a2.726 2.726 0 0 0-.407-1.632 1.448 1.448 0 0 0-1.24-.562v.171a1.278 1.278 0 0 1 1.1.492 2.565 2.565 0 0 1 .374 1.53zm-1.647-2.193a1.452 1.452 0 0 0-1.228.547l.136.1a1.282 1.282 0 0 1 1.091-.479zm-1.228.547a2.2 2.2 0 0 0-.43 1.252l.172.008a2.028 2.028 0 0 1 .4-1.157zm-.43 1.254l-.011.424h.171l.011-.424zm-.011.428l.011.435h.172l-.011-.435zm.011.436a1.95 1.95 0 0 0 .443 1.2l.133-.109a1.776 1.776 0 0 1-.4-1.1zm.443 1.2a1.484 1.484 0 0 0 1.214.522v-.171a1.314 1.314 0 0 1-1.082-.459zm5.828 1.117l.037-.077zm-.747-.6l-.07.049zm.335-2.063l.052.068zm1.65-.624l.012.085zm1.661-.234l.012.085a.086.086 0 0 0 .074-.085zm-2.107-1.249l.046.072zm-.468.48l-.075-.042a.083.083 0 0 0-.006.015zm-.089.145l-.054-.067-.007.006zm-.792-.022l-.065.056.009.009zm-.067-.178h-.086zm.245-.6l-.07-.049zm.747-.591l.038.077zm3.033.334l-.063.058zm.468 5.252l.06.061zm-.881 0l-.065.056a.043.043 0 0 0 .009.009zm-.067-.669h.086a.086.086 0 0 0-.156-.048zm-.714.6l-.04-.076zm.223-1.059l-.062-.06zm.468-1.684h.086a.086.086 0 0 0-.1-.085zm-1.293.189l.012.085zm-1.193.379l.046.072zm-.033 1.349l-.047.071zm.635.985a2.241 2.241 0 0 1-.978-.215l-.074.155a2.412 2.412 0 0 0 1.051.231zm-.978-.215a1.859 1.859 0 0 1-.715-.576l-.138.1a2.024 2.024 0 0 0 .779.629zm-.713-.573a1.4 1.4 0 0 1-.253-.81h-.172a1.571 1.571 0 0 0 .283.907zm-.253-.81a1.374 1.374 0 0 1 .569-1.136l-.105-.135a1.544 1.544 0 0 0-.635 1.272zm.569-1.137a3.316 3.316 0 0 1 1.609-.607l-.024-.17a3.481 3.481 0 0 0-1.691.642zm1.609-.607l1.661-.234-.024-.17-1.662.234zm1.735-.319v-.323h-.171v.323zm0-.323a1.156 1.156 0 0 0-.355-.917 1.536 1.536 0 0 0-1.035-.306v.172a1.37 1.37 0 0 1 .922.263.986.986 0 0 1 .3.788zm-1.39-1.223a1.486 1.486 0 0 0-.851.227l.1.142a1.316 1.316 0 0 1 .755-.2zm-.849.226a1.452 1.452 0 0 0-.5.51l.15.084a1.286 1.286 0 0 1 .44-.449zm-.5.524a.226.226 0 0 1-.062.105l.107.134a.391.391 0 0 0 .117-.185zm-.068.112a.1.1 0 0 1-.073.019v.171a.266.266 0 0 0 .194-.07zm-.073.019h-.48v.171h.48zm-.48 0a.18.18 0 0 1-.122-.046l-.112.13a.352.352 0 0 0 .234.087zm-.113-.037a.18.18 0 0 1-.047-.123h-.171a.352.352 0 0 0 .087.234zm-.047-.119a1.1 1.1 0 0 1 .23-.557l-.14-.1a1.253 1.253 0 0 0-.261.648zm.23-.556a1.843 1.843 0 0 1 .715-.564l-.075-.154a2.018 2.018 0 0 0-.78.618zm.716-.564a2.611 2.611 0 0 1 1.2-.247v-.171a2.781 2.781 0 0 0-1.277.266zm1.2-.247a2.268 2.268 0 0 1 1.732.563l.126-.116a2.435 2.435 0 0 0-1.858-.618zm1.733.564a1.945 1.945 0 0 1 .523 1.391h.171a2.117 2.117 0 0 0-.57-1.508zm.523 1.391v3.613h.171v-3.613zm0 3.613a.172.172 0 0 1-.053.129l.121.121a.344.344 0 0 0 .1-.25zm-.053.129a.157.157 0 0 1-.118.042v.171a.326.326 0 0 0 .239-.092zm-.118.042h-.513v.171h.513zm-.513 0a.2.2 0 0 1-.134-.046l-.111.13a.367.367 0 0 0 .245.088zm-.124-.037a.194.194 0 0 1-.047-.134h-.171a.366.366 0 0 0 .087.245zm-.047-.134v-.479h-.171v.479zm-.156-.528a1.846 1.846 0 0 1-.683.575l.079.152a2.012 2.012 0 0 0 .745-.629zm-.683.575a2.476 2.476 0 0 1-1.153.236v.171a2.644 2.644 0 0 0 1.233-.255zm-.919-.429a1.666 1.666 0 0 0 1.244-.494l-.123-.12a1.493 1.493 0 0 1-1.121.442zm1.244-.494a1.969 1.969 0 0 0 .492-1.431h-.171a1.8 1.8 0 0 1-.444 1.312zm.492-1.431v-.312h-.171v.312zm-.1-.4l-1.293.189.025.17 1.293-.189zm-1.293.189a3 3 0 0 0-1.228.393l.095.143a2.837 2.837 0 0 1 1.158-.365zm-1.227.392a.845.845 0 0 0-.441.73h.172a.676.676 0 0 1 .362-.586zm-.441.73a.869.869 0 0 0 .406.762l.095-.142a.7.7 0 0 1-.33-.62zm.408.764a1.673 1.673 0 0 0 .916.247v-.171a1.5 1.5 0 0 1-.823-.221zm5.686.329l-.061.06zm-.714-1.9h-.085zm-.011-.446h-.085zm.011-.446h-.085zm.714-1.885l.061.061zm3.234-.39l-.04.076zm.825.713l-.073.046zm.3.848h-.086zm-.067.178l.056.065zm-.892.022l.054-.067zm-.112-.178l-.081.029zm-.535-.758l-.048.071zm-1.974.2l-.062-.059zm-.435 1.3h-.086zm-.011.4h-.086zm.011.379h-.086zm.435 1.316l-.062.059zm1.974.2l.046.072zm.535-.769l-.079-.033zm.112-.178l.054.067.007-.006zm.892.022l-.061.06zm.067.178l-.085-.009zm-.3.847l-.072-.046zm-.825.714l-.04-.076zm-1.36.2a2.471 2.471 0 0 1-1.814-.644l-.12.122a2.64 2.64 0 0 0 1.933.694zm-1.813-.643a2.653 2.653 0 0 1-.689-1.839l-.171.006a2.822 2.822 0 0 0 .738 1.952zm-.689-1.838l-.011-.446h-.171l.011.446zm-.011-.442l.011-.446h-.171l-.011.446zm.011-.445a2.611 2.611 0 0 1 .689-1.827l-.122-.121a2.78 2.78 0 0 0-.738 1.942zm.689-1.827a2.447 2.447 0 0 1 1.813-.655v-.171a2.617 2.617 0 0 0-1.934.705zm1.813-.655a2.836 2.836 0 0 1 1.32.28l.079-.152a3 3 0 0 0-1.4-.3zm1.32.28a1.99 1.99 0 0 1 .792.683l.145-.091a2.158 2.158 0 0 0-.858-.744zm.793.685a1.617 1.617 0 0 1 .287.8l.171-.009a1.789 1.789 0 0 0-.315-.89zm.287.809a.11.11 0 0 1-.037.1l.112.13a.281.281 0 0 0 .1-.252zm-.037.1a.2.2 0 0 1-.134.046v.171a.369.369 0 0 0 .246-.088zm-.134.046h-.535v.171h.535zm-.535 0a.184.184 0 0 1-.114-.026l-.107.134a.345.345 0 0 0 .221.064zm-.114-.026a.389.389 0 0 1-.086-.144l-.158.066a.533.533 0 0 0 .137.212zm-.084-.14a1.514 1.514 0 0 0-.57-.8l-.093.144a1.343 1.343 0 0 1 .5.715zm-.568-.8a1.6 1.6 0 0 0-.918-.249v.171a1.435 1.435 0 0 1 .822.219zm-.918-.249a1.535 1.535 0 0 0-1.166.462l.124.118a1.364 1.364 0 0 1 1.042-.408zm-1.166.462a2.036 2.036 0 0 0-.458 1.36l.171.006a1.872 1.872 0 0 1 .411-1.249zm-.458 1.361l-.011.4h.171l.011-.4zm-.011.406l.011.379.171-.005-.011-.379zm.011.38a2.052 2.052 0 0 0 .458 1.371l.124-.118a1.889 1.889 0 0 1-.411-1.26zm.458 1.371a1.533 1.533 0 0 0 1.166.451v-.172a1.363 1.363 0 0 1-1.042-.4zm1.166.451a1.661 1.661 0 0 0 .916-.237l-.093-.144a1.491 1.491 0 0 1-.823.209zm.918-.238a1.576 1.576 0 0 0 .568-.812l-.162-.057a1.409 1.409 0 0 1-.5.727zm.566-.807a.39.39 0 0 1 .086-.144l-.107-.134a.533.533 0 0 0-.137.213zm.093-.151a.144.144 0 0 1 .107-.031v-.171a.31.31 0 0 0-.228.081zm.107-.031h.535v-.171h-.535zm.535 0a.173.173 0 0 1 .129.053l.121-.121a.344.344 0 0 0-.25-.1zm.134.057a.11.11 0 0 1 .037.1l.17.017a.281.281 0 0 0-.1-.252zm.037.109a1.664 1.664 0 0 1-.288.806l.144.092a1.839 1.839 0 0 0 .315-.889zm-.288.806a1.989 1.989 0 0 1-.792.683l.079.152a2.162 2.162 0 0 0 .858-.744zm-.793.684a2.8 2.8 0 0 1-1.32.28v.171a2.96 2.96 0 0 0 1.4-.3zm2.568.187l-.065.056.01.009zm0-7.772l.061.06zm.926 0l-.065.056.009.009zm.078 2.776h-.085a.086.086 0 0 0 .153.053zm.758-.624l.038.077zm2.743.468l-.065.056zm.524 5.151l-.061-.06zm-.925 0l-.065.056.009.009zm-.457-4.5l-.065.056zm-2.23.011l-.062-.059zm-.49 4.493l-.061-.06zm-.736-.019a.2.2 0 0 1-.134-.046l-.112.13a.367.367 0 0 0 .245.088zm-.124-.037a.2.2 0 0 1-.046-.134h-.172a.367.367 0 0 0 .087.245zm-.046-.134v-7.4h-.172v7.4zm0-7.4a.156.156 0 0 1 .042-.118l-.121-.121a.326.326 0 0 0-.092.239zm.042-.118a.172.172 0 0 1 .129-.053v-.171a.343.343 0 0 0-.25.1zm.129-.053h.557v-.171h-.557zm.557 0a.137.137 0 0 1 .113.048l.13-.112a.308.308 0 0 0-.244-.108zm.122.057a.137.137 0 0 1 .048.113h.172a.309.309 0 0 0-.108-.243zm.048.113v2.6h.172v-2.6zm.153 2.651a2.076 2.076 0 0 1 .728-.6l-.075-.154a2.248 2.248 0 0 0-.788.649zm.73-.6a2.272 2.272 0 0 1 1.043-.214v-.171a2.438 2.438 0 0 0-1.121.232zm1.043-.214a1.982 1.982 0 0 1 1.6.661l.13-.112a2.152 2.152 0 0 0-1.727-.721zm1.6.663a2.557 2.557 0 0 1 .581 1.761h.171a2.727 2.727 0 0 0-.624-1.874zm.581 1.761v3.144h.171v-3.144zm0 3.144a.173.173 0 0 1-.053.129l.121.121a.345.345 0 0 0 .1-.25zm-.053.129a.156.156 0 0 1-.118.042v.171a.327.327 0 0 0 .239-.092zm-.118.042h-.557v.171h.557zm-.557 0a.2.2 0 0 1-.134-.046l-.112.13a.367.367 0 0 0 .245.088zm-.124-.037a.2.2 0 0 1-.046-.134h-.172a.368.368 0 0 0 .087.245zm-.046-.134V823.8h-.172v3.088zm0-3.088a1.859 1.859 0 0 0-.412-1.284l-.128.114a1.69 1.69 0 0 1 .368 1.169zm-.411-1.283a1.471 1.471 0 0 0-1.169-.464v.171a1.3 1.3 0 0 1 1.039.406zm-1.169-.464a1.566 1.566 0 0 0-1.188.473l.124.118a1.4 1.4 0 0 1 1.064-.419zm-1.188.473a1.779 1.779 0 0 0-.436 1.275h.172a1.609 1.609 0 0 1 .389-1.156zm-.436 1.275v3.088h.172V823.8zm0 3.088a.172.172 0 0 1-.053.129l.121.121a.344.344 0 0 0 .1-.25zm-.053.129a.156.156 0 0 1-.118.042v.171a.327.327 0 0 0 .239-.092zm-.118.042h-.557v.171h.557zm6.449-.505l-.062.059zm-.747-1.94h-.086zm-.012-.379h-.085v.005zm.012-.368l-.086-.006zm.758-1.918l-.061-.06zm3.735.078l-.065.056zm.6 2.5l.061.061zm-4.036.067v-.086a.086.086 0 0 0-.086.086zm0 .1h-.086zm.435 1.238l-.068.053zm1.918.3l.045.073zm.491-.435l-.069-.051zm.145-.156l.039.077h.006zm.9.022l-.055.066zm-.245.747l-.064-.057zm-.858.6l.035.078zm.267-3.189v.086a.086.086 0 0 0 .086-.086zm-.424-1.282l-.066.055zm-2.23 0l-.065-.055zm-.4 1.282h-.086a.086.086 0 0 0 .086.086zm1.528 3.349a2.38 2.38 0 0 1-1.779-.677l-.122.12a2.55 2.55 0 0 0 1.9.728zm-1.778-.676a2.86 2.86 0 0 1-.724-1.886l-.171.009a3.027 3.027 0 0 0 .771 1.995zm-.723-1.884l-.011-.379h-.171l.011.379zm-.011-.374l.011-.368-.172-.005-.011.368zm.011-.365a2.871 2.871 0 0 1 .735-1.864l-.124-.118a3.042 3.042 0 0 0-.782 1.971zm.734-1.864a2.331 2.331 0 0 1 1.756-.687v-.171a2.5 2.5 0 0 0-1.879.74zm1.756-.687a2.307 2.307 0 0 1 1.853.762l.13-.112a2.477 2.477 0 0 0-1.983-.821zm1.854.762a3.03 3.03 0 0 1 .659 2.062h.172a3.2 3.2 0 0 0-.7-2.175zm.659 2.062v.19h.172v-.19zm0 .19a.172.172 0 0 1-.053.129l.121.121a.345.345 0 0 0 .1-.25zm-.053.129a.156.156 0 0 1-.118.042v.171a.327.327 0 0 0 .239-.092zm-.118.042h-3.858v.171h3.858zm-3.944.086v.1h.172v-.1zm0 .1a2.2 2.2 0 0 0 .453 1.287l.135-.106a2.027 2.027 0 0 1-.417-1.189zm.454 1.288a1.418 1.418 0 0 0 1.148.533v-.171a1.247 1.247 0 0 1-1.015-.47zm1.148.533a1.647 1.647 0 0 0 .882-.214l-.09-.146a1.481 1.481 0 0 1-.791.188zm.882-.214a1.777 1.777 0 0 0 .515-.458l-.14-.1a1.613 1.613 0 0 1-.466.412zm.513-.456a1.251 1.251 0 0 1 .081-.1.28.28 0 0 1 .026-.025l.008-.006-.077-.153a.326.326 0 0 0-.083.068 1.55 1.55 0 0 0-.092.113zm.12-.134a.328.328 0 0 1 .146-.021v-.171a.468.468 0 0 0-.234.046zm.146-.021h.547v-.171h-.547zm.547 0a.166.166 0 0 1 .112.036l.11-.132a.337.337 0 0 0-.222-.076zm.112.036a.107.107 0 0 1 .036.09h.171a.277.277 0 0 0-.1-.222zm.036.09a.9.9 0 0 1-.291.534l.128.115a1.055 1.055 0 0 0 .334-.649zm-.291.535a2.42 2.42 0 0 1-.83.581l.072.156a2.6 2.6 0 0 0 .888-.624zm-.829.58a2.964 2.964 0 0 1-1.224.238v.171a3.133 3.133 0 0 0 1.295-.253zm.389-3.111v-.033h-.171v.033zm0-.033a1.9 1.9 0 0 0-.445-1.306l-.129.114a1.731 1.731 0 0 1 .4 1.192zm-.444-1.3a1.466 1.466 0 0 0-1.181-.521v.172a1.3 1.3 0 0 1 1.049.46zm-1.181-.521a1.466 1.466 0 0 0-1.18.521l.131.11a1.3 1.3 0 0 1 1.049-.46zm-1.181.521a1.965 1.965 0 0 0-.422 1.3h.172a1.794 1.794 0 0 1 .382-1.194zm-.422 1.3v.033h.172v-.033zm.086.119h3.055v-.171h-3.055z" fill="#51504f" data-name="Path 10" transform="translate(-1460.636 -807.945)"></path>
                                <path id="Path_11" d="M1519.066 884.011a.581.581 0 0 1-.567-.567 1.151 1.151 0 0 1 .028-.312l7.026-18.328a.881.881 0 0 1 .906-.623h1.926a.882.882 0 0 1 .907.623l7 18.328.057.312a.583.583 0 0 1-.567.567h-1.445a.735.735 0 0 1-.482-.142.9.9 0 0 1-.226-.34l-1.558-4.023h-9.292l-1.558 4.023a.8.8 0 0 1-.255.34.688.688 0 0 1-.453.142zm12.181-6.94l-3.824-10.056-3.823 10.055zm8.184-10.538a.592.592 0 0 1-.652-.651v-1.53a.714.714 0 0 1 .17-.482.656.656 0 0 1 .482-.2h1.785a.677.677 0 0 1 .68.68v1.53a.655.655 0 0 1-.2.481.713.713 0 0 1-.481.17zm.227 17.479a.593.593 0 0 1-.652-.652v-13.428a.611.611 0 0 1 .17-.453.656.656 0 0 1 .482-.2h1.359a.679.679 0 0 1 .652.651v13.427a.655.655 0 0 1-.2.482.613.613 0 0 1-.453.17zm6.861 0a.592.592 0 0 1-.651-.652v-13.4a.715.715 0 0 1 .17-.481.656.656 0 0 1 .482-.2h1.3a.677.677 0 0 1 .68.68v1.246a4.255 4.255 0 0 1 3.966-1.926h1.1a.679.679 0 0 1 .651.651v1.161a.566.566 0 0 1-.2.453.612.612 0 0 1-.453.17h-1.7a3.2 3.2 0 0 0-2.408.907 3.253 3.253 0 0 0-.879 2.408v8.328a.656.656 0 0 1-.2.482.716.716 0 0 1-.482.17zm12.234 0a.593.593 0 0 1-.651-.652v-11.814h-2.408a.592.592 0 0 1-.651-.651v-.963a.611.611 0 0 1 .17-.453.654.654 0 0 1 .481-.2h2.408v-1.417q0-4.816 4.872-4.815h1.586a.679.679 0 0 1 .652.651v.963a.656.656 0 0 1-.2.481.613.613 0 0 1-.453.17h-1.529a2.1 2.1 0 0 0-1.785.68 3.248 3.248 0 0 0-.51 2.011v1.275h6.062V863.7a.613.613 0 0 1 .17-.453.656.656 0 0 1 .482-.2h1.3a.679.679 0 0 1 .652.651v19.659a.655.655 0 0 1-.2.482.613.613 0 0 1-.454.17h-1.3a.592.592 0 0 1-.652-.652v-11.811h-6.062v11.813a.657.657 0 0 1-.2.482.614.614 0 0 1-.454.17zm20.9.283a6.487 6.487 0 0 1-4.844-1.757 6.837 6.837 0 0 1-1.813-4.674l-.029-1.218.029-1.218a6.732 6.732 0 0 1 1.841-4.646 7.389 7.389 0 0 1 9.631 0 6.736 6.736 0 0 1 1.841 4.646q.028.311.028 1.218t-.028 1.218a6.772 6.772 0 0 1-1.841 4.674 6.391 6.391 0 0 1-4.82 1.756zm0-2.181a3.582 3.582 0 0 0 2.8-1.133 4.931 4.931 0 0 0 1.133-3.258q.028-.283.028-1.076t-.028-1.076a4.931 4.931 0 0 0-1.133-3.258 3.582 3.582 0 0 0-2.8-1.133 3.671 3.671 0 0 0-2.833 1.133 4.83 4.83 0 0 0-1.1 3.258l-.028 1.076.028 1.076a4.83 4.83 0 0 0 1.1 3.258 3.671 3.671 0 0 0 2.828 1.132zm13.755 1.9a.846.846 0 0 1-.566-.17 1.321 1.321 0 0 1-.34-.538l-4.023-13.144-.056-.283a.575.575 0 0 1 .17-.425.641.641 0 0 1 .425-.17h1.246a.612.612 0 0 1 .453.17.646.646 0 0 1 .255.312l3.145 10.679 3.371-10.566a.761.761 0 0 1 .255-.4.726.726 0 0 1 .538-.2h.963a.728.728 0 0 1 .539.2.76.76 0 0 1 .255.4l3.371 10.566 3.144-10.679a.655.655 0 0 1 .2-.312.714.714 0 0 1 .482-.17h1.275a.542.542 0 0 1 .4.17.576.576 0 0 1 .17.425l-.057.283-3.994 13.144a1.323 1.323 0 0 1-.34.538.9.9 0 0 1-.6.17h-1.1a.86.86 0 0 1-.935-.708l-3.286-10.141-3.286 10.141a.928.928 0 0 1-.963.708z" fill="#51504f" data-name="Path 11" transform="translate(-1454.66 -838.62)"></path>
                            </g>
                        </g>
                    </g>
                </svg>

            </a>
        </div>
        <div class="desktop-only navbar__menu-container">

            <div class="navbar__menu-content" id="main_navbar">

                <div class="navbar__links-container">
                    
                        <a class="navbar__text-link" href="/community/">
                            Community
                        </a>
                    
                        <a class="navbar__text-link" href="/meetups/">
                            Meetups
                        </a>
                    
                        <a class="navbar__text-link" href="/docs/">
                            Documentation
                        </a>
                    
                        <a class="navbar__text-link" href="/use-cases/">
                            Use Cases
                        </a>
                    
                        <a class="navbar__text-link" href="/announcements/">
                            Announcements
                        </a>
                    
                        <a class="navbar__text-link" href="/blog/">
                            Blog
                        </a>
                    
                        <a class="navbar__text-link" href="/ecosystem/">
                            Ecosystem
                        </a>
                    
                </div>

                

            </div>

        </div>
        <div class="mobile-only navbar__drawer-container">
            <button class="navbar__toggle-button" id="navbar-toggle-button">

                <div id="hamburger-icon" class="navbar__toggle-button--icon visible">
                    <svg xmlns="http://www.w3.org/2000/svg" width="26" height="20" viewBox="0 0 26 20">
                        <g id="Group_1294" data-name="Group 1294" transform="translate(-38.791 291)">
                            <g id="Group_1291" data-name="Group 1291" transform="translate(39 -291)">
                                <rect id="Rectangle_461" width="26" height="2" fill="#51504f" data-name="Rectangle 461" rx="1" transform="translate(-.209)"></rect>
                            </g>
                            <g id="Group_1292" data-name="Group 1292" transform="translate(39 -281.822)">
                                <rect id="Rectangle_462" width="26" height="2" fill="#51504f" data-name="Rectangle 462" rx="1" transform="translate(-.209 -.178)"></rect>
                            </g>
                            <g id="Group_1293" data-name="Group 1293" transform="translate(39 -272.644)">
                                <rect id="Rectangle_463" width="26" height="2" fill="#51504f" data-name="Rectangle 463" rx="1" transform="translate(-.209 -.356)"></rect>
                            </g>
                        </g>
                    </svg>

                </div>

                <div id="close-icon" class="navbar__toggle-button--icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="19.799" height="19.799" viewBox="0 0 19.799 19.799">
                        <g id="Group_1574" data-name="Group 1574" transform="translate(-41.892 290.899)">
                            <g id="Group_1291" data-name="Group 1291" transform="rotate(-45 -308.114 -187.077)">
                                <rect id="Rectangle_461" width="26" height="2" fill="#51504f" data-name="Rectangle 461" rx="1" transform="translate(-.209)"></rect>
                            </g>
                            <g id="Group_1292" data-name="Group 1292" transform="rotate(45 372.48 -93.011)">
                                <rect id="Rectangle_462" width="26" height="2" fill="#51504f" data-name="Rectangle 462" rx="1" transform="translate(-.209 -.178)"></rect>
                            </g>
                        </g>
                    </svg>

                </div>

            </button>
            <div class="navbar__drawer" id="navbar-drawer">
                <div class="navbar__menu-content" id="main_navbar">

                    <div class="navbar__links-container">
                        
                            <a class="navbar__text-link" href="/community/">
                                Community
                            </a>
                        
                            <a class="navbar__text-link" href="/meetups/">
                                Meetups
                            </a>
                        
                            <a class="navbar__text-link" href="/docs/">
                                Documentation
                            </a>
                        
                            <a class="navbar__text-link" href="/use-cases/">
                                Use Cases
                            </a>
                        
                            <a class="navbar__text-link" href="/announcements/">
                                Announcements
                            </a>
                        
                            <a class="navbar__text-link" href="/blog/">
                                Blog
                            </a>
                        
                            <a class="navbar__text-link" href="/ecosystem/">
                                Ecosystem
                            </a>
                        

                    </div>
                    

                </div>
            </div>
        </div>
    </nav>

</header>


    <div class="roadmap container-fluid td-default base-layout">
        
        
    <div class="content-drawer-wrapper">
        <button class="content-drawer__toggle-button" id="content-open-button">

            <div id="hamburger-icon" class="content-drawer__toggle-button--icon visible">
                <svg xmlns="http://www.w3.org/2000/svg" width="20.005" height="13.879" viewBox="0 0 20.005 13.879">
                    <g id="Group_1619" data-name="Group 1619" transform="translate(271.132 -418.872)">
                        <g id="Group_1613" data-name="Group 1613" transform="translate(-266.229 431.045)">
                            <path id="Path_1337" d="M-218.5 513.215h-14.583a.259.259 0 0 1-.259-.26.259.259 0 0 1 .259-.259h14.583a.26.26 0 0 1 .259.259.259.259 0 0 1-.259.26z" fill="#51504f" data-name="Path 1337" transform="translate(233.345 -512.696)"></path>
                        </g>
                        <g id="Group_1614" data-name="Group 1614" transform="translate(-266.229 425.684)">
                            <path id="Path_1338" d="M-218.5 471.9h-14.583a.259.259 0 0 1-.259-.26.26.26 0 0 1 .259-.259h14.583a.26.26 0 0 1 .259.259.26.26 0 0 1-.259.26z" fill="#51504f" data-name="Path 1338" transform="translate(233.345 -471.376)"></path>
                        </g>
                        <g id="Group_1615" data-name="Group 1615" transform="translate(-266.229 420.323)">
                            <path id="Path_1339" d="M-218.5 430.574h-14.583a.259.259 0 0 1-.259-.259.259.259 0 0 1 .259-.259h14.583a.26.26 0 0 1 .259.259.259.259 0 0 1-.259.259z" fill="#51504f" data-name="Path 1339" transform="translate(233.345 -430.055)"></path>
                        </g>
                        <g id="Group_1616" data-name="Group 1616" transform="translate(-271.132 429.814)">
                            <path id="Path_1340" d="M-269.663 506.145a1.47 1.47 0 0 1-1.469-1.469 1.47 1.47 0 0 1 1.469-1.469 1.47 1.47 0 0 1 1.469 1.469 1.47 1.47 0 0 1-1.469 1.469zm0-2.418a.951.951 0 0 0-.95.95.951.951 0 0 0 .95.95.951.951 0 0 0 .95-.95.951.951 0 0 0-.95-.95z" fill="#51504f" data-name="Path 1340" transform="translate(271.132 -503.208)"></path>
                        </g>
                        <g id="Group_1617" data-name="Group 1617" transform="translate(-271.132 424.556)">
                            <path id="Path_1341" d="M-269.663 465.62a1.47 1.47 0 0 1-1.469-1.469 1.47 1.47 0 0 1 1.469-1.469 1.47 1.47 0 0 1 1.469 1.469 1.47 1.47 0 0 1-1.469 1.469zm0-2.418a.951.951 0 0 0-.95.95.951.951 0 0 0 .95.95.951.951 0 0 0 .95-.95.951.951 0 0 0-.95-.952z" fill="#51504f" data-name="Path 1341" transform="translate(271.132 -462.683)"></path>
                        </g>
                        <g id="Group_1618" data-name="Group 1618" transform="translate(-271.132 418.872)">
                            <path id="Path_1342" d="M-269.663 421.809a1.47 1.47 0 0 1-1.469-1.469 1.47 1.47 0 0 1 1.469-1.469 1.47 1.47 0 0 1 1.469 1.469 1.47 1.47 0 0 1-1.469 1.469zm0-2.418a.951.951 0 0 0-.95.95.951.951 0 0 0 .95.95.951.951 0 0 0 .95-.95.951.951 0 0 0-.95-.95z" fill="#51504f" data-name="Path 1342" transform="translate(271.132 -418.872)"></path>
                        </g>
                    </g>
                </svg>

                <span class="bodytext__mobile--brownish-grey">Content</span>
            </div>

        </button>
        <nav id="content-navbar" class="navbar navbar--hidden">
            <div class="navbar__icon-container">
                <a href="/">
                    <svg xmlns="http://www.w3.org/2000/svg" width="155.314" height="60" viewBox="0 0 155.314 60">
                        <defs>
                            <clipPath id="clip-path">
                                <path id="Rectangle_1" d="M0 0h155.314v60H0z" fill="none" data-name="Rectangle 1"></path>
                            </clipPath>
                        </defs>
                        <g id="logo" transform="translate(-1305 -780.355)">
                            <g id="Group_2" clip-path="url(#clip-path)" data-name="Group 2" transform="translate(1305 780.355)">
                                <g id="Group_1" data-name="Group 1" transform="translate(.486 .486)">
                                    <path id="Path_1" d="M1307.562 880.867l28.187-28.893a.521.521 0 0 0 .063-.666c-1.714-2.393-4.877-2.808-6.049-4.416-3.472-4.763-4.353-7.459-5.845-7.292a.456.456 0 0 0-.271.143l-10.182 10.438c-5.858 6-6.7 19.225-6.852 30.3a.552.552 0 0 0 .949.386z" fill="#017cee" data-name="Path 1" transform="translate(-1306.613 -822.232)"></path>
                                    <path id="Path_2" d="M1405.512 908.489l-28.893-28.189a.521.521 0 0 0-.667-.063c-2.393 1.715-2.808 4.877-4.416 6.049-4.763 3.472-7.459 4.353-7.292 5.845a.456.456 0 0 0 .143.27l10.438 10.182c6 5.858 19.225 6.7 30.3 6.852a.552.552 0 0 0 .387-.946z" fill="#00ad46" data-name="Path 2" transform="translate(-1346.876 -850.567)"></path>
                                    <path id="Path_3" d="M1373.909 902.252c-3.28-3.2-4.8-9.53 1.486-22.583-10.219 4.567-13.8 10.57-12.039 12.289z" fill="#04d659" data-name="Path 3" transform="translate(-1345.96 -850.233)"></path>
                                    <path id="Path_4" d="M1433.132 782.359l-28.186 28.893a.52.52 0 0 0-.063.666c1.715 2.393 4.876 2.808 6.049 4.416 3.472 4.763 4.354 7.459 5.845 7.292a.454.454 0 0 0 .271-.143l10.182-10.438c5.858-6 6.7-19.225 6.852-30.3a.553.553 0 0 0-.95-.386z" fill="#00c7d4" data-name="Path 4" transform="translate(-1375.21 -782.123)"></path>
                                    <path id="Path_5" d="M1426.9 881.155c-3.2 3.28-9.53 4.8-22.584-1.486 4.567 10.219 10.57 13.8 12.289 12.039z" fill="#11e1ee" data-name="Path 5" transform="translate(-1374.875 -850.233)"></path>
                                    <path id="Path_6" d="M1307 782.919l28.893 28.186a.521.521 0 0 0 .666.063c2.393-1.715 2.808-4.877 4.416-6.049 4.763-3.472 7.459-4.353 7.292-5.845a.459.459 0 0 0-.143-.271l-10.438-10.182c-6-5.858-19.225-6.7-30.3-6.852a.552.552 0 0 0-.386.95z" fill="#e43921" data-name="Path 6" transform="translate(-1306.766 -781.97)"></path>
                                    <path id="Path_7" d="M1405.8 804.711c3.28 3.2 4.8 9.53-1.486 22.584 10.219-4.567 13.8-10.571 12.039-12.289z" fill-rule="evenodd" fill="#ff7557" data-name="Path 7" transform="translate(-1374.875 -797.859)"></path>
                                    <path id="Path_8" d="M1329.355 849.266c3.2-3.28 9.53-4.8 22.584 1.486-4.567-10.219-10.57-13.8-12.289-12.039z" fill="#0cb6ff" data-name="Path 8" transform="translate(-1322.503 -821.316)"></path>
                                    <circle id="Ellipse_1" cx="1.26" cy="1.26" r="1.26" fill="#4a4848" data-name="Ellipse 1" transform="translate(28.18 28.171)"></circle>
                                    <path id="Path_9" d="M1527.558 827.347a.229.229 0 0 1-.223-.223.458.458 0 0 1 .011-.123l2.766-7.214a.346.346 0 0 1 .357-.245h.758a.348.348 0 0 1 .357.245l2.754 7.214.022.123a.228.228 0 0 1-.223.223h-.568a.288.288 0 0 1-.19-.056.352.352 0 0 1-.089-.134l-.613-1.583h-3.657l-.613 1.583a.317.317 0 0 1-.1.134.269.269 0 0 1-.178.056zm4.795-2.732l-1.505-3.958-1.505 3.958zm3.322 4.85a.258.258 0 0 1-.189-.078.241.241 0 0 1-.067-.178v-7.4a.241.241 0 0 1 .067-.178.258.258 0 0 1 .189-.078h.513a.268.268 0 0 1 .256.256v.49a2.118 2.118 0 0 1 1.828-.858 2.092 2.092 0 0 1 1.751.736 3.135 3.135 0 0 1 .636 1.9q.011.122.011.379t-.011.379a3.168 3.168 0 0 1-.636 1.9 2.111 2.111 0 0 1-1.751.736 2.154 2.154 0 0 1-1.806-.836v2.587a.241.241 0 0 1-.067.178.223.223 0 0 1-.179.078zm2.364-2.91a1.324 1.324 0 0 0 1.149-.491 2.266 2.266 0 0 0 .4-1.293q.011-.111.011-.323 0-2.107-1.562-2.107a1.365 1.365 0 0 0-1.159.513 2.111 2.111 0 0 0-.412 1.2l-.012.424.012.435a1.862 1.862 0 0 0 .424 1.149 1.4 1.4 0 0 0 1.148.493zm5.628.9a2.329 2.329 0 0 1-1.015-.223 1.94 1.94 0 0 1-.747-.6 1.487 1.487 0 0 1-.268-.859 1.459 1.459 0 0 1 .6-1.2 3.4 3.4 0 0 1 1.65-.624l1.661-.234v-.323q0-1.137-1.3-1.137a1.4 1.4 0 0 0-.8.212 1.376 1.376 0 0 0-.468.48.305.305 0 0 1-.089.145.18.18 0 0 1-.134.045h-.48a.23.23 0 0 1-.245-.245 1.17 1.17 0 0 1 .245-.6 1.931 1.931 0 0 1 .747-.591 2.7 2.7 0 0 1 1.238-.256 2.351 2.351 0 0 1 1.8.591 2.032 2.032 0 0 1 .547 1.45v3.613a.257.257 0 0 1-.078.19.24.24 0 0 1-.178.067h-.513a.233.233 0 0 1-.257-.256v-.479a1.923 1.923 0 0 1-.714.6 2.557 2.557 0 0 1-1.203.237zm.234-.836a1.579 1.579 0 0 0 1.182-.469 1.881 1.881 0 0 0 .468-1.371v-.312l-1.293.19a2.918 2.918 0 0 0-1.193.379.761.761 0 0 0-.4.658.784.784 0 0 0 .368.691 1.585 1.585 0 0 0 .867.237zm6.643.836a2.556 2.556 0 0 1-1.873-.669 2.738 2.738 0 0 1-.714-1.9l-.011-.446.011-.446a2.7 2.7 0 0 1 .714-1.885 2.531 2.531 0 0 1 1.873-.68 2.917 2.917 0 0 1 1.36.29 2.077 2.077 0 0 1 .825.714 1.7 1.7 0 0 1 .3.848.2.2 0 0 1-.067.178.281.281 0 0 1-.19.067h-.535a.265.265 0 0 1-.168-.045.458.458 0 0 1-.111-.178 1.428 1.428 0 0 0-.535-.758 1.516 1.516 0 0 0-.87-.234 1.45 1.45 0 0 0-1.1.435 1.952 1.952 0 0 0-.435 1.3l-.011.4.011.379a1.969 1.969 0 0 0 .435 1.316 1.446 1.446 0 0 0 1.1.424 1.577 1.577 0 0 0 .87-.223 1.493 1.493 0 0 0 .535-.769.458.458 0 0 1 .111-.178.228.228 0 0 1 .168-.056h.535a.258.258 0 0 1 .19.078.2.2 0 0 1 .067.178 1.75 1.75 0 0 1-.3.847 2.078 2.078 0 0 1-.825.714 2.876 2.876 0 0 1-1.361.302zm4.078-.112a.233.233 0 0 1-.257-.256v-7.4a.241.241 0 0 1 .067-.178.259.259 0 0 1 .19-.078h.557a.267.267 0 0 1 .257.256v2.6a2.167 2.167 0 0 1 .758-.624 2.353 2.353 0 0 1 1.082-.223 2.067 2.067 0 0 1 1.661.691 2.642 2.642 0 0 1 .6 1.818v3.144a.257.257 0 0 1-.078.19.24.24 0 0 1-.178.067h-.557a.233.233 0 0 1-.256-.256V824a1.775 1.775 0 0 0-.39-1.227 1.387 1.387 0 0 0-1.1-.435 1.481 1.481 0 0 0-1.126.446 1.7 1.7 0 0 0-.412 1.215v3.088a.257.257 0 0 1-.078.19.24.24 0 0 1-.178.067zm8.846.112a2.466 2.466 0 0 1-1.84-.7 2.938 2.938 0 0 1-.747-1.94l-.011-.379.011-.368a2.953 2.953 0 0 1 .758-1.918 2.7 2.7 0 0 1 3.735.078 3.114 3.114 0 0 1 .68 2.119v.19a.257.257 0 0 1-.078.189.241.241 0 0 1-.178.067h-3.858v.1a2.11 2.11 0 0 0 .435 1.238 1.332 1.332 0 0 0 1.081.5 1.563 1.563 0 0 0 .836-.2 1.7 1.7 0 0 0 .491-.435.6.6 0 0 1 .145-.156.391.391 0 0 1 .19-.033h.547a.252.252 0 0 1 .167.056.192.192 0 0 1 .067.156.975.975 0 0 1-.312.591 2.51 2.51 0 0 1-.859.6 3.049 3.049 0 0 1-1.26.248zm1.527-3.434v-.033a1.817 1.817 0 0 0-.424-1.249 1.512 1.512 0 0 0-2.23 0 1.883 1.883 0 0 0-.4 1.249v.033z" fill="#51504f" data-name="Path 9" transform="translate(-1460.834 -808.144)"></path>
                                    <path id="Path_10" d="M1527.2 827.081l-.061.061zm-.056-.279l-.08-.031zm2.766-7.214l.08.031zm1.472 0l-.081.029zm2.754 7.214l.084-.015a.064.064 0 0 0 0-.015zm.022.123h.086v-.015zm-.067.156l.06.061zm-.914.011l-.061.061.006.005zm-.089-.134l.081-.027zm-.613-1.583l.08-.031a.086.086 0 0 0-.08-.055zm-3.657 0v-.086a.086.086 0 0 0-.08.055zm-.613 1.583l-.08-.031zm-.1.134l.055.066zm4.047-2.676v.086a.086.086 0 0 0 .08-.116zm-1.505-3.958l.08-.03a.086.086 0 0 0-.16 0zm-1.505 3.958l-.08-.03a.086.086 0 0 0 .08.116zm-1.784 2.646a.128.128 0 0 1-.1-.042l-.122.121a.3.3 0 0 0 .217.092zm-.1-.042a.129.129 0 0 1-.042-.1h-.171a.3.3 0 0 0 .092.217zm-.042-.1a.38.38 0 0 1 .007-.1l-.163-.054a.514.514 0 0 0-.016.15zm.005-.092l2.765-7.214-.16-.061-2.765 7.214zm2.766-7.216a.283.283 0 0 1 .1-.143.3.3 0 0 1 .174-.046v-.172a.47.47 0 0 0-.271.076.453.453 0 0 0-.166.226zm.276-.189h.758v-.172h-.758zm.758 0a.3.3 0 0 1 .175.046.283.283 0 0 1 .1.143l.161-.059a.451.451 0 0 0-.166-.226.47.47 0 0 0-.272-.076zm.277.19l2.754 7.214.16-.061-2.754-7.214zm2.75 7.2l.022.123.169-.031-.022-.123zm.021.107a.13.13 0 0 1-.042.1l.121.121a.3.3 0 0 0 .092-.217zm-.042.1a.13.13 0 0 1-.1.042v.171a.3.3 0 0 0 .217-.092zm-.1.042h-.568v.171h.568zm-.568 0a.206.206 0 0 1-.135-.036l-.11.132a.373.373 0 0 0 .245.076zm-.129-.031a.262.262 0 0 1-.069-.1l-.162.054a.431.431 0 0 0 .11.167zm-.07-.1l-.613-1.584-.16.062.613 1.583zm-.693-1.638h-3.657v.171h3.657zm-3.737.055l-.614 1.584.16.062.613-1.583zm-.615 1.587a.235.235 0 0 1-.075.1l.111.13a.4.4 0 0 0 .126-.172zm-.074.1a.185.185 0 0 1-.124.036v.171a.354.354 0 0 0 .233-.076zm-.124.036h-.569v.171h.569zm4.306-2.677l-1.505-3.958-.16.061 1.505 3.958zm-1.666-3.958l-1.505 3.958.16.061 1.505-3.958zm-1.425 4.075h3.01v-.171h-3.01zm6.143 4.687l-.06.061zm0-7.761l.061.061zm.881 0l-.065.056.01.009zm.078.669h-.086a.086.086 0 0 0 .155.051zm3.579-.123l-.067.053zm.636 1.9h-.086zm0 .758l-.085-.007zm-.636 1.9l.067.054zm-3.557-.1l.068-.052a.086.086 0 0 0-.154.052zm-.067 2.765l-.061-.06zm2.787-3.323l-.069-.051zm.4-1.293l-.085-.008v.005zm-2.709-1.918l-.068-.052zm-.413 1.2h-.086zm-.011.423h-.085zm.011.435h-.086zm.424 1.149l.066-.054zm-1.216 3.315a.173.173 0 0 1-.129-.053l-.121.121a.342.342 0 0 0 .25.1zm-.129-.053a.157.157 0 0 1-.042-.118h-.172a.325.325 0 0 0 .092.239zm-.042-.118v-7.4h-.172v7.4zm0-7.4a.157.157 0 0 1 .042-.118l-.121-.121a.324.324 0 0 0-.092.239zm.042-.118a.173.173 0 0 1 .129-.053v-.172a.342.342 0 0 0-.25.1zm.129-.053h.513v-.172h-.513zm.513 0a.137.137 0 0 1 .113.048l.13-.111a.309.309 0 0 0-.244-.108zm.123.058a.137.137 0 0 1 .048.113h.171a.309.309 0 0 0-.108-.243zm.048.113v.49h.171v-.49zm.155.541a2.033 2.033 0 0 1 1.759-.823v-.171a2.2 2.2 0 0 0-1.9.894zm1.759-.823a2.007 2.007 0 0 1 1.683.7l.135-.106a2.177 2.177 0 0 0-1.818-.768zm1.683.7a3.045 3.045 0 0 1 .617 1.845l.171-.007a3.218 3.218 0 0 0-.654-1.946zm.617 1.85c.007.078.011.2.011.372h.171c0-.171 0-.3-.012-.387zm.011.372c0 .171 0 .294-.011.372l.17.015c.008-.086.012-.216.012-.387zm-.011.376a3.08 3.08 0 0 1-.617 1.846l.134.106a3.25 3.25 0 0 0 .654-1.945zm-.617 1.845a2.025 2.025 0 0 1-1.683.7v.171a2.2 2.2 0 0 0 1.817-.768zm-1.683.7a2.068 2.068 0 0 1-1.739-.8l-.136.1a2.239 2.239 0 0 0 1.874.87zm-1.892-.75v2.587h.172v-2.587zm0 2.587a.156.156 0 0 1-.042.118l.121.121a.325.325 0 0 0 .092-.239zm-.046.123a.138.138 0 0 1-.114.048v.172a.308.308 0 0 0 .244-.108zm-.114.048h-.546v.172h.546zm1.817-2.739a1.408 1.408 0 0 0 1.218-.526l-.138-.1a1.24 1.24 0 0 1-1.079.455zm1.217-.525a2.355 2.355 0 0 0 .419-1.341l-.171-.007a2.182 2.182 0 0 1-.385 1.246zm.418-1.336c.008-.079.012-.19.012-.332h-.172c0 .14 0 .245-.011.315zm.012-.332a2.726 2.726 0 0 0-.407-1.632 1.448 1.448 0 0 0-1.24-.562v.171a1.278 1.278 0 0 1 1.1.492 2.565 2.565 0 0 1 .374 1.53zm-1.647-2.193a1.452 1.452 0 0 0-1.228.547l.136.1a1.282 1.282 0 0 1 1.091-.479zm-1.228.547a2.2 2.2 0 0 0-.43 1.252l.172.008a2.028 2.028 0 0 1 .4-1.157zm-.43 1.254l-.011.424h.171l.011-.424zm-.011.428l.011.435h.172l-.011-.435zm.011.436a1.95 1.95 0 0 0 .443 1.2l.133-.109a1.776 1.776 0 0 1-.4-1.1zm.443 1.2a1.484 1.484 0 0 0 1.214.522v-.171a1.314 1.314 0 0 1-1.082-.459zm5.828 1.117l.037-.077zm-.747-.6l-.07.049zm.335-2.063l.052.068zm1.65-.624l.012.085zm1.661-.234l.012.085a.086.086 0 0 0 .074-.085zm-2.107-1.249l.046.072zm-.468.48l-.075-.042a.083.083 0 0 0-.006.015zm-.089.145l-.054-.067-.007.006zm-.792-.022l-.065.056.009.009zm-.067-.178h-.086zm.245-.6l-.07-.049zm.747-.591l.038.077zm3.033.334l-.063.058zm.468 5.252l.06.061zm-.881 0l-.065.056a.043.043 0 0 0 .009.009zm-.067-.669h.086a.086.086 0 0 0-.156-.048zm-.714.6l-.04-.076zm.223-1.059l-.062-.06zm.468-1.684h.086a.086.086 0 0 0-.1-.085zm-1.293.189l.012.085zm-1.193.379l.046.072zm-.033 1.349l-.047.071zm.635.985a2.241 2.241 0 0 1-.978-.215l-.074.155a2.412 2.412 0 0 0 1.051.231zm-.978-.215a1.859 1.859 0 0 1-.715-.576l-.138.1a2.024 2.024 0 0 0 .779.629zm-.713-.573a1.4 1.4 0 0 1-.253-.81h-.172a1.571 1.571 0 0 0 .283.907zm-.253-.81a1.374 1.374 0 0 1 .569-1.136l-.105-.135a1.544 1.544 0 0 0-.635 1.272zm.569-1.137a3.316 3.316 0 0 1 1.609-.607l-.024-.17a3.481 3.481 0 0 0-1.691.642zm1.609-.607l1.661-.234-.024-.17-1.662.234zm1.735-.319v-.323h-.171v.323zm0-.323a1.156 1.156 0 0 0-.355-.917 1.536 1.536 0 0 0-1.035-.306v.172a1.37 1.37 0 0 1 .922.263.986.986 0 0 1 .3.788zm-1.39-1.223a1.486 1.486 0 0 0-.851.227l.1.142a1.316 1.316 0 0 1 .755-.2zm-.849.226a1.452 1.452 0 0 0-.5.51l.15.084a1.286 1.286 0 0 1 .44-.449zm-.5.524a.226.226 0 0 1-.062.105l.107.134a.391.391 0 0 0 .117-.185zm-.068.112a.1.1 0 0 1-.073.019v.171a.266.266 0 0 0 .194-.07zm-.073.019h-.48v.171h.48zm-.48 0a.18.18 0 0 1-.122-.046l-.112.13a.352.352 0 0 0 .234.087zm-.113-.037a.18.18 0 0 1-.047-.123h-.171a.352.352 0 0 0 .087.234zm-.047-.119a1.1 1.1 0 0 1 .23-.557l-.14-.1a1.253 1.253 0 0 0-.261.648zm.23-.556a1.843 1.843 0 0 1 .715-.564l-.075-.154a2.018 2.018 0 0 0-.78.618zm.716-.564a2.611 2.611 0 0 1 1.2-.247v-.171a2.781 2.781 0 0 0-1.277.266zm1.2-.247a2.268 2.268 0 0 1 1.732.563l.126-.116a2.435 2.435 0 0 0-1.858-.618zm1.733.564a1.945 1.945 0 0 1 .523 1.391h.171a2.117 2.117 0 0 0-.57-1.508zm.523 1.391v3.613h.171v-3.613zm0 3.613a.172.172 0 0 1-.053.129l.121.121a.344.344 0 0 0 .1-.25zm-.053.129a.157.157 0 0 1-.118.042v.171a.326.326 0 0 0 .239-.092zm-.118.042h-.513v.171h.513zm-.513 0a.2.2 0 0 1-.134-.046l-.111.13a.367.367 0 0 0 .245.088zm-.124-.037a.194.194 0 0 1-.047-.134h-.171a.366.366 0 0 0 .087.245zm-.047-.134v-.479h-.171v.479zm-.156-.528a1.846 1.846 0 0 1-.683.575l.079.152a2.012 2.012 0 0 0 .745-.629zm-.683.575a2.476 2.476 0 0 1-1.153.236v.171a2.644 2.644 0 0 0 1.233-.255zm-.919-.429a1.666 1.666 0 0 0 1.244-.494l-.123-.12a1.493 1.493 0 0 1-1.121.442zm1.244-.494a1.969 1.969 0 0 0 .492-1.431h-.171a1.8 1.8 0 0 1-.444 1.312zm.492-1.431v-.312h-.171v.312zm-.1-.4l-1.293.189.025.17 1.293-.189zm-1.293.189a3 3 0 0 0-1.228.393l.095.143a2.837 2.837 0 0 1 1.158-.365zm-1.227.392a.845.845 0 0 0-.441.73h.172a.676.676 0 0 1 .362-.586zm-.441.73a.869.869 0 0 0 .406.762l.095-.142a.7.7 0 0 1-.33-.62zm.408.764a1.673 1.673 0 0 0 .916.247v-.171a1.5 1.5 0 0 1-.823-.221zm5.686.329l-.061.06zm-.714-1.9h-.085zm-.011-.446h-.085zm.011-.446h-.085zm.714-1.885l.061.061zm3.234-.39l-.04.076zm.825.713l-.073.046zm.3.848h-.086zm-.067.178l.056.065zm-.892.022l.054-.067zm-.112-.178l-.081.029zm-.535-.758l-.048.071zm-1.974.2l-.062-.059zm-.435 1.3h-.086zm-.011.4h-.086zm.011.379h-.086zm.435 1.316l-.062.059zm1.974.2l.046.072zm.535-.769l-.079-.033zm.112-.178l.054.067.007-.006zm.892.022l-.061.06zm.067.178l-.085-.009zm-.3.847l-.072-.046zm-.825.714l-.04-.076zm-1.36.2a2.471 2.471 0 0 1-1.814-.644l-.12.122a2.64 2.64 0 0 0 1.933.694zm-1.813-.643a2.653 2.653 0 0 1-.689-1.839l-.171.006a2.822 2.822 0 0 0 .738 1.952zm-.689-1.838l-.011-.446h-.171l.011.446zm-.011-.442l.011-.446h-.171l-.011.446zm.011-.445a2.611 2.611 0 0 1 .689-1.827l-.122-.121a2.78 2.78 0 0 0-.738 1.942zm.689-1.827a2.447 2.447 0 0 1 1.813-.655v-.171a2.617 2.617 0 0 0-1.934.705zm1.813-.655a2.836 2.836 0 0 1 1.32.28l.079-.152a3 3 0 0 0-1.4-.3zm1.32.28a1.99 1.99 0 0 1 .792.683l.145-.091a2.158 2.158 0 0 0-.858-.744zm.793.685a1.617 1.617 0 0 1 .287.8l.171-.009a1.789 1.789 0 0 0-.315-.89zm.287.809a.11.11 0 0 1-.037.1l.112.13a.281.281 0 0 0 .1-.252zm-.037.1a.2.2 0 0 1-.134.046v.171a.369.369 0 0 0 .246-.088zm-.134.046h-.535v.171h.535zm-.535 0a.184.184 0 0 1-.114-.026l-.107.134a.345.345 0 0 0 .221.064zm-.114-.026a.389.389 0 0 1-.086-.144l-.158.066a.533.533 0 0 0 .137.212zm-.084-.14a1.514 1.514 0 0 0-.57-.8l-.093.144a1.343 1.343 0 0 1 .5.715zm-.568-.8a1.6 1.6 0 0 0-.918-.249v.171a1.435 1.435 0 0 1 .822.219zm-.918-.249a1.535 1.535 0 0 0-1.166.462l.124.118a1.364 1.364 0 0 1 1.042-.408zm-1.166.462a2.036 2.036 0 0 0-.458 1.36l.171.006a1.872 1.872 0 0 1 .411-1.249zm-.458 1.361l-.011.4h.171l.011-.4zm-.011.406l.011.379.171-.005-.011-.379zm.011.38a2.052 2.052 0 0 0 .458 1.371l.124-.118a1.889 1.889 0 0 1-.411-1.26zm.458 1.371a1.533 1.533 0 0 0 1.166.451v-.172a1.363 1.363 0 0 1-1.042-.4zm1.166.451a1.661 1.661 0 0 0 .916-.237l-.093-.144a1.491 1.491 0 0 1-.823.209zm.918-.238a1.576 1.576 0 0 0 .568-.812l-.162-.057a1.409 1.409 0 0 1-.5.727zm.566-.807a.39.39 0 0 1 .086-.144l-.107-.134a.533.533 0 0 0-.137.213zm.093-.151a.144.144 0 0 1 .107-.031v-.171a.31.31 0 0 0-.228.081zm.107-.031h.535v-.171h-.535zm.535 0a.173.173 0 0 1 .129.053l.121-.121a.344.344 0 0 0-.25-.1zm.134.057a.11.11 0 0 1 .037.1l.17.017a.281.281 0 0 0-.1-.252zm.037.109a1.664 1.664 0 0 1-.288.806l.144.092a1.839 1.839 0 0 0 .315-.889zm-.288.806a1.989 1.989 0 0 1-.792.683l.079.152a2.162 2.162 0 0 0 .858-.744zm-.793.684a2.8 2.8 0 0 1-1.32.28v.171a2.96 2.96 0 0 0 1.4-.3zm2.568.187l-.065.056.01.009zm0-7.772l.061.06zm.926 0l-.065.056.009.009zm.078 2.776h-.085a.086.086 0 0 0 .153.053zm.758-.624l.038.077zm2.743.468l-.065.056zm.524 5.151l-.061-.06zm-.925 0l-.065.056.009.009zm-.457-4.5l-.065.056zm-2.23.011l-.062-.059zm-.49 4.493l-.061-.06zm-.736-.019a.2.2 0 0 1-.134-.046l-.112.13a.367.367 0 0 0 .245.088zm-.124-.037a.2.2 0 0 1-.046-.134h-.172a.367.367 0 0 0 .087.245zm-.046-.134v-7.4h-.172v7.4zm0-7.4a.156.156 0 0 1 .042-.118l-.121-.121a.326.326 0 0 0-.092.239zm.042-.118a.172.172 0 0 1 .129-.053v-.171a.343.343 0 0 0-.25.1zm.129-.053h.557v-.171h-.557zm.557 0a.137.137 0 0 1 .113.048l.13-.112a.308.308 0 0 0-.244-.108zm.122.057a.137.137 0 0 1 .048.113h.172a.309.309 0 0 0-.108-.243zm.048.113v2.6h.172v-2.6zm.153 2.651a2.076 2.076 0 0 1 .728-.6l-.075-.154a2.248 2.248 0 0 0-.788.649zm.73-.6a2.272 2.272 0 0 1 1.043-.214v-.171a2.438 2.438 0 0 0-1.121.232zm1.043-.214a1.982 1.982 0 0 1 1.6.661l.13-.112a2.152 2.152 0 0 0-1.727-.721zm1.6.663a2.557 2.557 0 0 1 .581 1.761h.171a2.727 2.727 0 0 0-.624-1.874zm.581 1.761v3.144h.171v-3.144zm0 3.144a.173.173 0 0 1-.053.129l.121.121a.345.345 0 0 0 .1-.25zm-.053.129a.156.156 0 0 1-.118.042v.171a.327.327 0 0 0 .239-.092zm-.118.042h-.557v.171h.557zm-.557 0a.2.2 0 0 1-.134-.046l-.112.13a.367.367 0 0 0 .245.088zm-.124-.037a.2.2 0 0 1-.046-.134h-.172a.368.368 0 0 0 .087.245zm-.046-.134V823.8h-.172v3.088zm0-3.088a1.859 1.859 0 0 0-.412-1.284l-.128.114a1.69 1.69 0 0 1 .368 1.169zm-.411-1.283a1.471 1.471 0 0 0-1.169-.464v.171a1.3 1.3 0 0 1 1.039.406zm-1.169-.464a1.566 1.566 0 0 0-1.188.473l.124.118a1.4 1.4 0 0 1 1.064-.419zm-1.188.473a1.779 1.779 0 0 0-.436 1.275h.172a1.609 1.609 0 0 1 .389-1.156zm-.436 1.275v3.088h.172V823.8zm0 3.088a.172.172 0 0 1-.053.129l.121.121a.344.344 0 0 0 .1-.25zm-.053.129a.156.156 0 0 1-.118.042v.171a.327.327 0 0 0 .239-.092zm-.118.042h-.557v.171h.557zm6.449-.505l-.062.059zm-.747-1.94h-.086zm-.012-.379h-.085v.005zm.012-.368l-.086-.006zm.758-1.918l-.061-.06zm3.735.078l-.065.056zm.6 2.5l.061.061zm-4.036.067v-.086a.086.086 0 0 0-.086.086zm0 .1h-.086zm.435 1.238l-.068.053zm1.918.3l.045.073zm.491-.435l-.069-.051zm.145-.156l.039.077h.006zm.9.022l-.055.066zm-.245.747l-.064-.057zm-.858.6l.035.078zm.267-3.189v.086a.086.086 0 0 0 .086-.086zm-.424-1.282l-.066.055zm-2.23 0l-.065-.055zm-.4 1.282h-.086a.086.086 0 0 0 .086.086zm1.528 3.349a2.38 2.38 0 0 1-1.779-.677l-.122.12a2.55 2.55 0 0 0 1.9.728zm-1.778-.676a2.86 2.86 0 0 1-.724-1.886l-.171.009a3.027 3.027 0 0 0 .771 1.995zm-.723-1.884l-.011-.379h-.171l.011.379zm-.011-.374l.011-.368-.172-.005-.011.368zm.011-.365a2.871 2.871 0 0 1 .735-1.864l-.124-.118a3.042 3.042 0 0 0-.782 1.971zm.734-1.864a2.331 2.331 0 0 1 1.756-.687v-.171a2.5 2.5 0 0 0-1.879.74zm1.756-.687a2.307 2.307 0 0 1 1.853.762l.13-.112a2.477 2.477 0 0 0-1.983-.821zm1.854.762a3.03 3.03 0 0 1 .659 2.062h.172a3.2 3.2 0 0 0-.7-2.175zm.659 2.062v.19h.172v-.19zm0 .19a.172.172 0 0 1-.053.129l.121.121a.345.345 0 0 0 .1-.25zm-.053.129a.156.156 0 0 1-.118.042v.171a.327.327 0 0 0 .239-.092zm-.118.042h-3.858v.171h3.858zm-3.944.086v.1h.172v-.1zm0 .1a2.2 2.2 0 0 0 .453 1.287l.135-.106a2.027 2.027 0 0 1-.417-1.189zm.454 1.288a1.418 1.418 0 0 0 1.148.533v-.171a1.247 1.247 0 0 1-1.015-.47zm1.148.533a1.647 1.647 0 0 0 .882-.214l-.09-.146a1.481 1.481 0 0 1-.791.188zm.882-.214a1.777 1.777 0 0 0 .515-.458l-.14-.1a1.613 1.613 0 0 1-.466.412zm.513-.456a1.251 1.251 0 0 1 .081-.1.28.28 0 0 1 .026-.025l.008-.006-.077-.153a.326.326 0 0 0-.083.068 1.55 1.55 0 0 0-.092.113zm.12-.134a.328.328 0 0 1 .146-.021v-.171a.468.468 0 0 0-.234.046zm.146-.021h.547v-.171h-.547zm.547 0a.166.166 0 0 1 .112.036l.11-.132a.337.337 0 0 0-.222-.076zm.112.036a.107.107 0 0 1 .036.09h.171a.277.277 0 0 0-.1-.222zm.036.09a.9.9 0 0 1-.291.534l.128.115a1.055 1.055 0 0 0 .334-.649zm-.291.535a2.42 2.42 0 0 1-.83.581l.072.156a2.6 2.6 0 0 0 .888-.624zm-.829.58a2.964 2.964 0 0 1-1.224.238v.171a3.133 3.133 0 0 0 1.295-.253zm.389-3.111v-.033h-.171v.033zm0-.033a1.9 1.9 0 0 0-.445-1.306l-.129.114a1.731 1.731 0 0 1 .4 1.192zm-.444-1.3a1.466 1.466 0 0 0-1.181-.521v.172a1.3 1.3 0 0 1 1.049.46zm-1.181-.521a1.466 1.466 0 0 0-1.18.521l.131.11a1.3 1.3 0 0 1 1.049-.46zm-1.181.521a1.965 1.965 0 0 0-.422 1.3h.172a1.794 1.794 0 0 1 .382-1.194zm-.422 1.3v.033h.172v-.033zm.086.119h3.055v-.171h-3.055z" fill="#51504f" data-name="Path 10" transform="translate(-1460.636 -807.945)"></path>
                                    <path id="Path_11" d="M1519.066 884.011a.581.581 0 0 1-.567-.567 1.151 1.151 0 0 1 .028-.312l7.026-18.328a.881.881 0 0 1 .906-.623h1.926a.882.882 0 0 1 .907.623l7 18.328.057.312a.583.583 0 0 1-.567.567h-1.445a.735.735 0 0 1-.482-.142.9.9 0 0 1-.226-.34l-1.558-4.023h-9.292l-1.558 4.023a.8.8 0 0 1-.255.34.688.688 0 0 1-.453.142zm12.181-6.94l-3.824-10.056-3.823 10.055zm8.184-10.538a.592.592 0 0 1-.652-.651v-1.53a.714.714 0 0 1 .17-.482.656.656 0 0 1 .482-.2h1.785a.677.677 0 0 1 .68.68v1.53a.655.655 0 0 1-.2.481.713.713 0 0 1-.481.17zm.227 17.479a.593.593 0 0 1-.652-.652v-13.428a.611.611 0 0 1 .17-.453.656.656 0 0 1 .482-.2h1.359a.679.679 0 0 1 .652.651v13.427a.655.655 0 0 1-.2.482.613.613 0 0 1-.453.17zm6.861 0a.592.592 0 0 1-.651-.652v-13.4a.715.715 0 0 1 .17-.481.656.656 0 0 1 .482-.2h1.3a.677.677 0 0 1 .68.68v1.246a4.255 4.255 0 0 1 3.966-1.926h1.1a.679.679 0 0 1 .651.651v1.161a.566.566 0 0 1-.2.453.612.612 0 0 1-.453.17h-1.7a3.2 3.2 0 0 0-2.408.907 3.253 3.253 0 0 0-.879 2.408v8.328a.656.656 0 0 1-.2.482.716.716 0 0 1-.482.17zm12.234 0a.593.593 0 0 1-.651-.652v-11.814h-2.408a.592.592 0 0 1-.651-.651v-.963a.611.611 0 0 1 .17-.453.654.654 0 0 1 .481-.2h2.408v-1.417q0-4.816 4.872-4.815h1.586a.679.679 0 0 1 .652.651v.963a.656.656 0 0 1-.2.481.613.613 0 0 1-.453.17h-1.529a2.1 2.1 0 0 0-1.785.68 3.248 3.248 0 0 0-.51 2.011v1.275h6.062V863.7a.613.613 0 0 1 .17-.453.656.656 0 0 1 .482-.2h1.3a.679.679 0 0 1 .652.651v19.659a.655.655 0 0 1-.2.482.613.613 0 0 1-.454.17h-1.3a.592.592 0 0 1-.652-.652v-11.811h-6.062v11.813a.657.657 0 0 1-.2.482.614.614 0 0 1-.454.17zm20.9.283a6.487 6.487 0 0 1-4.844-1.757 6.837 6.837 0 0 1-1.813-4.674l-.029-1.218.029-1.218a6.732 6.732 0 0 1 1.841-4.646 7.389 7.389 0 0 1 9.631 0 6.736 6.736 0 0 1 1.841 4.646q.028.311.028 1.218t-.028 1.218a6.772 6.772 0 0 1-1.841 4.674 6.391 6.391 0 0 1-4.82 1.756zm0-2.181a3.582 3.582 0 0 0 2.8-1.133 4.931 4.931 0 0 0 1.133-3.258q.028-.283.028-1.076t-.028-1.076a4.931 4.931 0 0 0-1.133-3.258 3.582 3.582 0 0 0-2.8-1.133 3.671 3.671 0 0 0-2.833 1.133 4.83 4.83 0 0 0-1.1 3.258l-.028 1.076.028 1.076a4.83 4.83 0 0 0 1.1 3.258 3.671 3.671 0 0 0 2.828 1.132zm13.755 1.9a.846.846 0 0 1-.566-.17 1.321 1.321 0 0 1-.34-.538l-4.023-13.144-.056-.283a.575.575 0 0 1 .17-.425.641.641 0 0 1 .425-.17h1.246a.612.612 0 0 1 .453.17.646.646 0 0 1 .255.312l3.145 10.679 3.371-10.566a.761.761 0 0 1 .255-.4.726.726 0 0 1 .538-.2h.963a.728.728 0 0 1 .539.2.76.76 0 0 1 .255.4l3.371 10.566 3.144-10.679a.655.655 0 0 1 .2-.312.714.714 0 0 1 .482-.17h1.275a.542.542 0 0 1 .4.17.576.576 0 0 1 .17.425l-.057.283-3.994 13.144a1.323 1.323 0 0 1-.34.538.9.9 0 0 1-.6.17h-1.1a.86.86 0 0 1-.935-.708l-3.286-10.141-3.286 10.141a.928.928 0 0 1-.963.708z" fill="#51504f" data-name="Path 11" transform="translate(-1454.66 -838.62)"></path>
                                </g>
                            </g>
                        </g>
                    </svg>

                </a>
            </div>

            <div id="content-close-button">
                <svg xmlns="http://www.w3.org/2000/svg" width="19.799" height="19.799" viewBox="0 0 19.799 19.799">
                    <g id="Group_1574" data-name="Group 1574" transform="translate(-41.892 290.899)">
                        <g id="Group_1291" data-name="Group 1291" transform="rotate(-45 -308.114 -187.077)">
                            <rect id="Rectangle_461" width="26" height="2" fill="#51504f" data-name="Rectangle 461" rx="1" transform="translate(-.209)"></rect>
                        </g>
                        <g id="Group_1292" data-name="Group 1292" transform="rotate(45 372.48 -93.011)">
                            <rect id="Rectangle_462" width="26" height="2" fill="#51504f" data-name="Rectangle 462" rx="1" transform="translate(-.209 -.178)"></rect>
                        </g>
                    </g>
                </svg>

            </div>

        </nav>
        <div class="content-drawer-container" id="content-drawer">
            <div class="content-drawer">
                <div class="td-sidebar">

<div id="docs-version-selector" class="docs-version-selector sidebar__version-selector">
    <a class="dropdown-toggle" href="#" id="versionDropdown" role="button" data-toggle="dropdown" aria-haspopup="true"
       aria-expanded="false">
        <span class="bodytext__medium--greyish-brown">Version: </span><span class="version">1.4.1</span>
    </a>
    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">

    </div>
    <script type="application/x-template" id="version-item-template">
        <a class="dropdown-item"></a>
    </script>
</div>

<div class="searchb-box">
    <form class="search-form" action="../../../../../../search.html" method="get">
        <input class="search-form__input" type="text" name="q" placeholder="Search docs" size="16">
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />

        <button class="search-form__button" type="submit">

            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20">
                <g id="Group_1579" data-name="Group 1579" transform="translate(-41.001 -41)">
                    <path id="Path_169" d="M71.415 64.687a7.215 7.215 0 1 0-6.729 6.728 7.222 7.222 0 0 0 6.729-6.728z" fill="none" data-name="Path 169" transform="translate(-14.277 -14.276)"></path>
                    <path id="Path_170" d="M60.863 59.8l-6.093-6.09a7.78 7.78 0 1 0-1.06 1.06l6.09 6.093a.468.468 0 0 0 .662 0l.4-.4a.468.468 0 0 0 .001-.663zM42.512 49.183a6.274 6.274 0 1 1 5.851 5.85 6.28 6.28 0 0 1-5.851-5.85z" fill="#51504f" data-name="Path 170"></path>
                </g>
            </svg>
        </button>
    </form>
</div>


<style>
    .searchb-box {
        margin-bottom: 26px;
    }
    .searchb-box .search-form {
        width: 100%;
        margin-top: 20px;
    }
</style>


<div class="toctree" role="navigation" aria-label="main navigation">
    <p class="caption" role="heading"><span class="caption-text">Basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../security.html">Security</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../auth-manager/index.html">Auth manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../upgrading.html">Upgrading</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Internal DB details</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../migrations-ref.html">Database Migrations</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../stable-rest-api-ref.html">Stable REST API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../configurations-ref.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../cli-ref.html">CLI</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../_api/airflow/providers/fab/index.html">Python API</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pypi.org/project/apache-airflow-providers-fab/">PyPI Repository</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../installing-providers-from-sources.html">Installing from sources</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Commits</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../commits.html">Detailed list of commits</a></li>
</ul>

</div>

<style type="text/css">
    .toctree {
    }
    .toctree li {
        list-style: none;
    }
    .toctree .caption {
        font-family: Roboto;
        font-size: 18px;
        font-weight: bold;
        font-stretch: normal;
        font-style: normal;
        line-height: 1.33;
        letter-spacing: normal;
        color: #51504f;
        padding-bottom: 13px;
        text-transform: uppercase;
        margin-bottom: 0;
    }
    .toctree .current > a:not([href="#"])  {
        color: #017cee;
    }
    .toctree > ul {
        padding-left: 0;
    }
    .toctree ul {
        padding-left: 15px;
        display: none;
    }
    .toctree > ul,
    .toctree li.current > ul {
        display: block;
    }

    .toctree a .toctree-expand {
        display: inline-block;
        position: relative;
        height: 1em;
    }

    .toctree a .toctree-expand:before {
        position: absolute;
        top: 6px;
        left: -12px;
        content: '';
        font-size: 7px;
    }
    .toctree .current > a > .toctree-expand:before {
        content: '';
    }

    .toctree .current {
        color: #017cee;
    }
    .toctree li {
        font-family: Roboto;
        font-size: 16px;
        font-weight: normal;
        font-stretch: normal;
        font-style: normal;
        line-height: 1.63;
        letter-spacing: normal;
        color: #707070;
    }

</style>
                </div>
            </div>
        </div>
    </div>
        
        <div class="d-flex">
            
            
    <div class="td-sidebar desktop-only d-print-none">

<div id="docs-version-selector" class="docs-version-selector sidebar__version-selector">
    <a class="dropdown-toggle" href="#" id="versionDropdown" role="button" data-toggle="dropdown" aria-haspopup="true"
       aria-expanded="false">
        <span class="bodytext__medium--greyish-brown">Version: </span><span class="version">1.4.1</span>
    </a>
    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">

    </div>
    <script type="application/x-template" id="version-item-template">
        <a class="dropdown-item"></a>
    </script>
</div>

<div class="searchb-box">
    <form class="search-form" action="../../../../../../search.html" method="get">
        <input class="search-form__input" type="text" name="q" placeholder="Search docs" size="16">
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />

        <button class="search-form__button" type="submit">

            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20">
                <g id="Group_1579" data-name="Group 1579" transform="translate(-41.001 -41)">
                    <path id="Path_169" d="M71.415 64.687a7.215 7.215 0 1 0-6.729 6.728 7.222 7.222 0 0 0 6.729-6.728z" fill="none" data-name="Path 169" transform="translate(-14.277 -14.276)"></path>
                    <path id="Path_170" d="M60.863 59.8l-6.093-6.09a7.78 7.78 0 1 0-1.06 1.06l6.09 6.093a.468.468 0 0 0 .662 0l.4-.4a.468.468 0 0 0 .001-.663zM42.512 49.183a6.274 6.274 0 1 1 5.851 5.85 6.28 6.28 0 0 1-5.851-5.85z" fill="#51504f" data-name="Path 170"></path>
                </g>
            </svg>
        </button>
    </form>
</div>


<style>
    .searchb-box {
        margin-bottom: 26px;
    }
    .searchb-box .search-form {
        width: 100%;
        margin-top: 20px;
    }
</style>


<div class="toctree" role="navigation" aria-label="main navigation">
    <p class="caption" role="heading"><span class="caption-text">Basics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../security.html">Security</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../auth-manager/index.html">Auth manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../upgrading.html">Upgrading</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Internal DB details</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../migrations-ref.html">Database Migrations</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../stable-rest-api-ref.html">Stable REST API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../configurations-ref.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../cli-ref.html">CLI</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../_api/airflow/providers/fab/index.html">Python API</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pypi.org/project/apache-airflow-providers-fab/">PyPI Repository</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../installing-providers-from-sources.html">Installing from sources</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Commits</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../commits.html">Detailed list of commits</a></li>
</ul>

</div>

<style type="text/css">
    .toctree {
    }
    .toctree li {
        list-style: none;
    }
    .toctree .caption {
        font-family: Roboto;
        font-size: 18px;
        font-weight: bold;
        font-stretch: normal;
        font-style: normal;
        line-height: 1.33;
        letter-spacing: normal;
        color: #51504f;
        padding-bottom: 13px;
        text-transform: uppercase;
        margin-bottom: 0;
    }
    .toctree .current > a:not([href="#"])  {
        color: #017cee;
    }
    .toctree > ul {
        padding-left: 0;
    }
    .toctree ul {
        padding-left: 15px;
        display: none;
    }
    .toctree > ul,
    .toctree li.current > ul {
        display: block;
    }

    .toctree a .toctree-expand {
        display: inline-block;
        position: relative;
        height: 1em;
    }

    .toctree a .toctree-expand:before {
        position: absolute;
        top: 6px;
        left: -12px;
        content: '';
        font-size: 7px;
    }
    .toctree .current > a > .toctree-expand:before {
        content: '';
    }

    .toctree .current {
        color: #017cee;
    }
    .toctree li {
        font-family: Roboto;
        font-size: 16px;
        font-weight: normal;
        font-stretch: normal;
        font-style: normal;
        line-height: 1.63;
        letter-spacing: normal;
        color: #707070;
    }

</style>
    </div>
            

            

            <main class="col-12 col-md-9 col-xl-8" role="main">
                


    




<div role="navigation" aria-label="breadcrumbs navigation" class="d-none d-md-block d-print-none">

    <ul class="breadcrumb">
        
            <li class="breadcrumb-item"><a href="../../../../../../index.html" class="icon icon-home"> Home</a></li>
            
                <li class="breadcrumb-item"><a href="../../../../../index.html"> Module code</a></li>
            
                <li class="breadcrumb-item"><a href="../../../fab.html"> airflow.providers.fab</a></li>
            
            <li class="breadcrumb-item"><a href="override.html"> airflow.providers.fab.auth_manager.security_manager.override</a></li>
        
    </ul>
</div>
                
                <div class="rst-content">
                    <div class="document">
                            <div class="documentwrapper">
                                <div class="bodywrapper">
                                    <div class="body" role="main">
                                        
  <h1>Source code for airflow.providers.fab.auth_manager.security_manager.override</h1><div class="highlight"><pre>
<span></span><span class="c1">#</span>
<span class="c1"># Licensed to the Apache Software Foundation (ASF) under one</span>
<span class="c1"># or more contributor license agreements.  See the NOTICE file</span>
<span class="c1"># distributed with this work for additional information</span>
<span class="c1"># regarding copyright ownership.  The ASF licenses this file</span>
<span class="c1"># to you under the Apache License, Version 2.0 (the</span>
<span class="c1"># &quot;License&quot;); you may not use this file except in compliance</span>
<span class="c1"># with the License.  You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#   http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing,</span>
<span class="c1"># software distributed under the License is distributed on an</span>
<span class="c1"># &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span>
<span class="c1"># KIND, either express or implied.  See the License for the</span>
<span class="c1"># specific language governing permissions and limitations</span>
<span class="c1"># under the License.</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Collection</span><span class="p">,</span> <span class="n">Container</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Sequence</span>

<span class="kn">import</span> <span class="nn">jwt</span>
<span class="kn">import</span> <span class="nn">packaging.version</span>
<span class="kn">import</span> <span class="nn">re2</span>
<span class="kn">from</span> <span class="nn">deprecated</span> <span class="kn">import</span> <span class="n">deprecated</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">flash</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">has_request_context</span><span class="p">,</span> <span class="n">session</span>
<span class="kn">from</span> <span class="nn">flask_appbuilder</span> <span class="kn">import</span> <span class="n">const</span>
<span class="kn">from</span> <span class="nn">flask_appbuilder.const</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">AUTH_DB</span><span class="p">,</span>
    <span class="n">AUTH_LDAP</span><span class="p">,</span>
    <span class="n">AUTH_OAUTH</span><span class="p">,</span>
    <span class="n">AUTH_OID</span><span class="p">,</span>
    <span class="n">AUTH_REMOTE_USER</span><span class="p">,</span>
    <span class="n">LOGMSG_ERR_SEC_ADD_REGISTER_USER</span><span class="p">,</span>
    <span class="n">LOGMSG_ERR_SEC_AUTH_LDAP</span><span class="p">,</span>
    <span class="n">LOGMSG_ERR_SEC_AUTH_LDAP_TLS</span><span class="p">,</span>
    <span class="n">LOGMSG_WAR_SEC_LOGIN_FAILED</span><span class="p">,</span>
    <span class="n">LOGMSG_WAR_SEC_NOLDAP_OBJ</span><span class="p">,</span>
    <span class="n">MICROSOFT_KEY_SET_URL</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">flask_appbuilder.models.sqla</span> <span class="kn">import</span> <span class="n">Base</span>
<span class="kn">from</span> <span class="nn">flask_appbuilder.models.sqla.interface</span> <span class="kn">import</span> <span class="n">SQLAInterface</span>
<span class="kn">from</span> <span class="nn">flask_appbuilder.security.registerviews</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">RegisterUserDBView</span><span class="p">,</span>
    <span class="n">RegisterUserOAuthView</span><span class="p">,</span>
    <span class="n">RegisterUserOIDView</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">flask_appbuilder.security.views</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">AuthDBView</span><span class="p">,</span>
    <span class="n">AuthLDAPView</span><span class="p">,</span>
    <span class="n">AuthOAuthView</span><span class="p">,</span>
    <span class="n">AuthOIDView</span><span class="p">,</span>
    <span class="n">AuthRemoteUserView</span><span class="p">,</span>
    <span class="n">AuthView</span><span class="p">,</span>
    <span class="n">RegisterUserModelView</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">flask_appbuilder.views</span> <span class="kn">import</span> <span class="n">expose</span>
<span class="kn">from</span> <span class="nn">flask_babel</span> <span class="kn">import</span> <span class="n">lazy_gettext</span>
<span class="kn">from</span> <span class="nn">flask_jwt_extended</span> <span class="kn">import</span> <span class="n">JWTManager</span><span class="p">,</span> <span class="n">current_user</span> <span class="k">as</span> <span class="n">current_user_jwt</span>
<span class="kn">from</span> <span class="nn">flask_login</span> <span class="kn">import</span> <span class="n">LoginManager</span>
<span class="kn">from</span> <span class="nn">itsdangerous</span> <span class="kn">import</span> <span class="n">want_bytes</span>
<span class="kn">from</span> <span class="nn">markupsafe</span> <span class="kn">import</span> <span class="n">Markup</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">and_</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">inspect</span><span class="p">,</span> <span class="n">literal</span><span class="p">,</span> <span class="n">or_</span><span class="p">,</span> <span class="n">select</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.exc</span> <span class="kn">import</span> <span class="n">MultipleResultsFound</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">Session</span><span class="p">,</span> <span class="n">joinedload</span>
<span class="kn">from</span> <span class="nn">werkzeug.security</span> <span class="kn">import</span> <span class="n">check_password_hash</span><span class="p">,</span> <span class="n">generate_password_hash</span>

<span class="kn">from</span> <span class="nn">airflow</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">airflow_version</span>
<span class="kn">from</span> <span class="nn">airflow.auth.managers.utils.fab</span> <span class="kn">import</span> <span class="n">get_method_from_fab_action_map</span>
<span class="kn">from</span> <span class="nn">airflow.configuration</span> <span class="kn">import</span> <span class="n">conf</span>
<span class="kn">from</span> <span class="nn">airflow.exceptions</span> <span class="kn">import</span> <span class="n">AirflowException</span><span class="p">,</span> <span class="n">AirflowProviderDeprecationWarning</span><span class="p">,</span> <span class="n">RemovedInAirflow3Warning</span>
<span class="kn">from</span> <span class="nn">airflow.models</span> <span class="kn">import</span> <span class="n">DagBag</span><span class="p">,</span> <span class="n">DagModel</span>
<span class="kn">from</span> <span class="nn">airflow.providers.fab.auth_manager.models</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Action</span><span class="p">,</span>
    <span class="n">Permission</span><span class="p">,</span>
    <span class="n">RegisterUser</span><span class="p">,</span>
    <span class="n">Resource</span><span class="p">,</span>
    <span class="n">Role</span><span class="p">,</span>
    <span class="n">User</span><span class="p">,</span>
    <span class="n">assoc_permission_role</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">airflow.providers.fab.auth_manager.models.anonymous_user</span> <span class="kn">import</span> <span class="n">AnonymousUser</span>
<span class="kn">from</span> <span class="nn">airflow.providers.fab.auth_manager.security_manager.constants</span> <span class="kn">import</span> <span class="n">EXISTING_ROLES</span>
<span class="kn">from</span> <span class="nn">airflow.providers.fab.auth_manager.views.permissions</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ActionModelView</span><span class="p">,</span>
    <span class="n">PermissionPairModelView</span><span class="p">,</span>
    <span class="n">ResourceModelView</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">airflow.providers.fab.auth_manager.views.roles_list</span> <span class="kn">import</span> <span class="n">CustomRoleModelView</span>
<span class="kn">from</span> <span class="nn">airflow.providers.fab.auth_manager.views.user</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">CustomUserDBModelView</span><span class="p">,</span>
    <span class="n">CustomUserLDAPModelView</span><span class="p">,</span>
    <span class="n">CustomUserOAuthModelView</span><span class="p">,</span>
    <span class="n">CustomUserOIDModelView</span><span class="p">,</span>
    <span class="n">CustomUserRemoteUserModelView</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">airflow.providers.fab.auth_manager.views.user_edit</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">CustomResetMyPasswordView</span><span class="p">,</span>
    <span class="n">CustomResetPasswordView</span><span class="p">,</span>
    <span class="n">CustomUserInfoEditView</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">airflow.providers.fab.auth_manager.views.user_stats</span> <span class="kn">import</span> <span class="n">CustomUserStatsChartView</span>
<span class="kn">from</span> <span class="nn">airflow.security</span> <span class="kn">import</span> <span class="n">permissions</span>
<span class="kn">from</span> <span class="nn">airflow.utils.session</span> <span class="kn">import</span> <span class="n">NEW_SESSION</span><span class="p">,</span> <span class="n">provide_session</span>
<span class="kn">from</span> <span class="nn">airflow.www.extensions.init_auth_manager</span> <span class="kn">import</span> <span class="n">get_auth_manager</span>
<span class="kn">from</span> <span class="nn">airflow.www.security_manager</span> <span class="kn">import</span> <span class="n">AirflowSecurityManagerV2</span>
<span class="kn">from</span> <span class="nn">airflow.www.session</span> <span class="kn">import</span> <span class="n">AirflowDatabaseSessionInterface</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">airflow.auth.managers.base_auth_manager</span> <span class="kn">import</span> <span class="n">ResourceMethod</span>
    <span class="kn">from</span> <span class="nn">airflow.security.permissions</span> <span class="kn">import</span> <span class="n">RESOURCE_ASSET</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">airflow.security.permissions</span> <span class="kn">import</span> <span class="n">RESOURCE_ASSET</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">airflow.security.permissions</span> <span class="kn">import</span> <span class="n">RESOURCE_DATASET</span> <span class="k">as</span> <span class="n">RESOURCE_ASSET</span>

<div class="viewcode-block" id="log"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.log">[docs]</a><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span></div>

<span class="c1"># This is the limit of DB user sessions that we consider as &quot;healthy&quot;. If you have more sessions that this</span>
<span class="c1"># number then we will refuse to delete sessions that have expired and old user sessions when resetting</span>
<span class="c1"># user&#39;s password, and raise a warning in the UI instead. Usually when you have that many sessions, it means</span>
<span class="c1"># that there is something wrong with your deployment - for example you have an automated API call that</span>
<span class="c1"># continuously creates new sessions. Such setup should be fixed by reusing sessions or by periodically</span>
<span class="c1"># purging the old sessions by using `airflow db clean` command.</span>
<div class="viewcode-block" id="MAX_NUM_DATABASE_USER_SESSIONS"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.MAX_NUM_DATABASE_USER_SESSIONS">[docs]</a><span class="n">MAX_NUM_DATABASE_USER_SESSIONS</span> <span class="o">=</span> <span class="mi">50000</span></div>


<span class="c1"># The following logic patches the logout method within AuthView, so it supports POST method</span>
<span class="c1"># to make CSRF protection effective. It is backward-compatible with Airflow versions &lt;= 2.9.2 as it still</span>
<span class="c1"># allows utilizing the GET method for them.</span>
<span class="c1"># You could remove the patch and configure it when it is supported</span>
<span class="c1"># natively by Flask-AppBuilder (https://github.com/dpgaspar/Flask-AppBuilder/issues/2248)</span>
<span class="k">if</span> <span class="n">packaging</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">packaging</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">airflow_version</span><span class="p">)</span><span class="o">.</span><span class="n">base_version</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">packaging</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span>
    <span class="s2">&quot;2.10.0&quot;</span>
<span class="p">):</span>
    <span class="n">_methods</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">_methods</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">_ModifiedAuthView</span><span class="p">(</span><span class="n">AuthView</span><span class="p">):</span>
    <span class="nd">@expose</span><span class="p">(</span><span class="s2">&quot;/logout/&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="n">_methods</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">logout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>


<span class="k">for</span> <span class="n">auth_view</span> <span class="ow">in</span> <span class="p">[</span><span class="n">AuthDBView</span><span class="p">,</span> <span class="n">AuthLDAPView</span><span class="p">,</span> <span class="n">AuthOAuthView</span><span class="p">,</span> <span class="n">AuthOIDView</span><span class="p">,</span> <span class="n">AuthRemoteUserView</span><span class="p">]:</span>
    <span class="n">auth_view</span><span class="o">.</span><span class="vm">__bases__</span> <span class="o">=</span> <span class="p">(</span><span class="n">_ModifiedAuthView</span><span class="p">,)</span>


<div class="viewcode-block" id="FabAirflowSecurityManagerOverride"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride">[docs]</a><span class="k">class</span> <span class="nc">FabAirflowSecurityManagerOverride</span><span class="p">(</span><span class="n">AirflowSecurityManagerV2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This security manager overrides the default AirflowSecurityManager security manager.</span>

<span class="sd">    This security manager is used only if the auth manager FabAuthManager is used. It defines everything in</span>
<span class="sd">    the security manager that is needed for the FabAuthManager to work. Any operation specific to</span>
<span class="sd">    the AirflowSecurityManager should be defined here instead of AirflowSecurityManager.</span>

<span class="sd">    :param appbuilder: The appbuilder.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_view"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_view">[docs]</a>    <span class="n">auth_view</span> <span class="o">=</span> <span class="kc">None</span></div>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; The obj instance for authentication view &quot;&quot;&quot;</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.registeruser_view"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.registeruser_view">[docs]</a>    <span class="n">registeruser_view</span> <span class="o">=</span> <span class="kc">None</span></div>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; The obj instance for registering user view &quot;&quot;&quot;</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.user_view"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.user_view">[docs]</a>    <span class="n">user_view</span> <span class="o">=</span> <span class="kc">None</span></div>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; The obj instance for user view &quot;&quot;&quot;</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot; Models &quot;&quot;&quot;</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.user_model"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.user_model">[docs]</a>    <span class="n">user_model</span> <span class="o">=</span> <span class="n">User</span></div>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.role_model"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.role_model">[docs]</a>    <span class="n">role_model</span> <span class="o">=</span> <span class="n">Role</span></div>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.action_model"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.action_model">[docs]</a>    <span class="n">action_model</span> <span class="o">=</span> <span class="n">Action</span></div>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.resource_model"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.resource_model">[docs]</a>    <span class="n">resource_model</span> <span class="o">=</span> <span class="n">Resource</span></div>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.permission_model"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.permission_model">[docs]</a>    <span class="n">permission_model</span> <span class="o">=</span> <span class="n">Permission</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot; Views &quot;&quot;&quot;</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.authdbview"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.authdbview">[docs]</a>    <span class="n">authdbview</span> <span class="o">=</span> <span class="n">AuthDBView</span></div>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Override if you want your own Authentication DB view &quot;&quot;&quot;</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.authldapview"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.authldapview">[docs]</a>    <span class="n">authldapview</span> <span class="o">=</span> <span class="n">AuthLDAPView</span></div>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Override if you want your own Authentication LDAP view &quot;&quot;&quot;</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.authoidview"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.authoidview">[docs]</a>    <span class="n">authoidview</span> <span class="o">=</span> <span class="n">AuthOIDView</span></div>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Override if you want your own Authentication OID view &quot;&quot;&quot;</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.authoauthview"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.authoauthview">[docs]</a>    <span class="n">authoauthview</span> <span class="o">=</span> <span class="n">AuthOAuthView</span></div>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Override if you want your own Authentication OAuth view &quot;&quot;&quot;</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.authremoteuserview"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.authremoteuserview">[docs]</a>    <span class="n">authremoteuserview</span> <span class="o">=</span> <span class="n">AuthRemoteUserView</span></div>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Override if you want your own Authentication REMOTE_USER view &quot;&quot;&quot;</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.registeruserdbview"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.registeruserdbview">[docs]</a>    <span class="n">registeruserdbview</span> <span class="o">=</span> <span class="n">RegisterUserDBView</span></div>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Override if you want your own register user db view &quot;&quot;&quot;</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.registeruseroidview"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.registeruseroidview">[docs]</a>    <span class="n">registeruseroidview</span> <span class="o">=</span> <span class="n">RegisterUserOIDView</span></div>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Override if you want your own register user OpenID view &quot;&quot;&quot;</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.registeruseroauthview"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.registeruseroauthview">[docs]</a>    <span class="n">registeruseroauthview</span> <span class="o">=</span> <span class="n">RegisterUserOAuthView</span></div>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Override if you want your own register user OAuth view &quot;&quot;&quot;</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.actionmodelview"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.actionmodelview">[docs]</a>    <span class="n">actionmodelview</span> <span class="o">=</span> <span class="n">ActionModelView</span></div>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.permissionmodelview"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.permissionmodelview">[docs]</a>    <span class="n">permissionmodelview</span> <span class="o">=</span> <span class="n">PermissionPairModelView</span></div>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.rolemodelview"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.rolemodelview">[docs]</a>    <span class="n">rolemodelview</span> <span class="o">=</span> <span class="n">CustomRoleModelView</span></div>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.registeruser_model"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.registeruser_model">[docs]</a>    <span class="n">registeruser_model</span> <span class="o">=</span> <span class="n">RegisterUser</span></div>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.registerusermodelview"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.registerusermodelview">[docs]</a>    <span class="n">registerusermodelview</span> <span class="o">=</span> <span class="n">RegisterUserModelView</span></div>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.resourcemodelview"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.resourcemodelview">[docs]</a>    <span class="n">resourcemodelview</span> <span class="o">=</span> <span class="n">ResourceModelView</span></div>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.userdbmodelview"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.userdbmodelview">[docs]</a>    <span class="n">userdbmodelview</span> <span class="o">=</span> <span class="n">CustomUserDBModelView</span></div>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.resetmypasswordview"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.resetmypasswordview">[docs]</a>    <span class="n">resetmypasswordview</span> <span class="o">=</span> <span class="n">CustomResetMyPasswordView</span></div>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.resetpasswordview"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.resetpasswordview">[docs]</a>    <span class="n">resetpasswordview</span> <span class="o">=</span> <span class="n">CustomResetPasswordView</span></div>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.userinfoeditview"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.userinfoeditview">[docs]</a>    <span class="n">userinfoeditview</span> <span class="o">=</span> <span class="n">CustomUserInfoEditView</span></div>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.userldapmodelview"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.userldapmodelview">[docs]</a>    <span class="n">userldapmodelview</span> <span class="o">=</span> <span class="n">CustomUserLDAPModelView</span></div>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.useroauthmodelview"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.useroauthmodelview">[docs]</a>    <span class="n">useroauthmodelview</span> <span class="o">=</span> <span class="n">CustomUserOAuthModelView</span></div>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.userremoteusermodelview"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.userremoteusermodelview">[docs]</a>    <span class="n">userremoteusermodelview</span> <span class="o">=</span> <span class="n">CustomUserRemoteUserModelView</span></div>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.useroidmodelview"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.useroidmodelview">[docs]</a>    <span class="n">useroidmodelview</span> <span class="o">=</span> <span class="n">CustomUserOIDModelView</span></div>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.userstatschartview"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.userstatschartview">[docs]</a>    <span class="n">userstatschartview</span> <span class="o">=</span> <span class="n">CustomUserStatsChartView</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.jwt_manager"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.jwt_manager">[docs]</a>    <span class="n">jwt_manager</span> <span class="o">=</span> <span class="kc">None</span></div>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Flask-JWT-Extended &quot;&quot;&quot;</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.oid"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.oid">[docs]</a>    <span class="n">oid</span> <span class="o">=</span> <span class="kc">None</span></div>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Flask-OpenID OpenID &quot;&quot;&quot;</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.oauth"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.oauth">[docs]</a>    <span class="n">oauth</span> <span class="o">=</span> <span class="kc">None</span></div>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.oauth_remotes"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.oauth_remotes">[docs]</a>    <span class="n">oauth_remotes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></div>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Initialized (remote_app) providers dict {&#39;provider_name&#39;, OBJ } &quot;&quot;&quot;</span>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.oauth_user_info"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.oauth_user_info">[docs]</a>    <span class="n">oauth_user_info</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.oauth_allow_list"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.oauth_allow_list">[docs]</a>    <span class="n">oauth_allow_list</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span></div>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; OAuth email allow list &quot;&quot;&quot;</span>

    <span class="c1"># global resource for dag-level access</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.DAG_RESOURCES"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.DAG_RESOURCES">[docs]</a>    <span class="n">DAG_RESOURCES</span> <span class="o">=</span> <span class="p">{</span><span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_DAG</span><span class="p">}</span></div>

    <span class="c1">###########################################################################</span>
    <span class="c1">#                               PERMISSIONS</span>
    <span class="c1">###########################################################################</span>

    <span class="c1"># [START security_viewer_perms]</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.VIEWER_PERMISSIONS"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.VIEWER_PERMISSIONS">[docs]</a>    <span class="n">VIEWER_PERMISSIONS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_DAG</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_DAG_DEPENDENCIES</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_DAG_CODE</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_DAG_RUN</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">,</span> <span class="n">RESOURCE_ASSET</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_CLUSTER_ACTIVITY</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_POOL</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_IMPORT_ERROR</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_DAG_WARNING</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_JOB</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_MY_PASSWORD</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_EDIT</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_MY_PASSWORD</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_MY_PROFILE</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_EDIT</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_MY_PROFILE</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_SLA_MISS</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_TASK_INSTANCE</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_TASK_LOG</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_XCOM</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_WEBSITE</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_ACCESS_MENU</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_BROWSE_MENU</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_ACCESS_MENU</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_DAG</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_ACCESS_MENU</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_DAG_DEPENDENCIES</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_ACCESS_MENU</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_DAG_RUN</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_ACCESS_MENU</span><span class="p">,</span> <span class="n">RESOURCE_ASSET</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_ACCESS_MENU</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_CLUSTER_ACTIVITY</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_ACCESS_MENU</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_DOCS</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_ACCESS_MENU</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_DOCS_MENU</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_ACCESS_MENU</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_JOB</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_ACCESS_MENU</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_SLA_MISS</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_ACCESS_MENU</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_TASK_INSTANCE</span><span class="p">),</span>
    <span class="p">]</span></div>
    <span class="c1"># [END security_viewer_perms]</span>

    <span class="c1"># [START security_user_perms]</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.USER_PERMISSIONS"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.USER_PERMISSIONS">[docs]</a>    <span class="n">USER_PERMISSIONS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_EDIT</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_DAG</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_DELETE</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_DAG</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_CREATE</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_TASK_INSTANCE</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_EDIT</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_TASK_INSTANCE</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_DELETE</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_TASK_INSTANCE</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_CREATE</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_DAG_RUN</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_EDIT</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_DAG_RUN</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_DELETE</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_DAG_RUN</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_CREATE</span><span class="p">,</span> <span class="n">RESOURCE_ASSET</span><span class="p">),</span>
    <span class="p">]</span></div>
    <span class="c1"># [END security_user_perms]</span>

    <span class="c1"># [START security_op_perms]</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.OP_PERMISSIONS"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.OP_PERMISSIONS">[docs]</a>    <span class="n">OP_PERMISSIONS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_CONFIG</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_ACCESS_MENU</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_ADMIN_MENU</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_ACCESS_MENU</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_CONFIG</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_ACCESS_MENU</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_CONNECTION</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_ACCESS_MENU</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_POOL</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_ACCESS_MENU</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_PLUGIN</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_ACCESS_MENU</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_VARIABLE</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_ACCESS_MENU</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_PROVIDER</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_ACCESS_MENU</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_XCOM</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_CREATE</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_CONNECTION</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_CONNECTION</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_EDIT</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_CONNECTION</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_DELETE</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_CONNECTION</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_CREATE</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_POOL</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_EDIT</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_POOL</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_DELETE</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_POOL</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_PLUGIN</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_PROVIDER</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_CREATE</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_VARIABLE</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_VARIABLE</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_EDIT</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_VARIABLE</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_DELETE</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_VARIABLE</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_DELETE</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_XCOM</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_DELETE</span><span class="p">,</span> <span class="n">RESOURCE_ASSET</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_CREATE</span><span class="p">,</span> <span class="n">RESOURCE_ASSET</span><span class="p">),</span>
    <span class="p">]</span></div>
    <span class="c1"># [END security_op_perms]</span>

    <span class="c1"># [START security_admin_perms]</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.ADMIN_PERMISSIONS"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.ADMIN_PERMISSIONS">[docs]</a>    <span class="n">ADMIN_PERMISSIONS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_AUDIT_LOG</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_ACCESS_MENU</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_AUDIT_LOG</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_TASK_RESCHEDULE</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_ACCESS_MENU</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_TASK_RESCHEDULE</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_TRIGGER</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_ACCESS_MENU</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_TRIGGER</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_PASSWORD</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_EDIT</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_PASSWORD</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_ROLE</span><span class="p">),</span>
        <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_EDIT</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_ROLE</span><span class="p">),</span>
    <span class="p">]</span></div>
    <span class="c1"># [END security_admin_perms]</span>

    <span class="c1">###########################################################################</span>
    <span class="c1">#                     DEFAULT ROLE CONFIGURATIONS</span>
    <span class="c1">###########################################################################</span>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.ROLE_CONFIGS"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.ROLE_CONFIGS">[docs]</a>    <span class="n">ROLE_CONFIGS</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;Public&quot;</span><span class="p">,</span> <span class="s2">&quot;perms&quot;</span><span class="p">:</span> <span class="p">[]},</span>
        <span class="p">{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;Viewer&quot;</span><span class="p">,</span> <span class="s2">&quot;perms&quot;</span><span class="p">:</span> <span class="n">VIEWER_PERMISSIONS</span><span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;User&quot;</span><span class="p">,</span>
            <span class="s2">&quot;perms&quot;</span><span class="p">:</span> <span class="n">VIEWER_PERMISSIONS</span> <span class="o">+</span> <span class="n">USER_PERMISSIONS</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;Op&quot;</span><span class="p">,</span>
            <span class="s2">&quot;perms&quot;</span><span class="p">:</span> <span class="n">VIEWER_PERMISSIONS</span> <span class="o">+</span> <span class="n">USER_PERMISSIONS</span> <span class="o">+</span> <span class="n">OP_PERMISSIONS</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;Admin&quot;</span><span class="p">,</span>
            <span class="s2">&quot;perms&quot;</span><span class="p">:</span> <span class="n">VIEWER_PERMISSIONS</span> <span class="o">+</span> <span class="n">USER_PERMISSIONS</span> <span class="o">+</span> <span class="n">OP_PERMISSIONS</span> <span class="o">+</span> <span class="n">ADMIN_PERMISSIONS</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">]</span></div>

    <span class="c1"># global resource for dag-level access</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.RESOURCE_DETAILS_MAP"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.RESOURCE_DETAILS_MAP">[docs]</a>    <span class="n">RESOURCE_DETAILS_MAP</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>
        <span class="n">permissions</span><span class="p">,</span>
        <span class="s2">&quot;RESOURCE_DETAILS_MAP&quot;</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_DAG</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;actions&quot;</span><span class="p">:</span> <span class="n">permissions</span><span class="o">.</span><span class="n">DAG_ACTIONS</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">},</span>
    <span class="p">)</span></div>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.DAG_ACTIONS"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.DAG_ACTIONS">[docs]</a>    <span class="n">DAG_ACTIONS</span> <span class="o">=</span> <span class="n">RESOURCE_DETAILS_MAP</span><span class="p">[</span><span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_DAG</span><span class="p">][</span><span class="s2">&quot;actions&quot;</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appbuilder</span><span class="p">):</span>
        <span class="c1"># done in super, but we need it before we can call super.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span> <span class="o">=</span> <span class="n">appbuilder</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_init_config</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_auth</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_data_model</span><span class="p">()</span>
        <span class="c1"># can only call super once data model init has been done</span>
        <span class="c1"># because of the view.datamodel hack that&#39;s done in the init there.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">appbuilder</span><span class="o">=</span><span class="n">appbuilder</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_builtin_roles</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_builtin_roles</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">create_db</span><span class="p">()</span>

        <span class="c1"># Setup Flask login</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_login_manager</span><span class="p">()</span>

        <span class="c1"># Setup Flask-Jwt-Extended</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_jwt_manager</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_authentik_jwks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jwks_url</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">requests</span>

        <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">jwks_url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_validate_jwt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">id_token</span><span class="p">,</span> <span class="n">jwks</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">authlib.jose</span> <span class="kn">import</span> <span class="n">JsonWebKey</span><span class="p">,</span> <span class="n">jwt</span> <span class="k">as</span> <span class="n">authlib_jwt</span>

        <span class="n">keyset</span> <span class="o">=</span> <span class="n">JsonWebKey</span><span class="o">.</span><span class="n">import_key_set</span><span class="p">(</span><span class="n">jwks</span><span class="p">)</span>
        <span class="n">claims</span> <span class="o">=</span> <span class="n">authlib_jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">id_token</span><span class="p">,</span> <span class="n">keyset</span><span class="p">)</span>
        <span class="n">claims</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;JWT token is validated&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">claims</span>

    <span class="k">def</span> <span class="nf">_get_authentik_token_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">id_token</span><span class="p">):</span>
        <span class="n">me</span> <span class="o">=</span> <span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">id_token</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;verify_signature&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>

        <span class="n">verify_signature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oauth_remotes</span><span class="p">[</span><span class="s2">&quot;authentik&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">client_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;verify_signature&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verify_signature</span><span class="p">:</span>
            <span class="c1"># Validate the token using authentik certificate</span>
            <span class="n">jwks_uri</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oauth_remotes</span><span class="p">[</span><span class="s2">&quot;authentik&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">server_metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;jwks_uri&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">jwks_uri</span><span class="p">:</span>
                <span class="n">jwks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_authentik_jwks</span><span class="p">(</span><span class="n">jwks_uri</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">jwks</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_jwt</span><span class="p">(</span><span class="n">id_token</span><span class="p">,</span> <span class="n">jwks</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;jwks_uri not specified in OAuth Providers, could not verify token signature&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Return the token info without validating</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;JWT token is not validated!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">me</span>

        <span class="k">raise</span> <span class="n">AirflowException</span><span class="p">(</span><span class="s2">&quot;OAuth signature verify failed&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.register_views"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.register_views">[docs]</a>    <span class="k">def</span> <span class="nf">register_views</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register FAB auth manager related views.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;FAB_ADD_SECURITY_VIEWS&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_user_registration</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_type</span> <span class="o">==</span> <span class="n">AUTH_DB</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">registeruser_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">registeruserdbview</span><span class="p">()</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_type</span> <span class="o">==</span> <span class="n">AUTH_OID</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">registeruser_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">registeruseroidview</span><span class="p">()</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_type</span> <span class="o">==</span> <span class="n">AUTH_OAUTH</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">registeruser_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">registeruseroauthview</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">registeruser_view</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">add_view_no_menu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">registeruser_view</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">add_view_no_menu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resetpasswordview</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">add_view_no_menu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resetmypasswordview</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">add_view_no_menu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">userinfoeditview</span><span class="p">())</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_type</span> <span class="o">==</span> <span class="n">AUTH_DB</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">user_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">userdbmodelview</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">auth_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">authdbview</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_type</span> <span class="o">==</span> <span class="n">AUTH_LDAP</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">user_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">userldapmodelview</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">auth_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">authldapview</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_type</span> <span class="o">==</span> <span class="n">AUTH_OAUTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">user_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">useroauthmodelview</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">auth_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">authoauthview</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_type</span> <span class="o">==</span> <span class="n">AUTH_REMOTE_USER</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">user_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">userremoteusermodelview</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">auth_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">authremoteuserview</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">user_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">useroidmodelview</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">auth_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">authoidview</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">add_view_no_menu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_view</span><span class="p">)</span>

        <span class="c1"># this needs to be done after the view is added, otherwise the blueprint</span>
        <span class="c1"># is not initialized</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_auth_limited</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">limiter</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_rate_limit</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">])(</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_view</span><span class="o">.</span><span class="n">blueprint</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">user_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">user_view</span><span class="p">,</span>
            <span class="s2">&quot;List Users&quot;</span><span class="p">,</span>
            <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;fa-user&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">lazy_gettext</span><span class="p">(</span><span class="s2">&quot;List Users&quot;</span><span class="p">),</span>
            <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Security&quot;</span><span class="p">,</span>
            <span class="n">category_icon</span><span class="o">=</span><span class="s2">&quot;fa-cogs&quot;</span><span class="p">,</span>
            <span class="n">category_label</span><span class="o">=</span><span class="n">lazy_gettext</span><span class="p">(</span><span class="s2">&quot;Security&quot;</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">role_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rolemodelview</span><span class="p">,</span>
            <span class="s2">&quot;List Roles&quot;</span><span class="p">,</span>
            <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;fa-group&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">lazy_gettext</span><span class="p">(</span><span class="s2">&quot;List Roles&quot;</span><span class="p">),</span>
            <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Security&quot;</span><span class="p">,</span>
            <span class="n">category_icon</span><span class="o">=</span><span class="s2">&quot;fa-cogs&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">role_view</span><span class="o">.</span><span class="n">related_views</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">user_view</span><span class="o">.</span><span class="vm">__class__</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">userstatschartview</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">userstatschartview</span><span class="p">,</span>
                <span class="s2">&quot;User&#39;s Statistics&quot;</span><span class="p">,</span>
                <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;fa-bar-chart-o&quot;</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="n">lazy_gettext</span><span class="p">(</span><span class="s2">&quot;User&#39;s Statistics&quot;</span><span class="p">),</span>
                <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Security&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_user_registration</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">registerusermodelview</span><span class="p">,</span>
                <span class="s2">&quot;User&#39;s Statistics&quot;</span><span class="p">,</span>
                <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;fa-user-plus&quot;</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="n">lazy_gettext</span><span class="p">(</span><span class="s2">&quot;User Registrations&quot;</span><span class="p">),</span>
                <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Security&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">menu</span><span class="o">.</span><span class="n">add_separator</span><span class="p">(</span><span class="s2">&quot;Security&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;FAB_ADD_SECURITY_PERMISSION_VIEW&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">actionmodelview</span><span class="p">,</span>
                <span class="s2">&quot;Actions&quot;</span><span class="p">,</span>
                <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;fa-lock&quot;</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="n">lazy_gettext</span><span class="p">(</span><span class="s2">&quot;Actions&quot;</span><span class="p">),</span>
                <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Security&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;FAB_ADD_SECURITY_VIEW_MENU_VIEW&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resourcemodelview</span><span class="p">,</span>
                <span class="s2">&quot;Resources&quot;</span><span class="p">,</span>
                <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;fa-list-alt&quot;</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="n">lazy_gettext</span><span class="p">(</span><span class="s2">&quot;Resources&quot;</span><span class="p">),</span>
                <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Security&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;FAB_ADD_SECURITY_PERMISSION_VIEWS_VIEW&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">permissionmodelview</span><span class="p">,</span>
                <span class="s2">&quot;Permission Pairs&quot;</span><span class="p">,</span>
                <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;fa-link&quot;</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="n">lazy_gettext</span><span class="p">(</span><span class="s2">&quot;Permissions&quot;</span><span class="p">),</span>
                <span class="n">category</span><span class="o">=</span><span class="s2">&quot;Security&quot;</span><span class="p">,</span>
            <span class="p">)</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.get_session"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.get_session">[docs]</a>    <span class="k">def</span> <span class="nf">get_session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_session</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.create_login_manager"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.create_login_manager">[docs]</a>    <span class="k">def</span> <span class="nf">create_login_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">LoginManager</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the login manager.&quot;&quot;&quot;</span>
        <span class="n">lm</span> <span class="o">=</span> <span class="n">LoginManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">app</span><span class="p">)</span>
        <span class="n">lm</span><span class="o">.</span><span class="n">anonymous_user</span> <span class="o">=</span> <span class="n">AnonymousUser</span>
        <span class="n">lm</span><span class="o">.</span><span class="n">login_view</span> <span class="o">=</span> <span class="s2">&quot;login&quot;</span>
        <span class="n">lm</span><span class="o">.</span><span class="n">user_loader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_user</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lm</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.create_jwt_manager"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.create_jwt_manager">[docs]</a>    <span class="k">def</span> <span class="nf">create_jwt_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the JWT manager.&quot;&quot;&quot;</span>
        <span class="n">jwt_manager</span> <span class="o">=</span> <span class="n">JWTManager</span><span class="p">()</span>
        <span class="n">jwt_manager</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">app</span><span class="p">)</span>
        <span class="n">jwt_manager</span><span class="o">.</span><span class="n">user_lookup_loader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_user_jwt</span><span class="p">)</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.reset_password"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.reset_password">[docs]</a>    <span class="k">def</span> <span class="nf">reset_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userid</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change/Reset a user&#39;s password for auth db.</span>

<span class="sd">        Password will be hashed and saved.</span>

<span class="sd">        :param userid: the user id to reset the password</span>
<span class="sd">        :param password: the clear text password to reset and save hashed on the db</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_by_id</span><span class="p">(</span><span class="n">userid</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">generate_password_hash</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_user_sessions</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_user</span><span class="p">(</span><span class="n">user</span><span class="p">)</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.reset_user_sessions"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.reset_user_sessions">[docs]</a>    <span class="k">def</span> <span class="nf">reset_user_sessions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="n">User</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">session_interface</span><span class="p">,</span> <span class="n">AirflowDatabaseSessionInterface</span><span class="p">):</span>
            <span class="n">interface</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">session_interface</span>
            <span class="n">session</span> <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">session</span>
            <span class="n">user_session_model</span> <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">sql_session_model</span>
            <span class="n">num_sessions</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">user_session_model</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">num_sessions</span> <span class="o">&gt;</span> <span class="n">MAX_NUM_DATABASE_USER_SESSIONS</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cli_safe_flash</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The old sessions for user </span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s2"> have &lt;b&gt;NOT&lt;/b&gt; been deleted!&lt;br&gt;&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;You have a lot (</span><span class="si">{</span><span class="n">num_sessions</span><span class="si">}</span><span class="s2">) of user sessions in the &#39;SESSIONS&#39; table in &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;your database.&lt;br&gt; &quot;</span>
                    <span class="s2">&quot;This indicates that this deployment might have an automated API calls that create &quot;</span>
                    <span class="s2">&quot;and not reuse sessions.&lt;br&gt;You should consider reusing sessions or cleaning them &quot;</span>
                    <span class="s2">&quot;periodically using db clean.&lt;br&gt;&quot;</span>
                    <span class="s2">&quot;Make sure to reset password for the user again after cleaning the session table &quot;</span>
                    <span class="s2">&quot;to remove old sessions of the user.&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;warning&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">user_session_model</span><span class="p">):</span>
                    <span class="n">session_details</span> <span class="o">=</span> <span class="n">interface</span><span class="o">.</span><span class="n">serializer</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">want_bytes</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">session_details</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;_user_id&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                        <span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cli_safe_flash</span><span class="p">(</span>
                <span class="s2">&quot;Since you are using `securecookie` session backend mechanism, we cannot prevent &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;some old sessions for user </span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s2"> to be reused.&lt;br&gt; If you want to make sure &quot;</span>
                <span class="s2">&quot;that the user is logged out from all sessions, you should consider using &quot;</span>
                <span class="s2">&quot;`database` session backend mechanism.&lt;br&gt; You can also change the &#39;secret_key` &quot;</span>
                <span class="s2">&quot;webserver configuration for all your webserver instances and restart the webserver. &quot;</span>
                <span class="s2">&quot;This however will logout all users from all sessions.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;warning&quot;</span><span class="p">,</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.load_user_jwt"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.load_user_jwt">[docs]</a>    <span class="k">def</span> <span class="nf">load_user_jwt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_jwt_header</span><span class="p">,</span> <span class="n">jwt_data</span><span class="p">):</span>
        <span class="n">identity</span> <span class="o">=</span> <span class="n">jwt_data</span><span class="p">[</span><span class="s2">&quot;sub&quot;</span><span class="p">]</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_user</span><span class="p">(</span><span class="n">identity</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">is_active</span><span class="p">:</span>
            <span class="c1"># Set flask g.user to JWT user, we can&#39;t do it on before request</span>
            <span class="n">g</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span>
            <span class="k">return</span> <span class="n">user</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_type"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_type">[docs]</a>    <span class="k">def</span> <span class="nf">auth_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the auth type.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;AUTH_TYPE&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.is_auth_limited"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.is_auth_limited">[docs]</a>    <span class="k">def</span> <span class="nf">is_auth_limited</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Is the auth rate limited.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;AUTH_RATE_LIMITED&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_rate_limit"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_rate_limit">[docs]</a>    <span class="k">def</span> <span class="nf">auth_rate_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the auth rate limit.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;AUTH_RATE_LIMIT&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_role_public"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_role_public">[docs]</a>    <span class="k">def</span> <span class="nf">auth_role_public</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the public role.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;AUTH_ROLE_PUBLIC&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.oauth_providers"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.oauth_providers">[docs]</a>    <span class="k">def</span> <span class="nf">oauth_providers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Oauth providers.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;OAUTH_PROVIDERS&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_ldap_tls_cacertdir"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_ldap_tls_cacertdir">[docs]</a>    <span class="k">def</span> <span class="nf">auth_ldap_tls_cacertdir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;LDAP TLS CA certificate directory.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;AUTH_LDAP_TLS_CACERTDIR&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_ldap_tls_cacertfile"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_ldap_tls_cacertfile">[docs]</a>    <span class="k">def</span> <span class="nf">auth_ldap_tls_cacertfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;LDAP TLS CA certificate file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;AUTH_LDAP_TLS_CACERTFILE&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_ldap_tls_certfile"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_ldap_tls_certfile">[docs]</a>    <span class="k">def</span> <span class="nf">auth_ldap_tls_certfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;LDAP TLS certificate file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;AUTH_LDAP_TLS_CERTFILE&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_ldap_tls_keyfile"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_ldap_tls_keyfile">[docs]</a>    <span class="k">def</span> <span class="nf">auth_ldap_tls_keyfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;LDAP TLS key file.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;AUTH_LDAP_TLS_KEYFILE&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_ldap_allow_self_signed"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_ldap_allow_self_signed">[docs]</a>    <span class="k">def</span> <span class="nf">auth_ldap_allow_self_signed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;LDAP allow self signed.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;AUTH_LDAP_ALLOW_SELF_SIGNED&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_ldap_tls_demand"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_ldap_tls_demand">[docs]</a>    <span class="k">def</span> <span class="nf">auth_ldap_tls_demand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;LDAP TLS demand.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;AUTH_LDAP_TLS_DEMAND&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_ldap_server"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_ldap_server">[docs]</a>    <span class="k">def</span> <span class="nf">auth_ldap_server</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the LDAP server object.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;AUTH_LDAP_SERVER&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_ldap_use_tls"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_ldap_use_tls">[docs]</a>    <span class="k">def</span> <span class="nf">auth_ldap_use_tls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Should LDAP use TLS.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;AUTH_LDAP_USE_TLS&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_ldap_bind_user"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_ldap_bind_user">[docs]</a>    <span class="k">def</span> <span class="nf">auth_ldap_bind_user</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;LDAP bind user.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;AUTH_LDAP_BIND_USER&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_ldap_bind_password"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_ldap_bind_password">[docs]</a>    <span class="k">def</span> <span class="nf">auth_ldap_bind_password</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;LDAP bind password.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;AUTH_LDAP_BIND_PASSWORD&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_ldap_search"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_ldap_search">[docs]</a>    <span class="k">def</span> <span class="nf">auth_ldap_search</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;LDAP search object.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;AUTH_LDAP_SEARCH&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_ldap_search_filter"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_ldap_search_filter">[docs]</a>    <span class="k">def</span> <span class="nf">auth_ldap_search_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;LDAP search filter.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;AUTH_LDAP_SEARCH_FILTER&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_ldap_uid_field"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_ldap_uid_field">[docs]</a>    <span class="k">def</span> <span class="nf">auth_ldap_uid_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;LDAP UID field.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;AUTH_LDAP_UID_FIELD&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_ldap_firstname_field"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_ldap_firstname_field">[docs]</a>    <span class="k">def</span> <span class="nf">auth_ldap_firstname_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;LDAP first name field.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;AUTH_LDAP_FIRSTNAME_FIELD&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_ldap_lastname_field"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_ldap_lastname_field">[docs]</a>    <span class="k">def</span> <span class="nf">auth_ldap_lastname_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;LDAP last name field.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;AUTH_LDAP_LASTNAME_FIELD&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_ldap_email_field"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_ldap_email_field">[docs]</a>    <span class="k">def</span> <span class="nf">auth_ldap_email_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;LDAP email field.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;AUTH_LDAP_EMAIL_FIELD&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_ldap_append_domain"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_ldap_append_domain">[docs]</a>    <span class="k">def</span> <span class="nf">auth_ldap_append_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;LDAP append domain.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;AUTH_LDAP_APPEND_DOMAIN&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_ldap_username_format"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_ldap_username_format">[docs]</a>    <span class="k">def</span> <span class="nf">auth_ldap_username_format</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;LDAP username format.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;AUTH_LDAP_USERNAME_FORMAT&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_ldap_group_field"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_ldap_group_field">[docs]</a>    <span class="k">def</span> <span class="nf">auth_ldap_group_field</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;LDAP group field.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;AUTH_LDAP_GROUP_FIELD&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_roles_mapping"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_roles_mapping">[docs]</a>    <span class="k">def</span> <span class="nf">auth_roles_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The mapping of auth roles.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;AUTH_ROLES_MAPPING&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_user_registration_role_jmespath"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_user_registration_role_jmespath">[docs]</a>    <span class="k">def</span> <span class="nf">auth_user_registration_role_jmespath</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The JMESPATH role to use for user registration.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;AUTH_USER_REGISTRATION_ROLE_JMESPATH&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_remote_user_env_var"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_remote_user_env_var">[docs]</a>    <span class="k">def</span> <span class="nf">auth_remote_user_env_var</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;AUTH_REMOTE_USER_ENV_VAR&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.api_login_allow_multiple_providers"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.api_login_allow_multiple_providers">[docs]</a>    <span class="k">def</span> <span class="nf">api_login_allow_multiple_providers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;AUTH_API_LOGIN_ALLOW_MULTIPLE_PROVIDERS&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_username_ci"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_username_ci">[docs]</a>    <span class="k">def</span> <span class="nf">auth_username_ci</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the auth username for CI.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;AUTH_USERNAME_CI&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_ldap_bind_first"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_ldap_bind_first">[docs]</a>    <span class="k">def</span> <span class="nf">auth_ldap_bind_first</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;LDAP bind first.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;AUTH_LDAP_BIND_FIRST&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.openid_providers"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.openid_providers">[docs]</a>    <span class="k">def</span> <span class="nf">openid_providers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Openid providers.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;OPENID_PROVIDERS&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_type_provider_name"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_type_provider_name">[docs]</a>    <span class="k">def</span> <span class="nf">auth_type_provider_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">provider_to_auth_type</span> <span class="o">=</span> <span class="p">{</span><span class="n">AUTH_DB</span><span class="p">:</span> <span class="s2">&quot;db&quot;</span><span class="p">,</span> <span class="n">AUTH_LDAP</span><span class="p">:</span> <span class="s2">&quot;ldap&quot;</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">provider_to_auth_type</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_type</span><span class="p">)</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_user_registration"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_user_registration">[docs]</a>    <span class="k">def</span> <span class="nf">auth_user_registration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Will user self registration be allowed.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;AUTH_USER_REGISTRATION&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_user_registration_role"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_user_registration_role">[docs]</a>    <span class="k">def</span> <span class="nf">auth_user_registration_role</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The default user self registration role.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;AUTH_USER_REGISTRATION_ROLE&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_roles_sync_at_login"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_roles_sync_at_login">[docs]</a>    <span class="k">def</span> <span class="nf">auth_roles_sync_at_login</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Should roles be synced at login.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;AUTH_ROLES_SYNC_AT_LOGIN&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_role_admin"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_role_admin">[docs]</a>    <span class="k">def</span> <span class="nf">auth_role_admin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the admin role.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;AUTH_ROLE_ADMIN&quot;</span><span class="p">]</span></div>

    <span class="nd">@property</span>
    <span class="nd">@deprecated</span><span class="p">(</span>
        <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;The &#39;oauth_whitelists&#39; property is deprecated. Please use &#39;oauth_allow_list&#39; instead.&quot;</span><span class="p">,</span>
        <span class="n">category</span><span class="o">=</span><span class="n">AirflowProviderDeprecationWarning</span><span class="p">,</span>
    <span class="p">)</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.oauth_whitelists"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.oauth_whitelists">[docs]</a>    <span class="k">def</span> <span class="nf">oauth_whitelists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">oauth_allow_list</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.create_builtin_roles"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.create_builtin_roles">[docs]</a>    <span class="k">def</span> <span class="nf">create_builtin_roles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return FAB builtin roles.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;FAB_ROLES&quot;</span><span class="p">,</span> <span class="p">{})</span></div>

    <span class="nd">@property</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.builtin_roles"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.builtin_roles">[docs]</a>    <span class="k">def</span> <span class="nf">builtin_roles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the builtin roles.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_builtin_roles</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.create_admin_standalone"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.create_admin_standalone">[docs]</a>    <span class="k">def</span> <span class="nf">create_admin_standalone</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an Admin user with a random password so that users can access airflow.&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">airflow.configuration</span> <span class="kn">import</span> <span class="n">AIRFLOW_HOME</span><span class="p">,</span> <span class="n">make_group_other_inaccessible</span>

        <span class="n">user_name</span> <span class="o">=</span> <span class="s2">&quot;admin&quot;</span>

        <span class="c1"># We want a streamlined first-run experience, but we do not want to</span>
        <span class="c1"># use a preset password as people will inevitably run this on a public</span>
        <span class="c1"># server. Thus, we make a random password and store it in AIRFLOW_HOME,</span>
        <span class="c1"># with the reasoning that if you can read that directory, you can see</span>
        <span class="c1"># the database credentials anyway.</span>
        <span class="n">password_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">AIRFLOW_HOME</span><span class="p">,</span> <span class="s2">&quot;standalone_admin_password.txt&quot;</span><span class="p">)</span>

        <span class="n">user_exists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_user</span><span class="p">(</span><span class="n">user_name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">we_know_password</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">password_path</span><span class="p">)</span>

        <span class="c1"># If the user does not exist, make a random password and make it</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_exists</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FlaskAppBuilder Authentication Manager: Creating </span><span class="si">{</span><span class="n">user_name</span><span class="si">}</span><span class="s2"> user&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">role</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_role</span><span class="p">(</span><span class="s2">&quot;Admin&quot;</span><span class="p">))</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AirflowException</span><span class="p">(</span><span class="s2">&quot;Unable to find role &#39;Admin&#39;&quot;</span><span class="p">)</span>
            <span class="c1"># password does not contain visually similar characters: ijlIJL1oO0</span>
            <span class="n">password</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="s2">&quot;abcdefghkmnpqrstuvwxyzABCDEFGHKMNPQRSTUVWXYZ23456789&quot;</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">16</span><span class="p">))</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">password_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
            <span class="n">make_group_other_inaccessible</span><span class="p">(</span><span class="n">password_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_user</span><span class="p">(</span><span class="n">user_name</span><span class="p">,</span> <span class="s2">&quot;Admin&quot;</span><span class="p">,</span> <span class="s2">&quot;User&quot;</span><span class="p">,</span> <span class="s2">&quot;admin@example.com&quot;</span><span class="p">,</span> <span class="n">role</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FlaskAppBuilder Authentication Manager: Created </span><span class="si">{</span><span class="n">user_name</span><span class="si">}</span><span class="s2"> user&quot;</span><span class="p">)</span>
        <span class="c1"># If the user does exist, and we know its password, read the password</span>
        <span class="k">elif</span> <span class="n">user_exists</span> <span class="ow">and</span> <span class="n">we_know_password</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">password_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">password</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="c1"># Otherwise we don&#39;t know the password</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">password</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">user_name</span><span class="p">,</span> <span class="n">password</span></div>

    <span class="k">def</span> <span class="nf">_init_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize config.</span>

<span class="sd">        :meta private:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">app</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span>
        <span class="c1"># Base Security Config</span>
        <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;AUTH_ROLE_ADMIN&quot;</span><span class="p">,</span> <span class="s2">&quot;Admin&quot;</span><span class="p">)</span>
        <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;AUTH_TYPE&quot;</span><span class="p">,</span> <span class="n">AUTH_DB</span><span class="p">)</span>
        <span class="c1"># Self Registration</span>
        <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;AUTH_USER_REGISTRATION&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;AUTH_USER_REGISTRATION_ROLE&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_role_public</span><span class="p">)</span>
        <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;AUTH_USER_REGISTRATION_ROLE_JMESPATH&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># Role Mapping</span>
        <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;AUTH_ROLES_MAPPING&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;AUTH_ROLES_SYNC_AT_LOGIN&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;AUTH_API_LOGIN_ALLOW_MULTIPLE_PROVIDERS&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="c1"># LDAP Config</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_type</span> <span class="o">==</span> <span class="n">AUTH_LDAP</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;AUTH_LDAP_SERVER&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No AUTH_LDAP_SERVER defined on config with AUTH_LDAP authentication type.&quot;</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;AUTH_LDAP_SEARCH&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;AUTH_LDAP_SEARCH_FILTER&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;AUTH_LDAP_APPEND_DOMAIN&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;AUTH_LDAP_USERNAME_FORMAT&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;AUTH_LDAP_BIND_USER&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;AUTH_LDAP_BIND_PASSWORD&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="c1"># TLS options</span>
            <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;AUTH_LDAP_USE_TLS&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;AUTH_LDAP_ALLOW_SELF_SIGNED&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;AUTH_LDAP_TLS_DEMAND&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;AUTH_LDAP_TLS_CACERTDIR&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;AUTH_LDAP_TLS_CACERTFILE&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;AUTH_LDAP_TLS_CERTFILE&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;AUTH_LDAP_TLS_KEYFILE&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="c1"># Mapping options</span>
            <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;AUTH_LDAP_UID_FIELD&quot;</span><span class="p">,</span> <span class="s2">&quot;uid&quot;</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;AUTH_LDAP_GROUP_FIELD&quot;</span><span class="p">,</span> <span class="s2">&quot;memberOf&quot;</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;AUTH_LDAP_FIRSTNAME_FIELD&quot;</span><span class="p">,</span> <span class="s2">&quot;givenName&quot;</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;AUTH_LDAP_LASTNAME_FIELD&quot;</span><span class="p">,</span> <span class="s2">&quot;sn&quot;</span><span class="p">)</span>
            <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;AUTH_LDAP_EMAIL_FIELD&quot;</span><span class="p">,</span> <span class="s2">&quot;mail&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_type</span> <span class="o">==</span> <span class="n">AUTH_REMOTE_USER</span><span class="p">:</span>
            <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;AUTH_REMOTE_USER_ENV_VAR&quot;</span><span class="p">,</span> <span class="s2">&quot;REMOTE_USER&quot;</span><span class="p">)</span>

        <span class="c1"># Rate limiting</span>
        <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;AUTH_RATE_LIMITED&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;AUTH_RATE_LIMIT&quot;</span><span class="p">,</span> <span class="s2">&quot;5 per 40 second&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_init_auth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize authentication configuration.</span>

<span class="sd">        :meta private:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">app</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_type</span> <span class="o">==</span> <span class="n">AUTH_OID</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">flask_openid</span> <span class="kn">import</span> <span class="n">OpenID</span>

            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;AUTH_OID is deprecated and will be removed in version 5. &quot;</span>
                <span class="s2">&quot;Migrate to other authentication methods.&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">oid</span> <span class="o">=</span> <span class="n">OpenID</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_type</span> <span class="o">==</span> <span class="n">AUTH_OAUTH</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">authlib.integrations.flask_client</span> <span class="kn">import</span> <span class="n">OAuth</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">oauth</span> <span class="o">=</span> <span class="n">OAuth</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">oauth_remotes</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">provider</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">oauth_providers</span><span class="p">:</span>
                <span class="n">provider_name</span> <span class="o">=</span> <span class="n">provider</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;OAuth providers init </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">provider_name</span><span class="p">)</span>
                <span class="n">obj_provider</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oauth</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">provider_name</span><span class="p">,</span> <span class="o">**</span><span class="n">provider</span><span class="p">[</span><span class="s2">&quot;remote_app&quot;</span><span class="p">])</span>
                <span class="n">obj_provider</span><span class="o">.</span><span class="n">_tokengetter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oauth_token_getter</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">oauth_user_info</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">oauth_user_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_oauth_user_info</span>
                <span class="c1"># Whitelist only users with matching emails</span>
                <span class="k">if</span> <span class="s2">&quot;whitelist&quot;</span> <span class="ow">in</span> <span class="n">provider</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">oauth_allow_list</span><span class="p">[</span><span class="n">provider_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">provider</span><span class="p">[</span><span class="s2">&quot;whitelist&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">oauth_remotes</span><span class="p">[</span><span class="n">provider_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj_provider</span>

    <span class="k">def</span> <span class="nf">_init_data_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">user_data_model</span> <span class="o">=</span> <span class="n">SQLAInterface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_model</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_type</span> <span class="o">==</span> <span class="n">const</span><span class="o">.</span><span class="n">AUTH_DB</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">userdbmodelview</span><span class="o">.</span><span class="n">datamodel</span> <span class="o">=</span> <span class="n">user_data_model</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_type</span> <span class="o">==</span> <span class="n">const</span><span class="o">.</span><span class="n">AUTH_LDAP</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">userldapmodelview</span><span class="o">.</span><span class="n">datamodel</span> <span class="o">=</span> <span class="n">user_data_model</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_type</span> <span class="o">==</span> <span class="n">const</span><span class="o">.</span><span class="n">AUTH_OID</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">useroidmodelview</span><span class="o">.</span><span class="n">datamodel</span> <span class="o">=</span> <span class="n">user_data_model</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_type</span> <span class="o">==</span> <span class="n">const</span><span class="o">.</span><span class="n">AUTH_OAUTH</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">useroauthmodelview</span><span class="o">.</span><span class="n">datamodel</span> <span class="o">=</span> <span class="n">user_data_model</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_type</span> <span class="o">==</span> <span class="n">const</span><span class="o">.</span><span class="n">AUTH_REMOTE_USER</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">userremoteusermodelview</span><span class="o">.</span><span class="n">datamodel</span> <span class="o">=</span> <span class="n">user_data_model</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">userstatschartview</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">userstatschartview</span><span class="o">.</span><span class="n">datamodel</span> <span class="o">=</span> <span class="n">user_data_model</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_user_registration</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">registerusermodelview</span><span class="o">.</span><span class="n">datamodel</span> <span class="o">=</span> <span class="n">SQLAInterface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">registeruser_model</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rolemodelview</span><span class="o">.</span><span class="n">datamodel</span> <span class="o">=</span> <span class="n">SQLAInterface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">role_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionmodelview</span><span class="o">.</span><span class="n">datamodel</span> <span class="o">=</span> <span class="n">SQLAInterface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resourcemodelview</span><span class="o">.</span><span class="n">datamodel</span> <span class="o">=</span> <span class="n">SQLAInterface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resource_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">permissionmodelview</span><span class="o">.</span><span class="n">datamodel</span> <span class="o">=</span> <span class="n">SQLAInterface</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">permission_model</span><span class="p">)</span>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.create_db"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.create_db">[docs]</a>    <span class="k">def</span> <span class="nf">create_db</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create the database.</span>

<span class="sd">        Creates admin and public roles if they don&#39;t exist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">update_perms</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Skipping db since appbuilder disables update_perms&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">get_bind</span><span class="p">(</span><span class="n">mapper</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clause</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">inspector</span> <span class="o">=</span> <span class="n">inspect</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;ab_user&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">inspector</span><span class="o">.</span><span class="n">get_table_names</span><span class="p">():</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">LOGMSG_INF_SEC_NO_DB</span><span class="p">)</span>
                <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">LOGMSG_INF_SEC_ADD_DB</span><span class="p">)</span>

            <span class="n">roles_mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;FAB_ROLES_MAPPING&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="k">for</span> <span class="n">pk</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">roles_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_role</span><span class="p">(</span><span class="n">pk</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">role_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_builtin_roles</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_role</span><span class="p">(</span><span class="n">role_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_role_admin</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_builtin_roles</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_role</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_role_admin</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_role_public</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_role</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_role_public</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_users</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_role_public</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_role_admin</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">LOGMSG_WAR_SEC_NO_USER</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">LOGMSG_ERR_SEC_CREATE_DB</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.get_readable_dags"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.get_readable_dags">[docs]</a>    <span class="k">def</span> <span class="nf">get_readable_dags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">DagModel</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the DAGs readable by authenticated user.&quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;`get_readable_dags` has been deprecated. Please use `get_auth_manager().get_permitted_dag_ids` &quot;</span>
            <span class="s2">&quot;instead.&quot;</span><span class="p">,</span>
            <span class="n">RemovedInAirflow3Warning</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">RemovedInAirflow3Warning</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_accessible_dags</span><span class="p">([</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">],</span> <span class="n">user</span><span class="p">)</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.get_editable_dags"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.get_editable_dags">[docs]</a>    <span class="k">def</span> <span class="nf">get_editable_dags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">DagModel</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the DAGs editable by authenticated user.&quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;`get_editable_dags` has been deprecated. Please use `get_auth_manager().get_permitted_dag_ids` &quot;</span>
            <span class="s2">&quot;instead.&quot;</span><span class="p">,</span>
            <span class="n">RemovedInAirflow3Warning</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">RemovedInAirflow3Warning</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_accessible_dags</span><span class="p">([</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_EDIT</span><span class="p">],</span> <span class="n">user</span><span class="p">)</span></div>

    <span class="nd">@provide_session</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.get_accessible_dags"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.get_accessible_dags">[docs]</a>    <span class="k">def</span> <span class="nf">get_accessible_dags</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">user_actions</span><span class="p">:</span> <span class="n">Container</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">user</span><span class="p">,</span>
        <span class="n">session</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="n">NEW_SESSION</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">DagModel</span><span class="p">]:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;`get_accessible_dags` has been deprecated. Please use &quot;</span>
            <span class="s2">&quot;`get_auth_manager().get_permitted_dag_ids` instead.&quot;</span><span class="p">,</span>
            <span class="n">RemovedInAirflow3Warning</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">dag_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_accessible_dag_ids</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">user_actions</span><span class="p">,</span> <span class="n">session</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">DagModel</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">DagModel</span><span class="o">.</span><span class="n">dag_id</span><span class="o">.</span><span class="n">in_</span><span class="p">(</span><span class="n">dag_ids</span><span class="p">)))</span></div>

    <span class="nd">@provide_session</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.get_accessible_dag_ids"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.get_accessible_dag_ids">[docs]</a>    <span class="k">def</span> <span class="nf">get_accessible_dag_ids</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">user</span><span class="p">,</span>
        <span class="n">user_actions</span><span class="p">:</span> <span class="n">Container</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">session</span><span class="p">:</span> <span class="n">Session</span> <span class="o">=</span> <span class="n">NEW_SESSION</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;`get_accessible_dag_ids` has been deprecated. Please use &quot;</span>
            <span class="s2">&quot;`get_auth_manager().get_permitted_dag_ids` instead.&quot;</span><span class="p">,</span>
            <span class="n">RemovedInAirflow3Warning</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_actions</span><span class="p">:</span>
            <span class="n">user_actions</span> <span class="o">=</span> <span class="p">[</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_EDIT</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">]</span>
        <span class="n">method_from_fab_action_map</span> <span class="o">=</span> <span class="n">get_method_from_fab_action_map</span><span class="p">()</span>
        <span class="n">user_methods</span><span class="p">:</span> <span class="n">Container</span><span class="p">[</span><span class="n">ResourceMethod</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">method_from_fab_action_map</span><span class="p">[</span><span class="n">action</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">method_from_fab_action_map</span>
            <span class="k">if</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">user_actions</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">get_auth_manager</span><span class="p">()</span><span class="o">.</span><span class="n">get_permitted_dag_ids</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="n">user_methods</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.get_readable_dag_ids"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.get_readable_dag_ids">[docs]</a>    <span class="k">def</span> <span class="nf">get_readable_dag_ids</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the DAG IDs readable by authenticated user.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">get_auth_manager</span><span class="p">()</span><span class="o">.</span><span class="n">get_permitted_dag_ids</span><span class="p">(</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">],</span> <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.get_editable_dag_ids"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.get_editable_dag_ids">[docs]</a>    <span class="k">def</span> <span class="nf">get_editable_dag_ids</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the DAG IDs editable by authenticated user.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">get_auth_manager</span><span class="p">()</span><span class="o">.</span><span class="n">get_permitted_dag_ids</span><span class="p">(</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;PUT&quot;</span><span class="p">],</span> <span class="n">user</span><span class="o">=</span><span class="n">user</span><span class="p">)</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.can_access_some_dags"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.can_access_some_dags">[docs]</a>    <span class="k">def</span> <span class="nf">can_access_some_dags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dag_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if user has read or write access to some dags.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dag_id</span> <span class="ow">and</span> <span class="n">dag_id</span> <span class="o">!=</span> <span class="s2">&quot;~&quot;</span><span class="p">:</span>
            <span class="n">root_dag_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_root_dag_id</span><span class="p">(</span><span class="n">dag_id</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_access</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resource_name</span><span class="p">(</span><span class="n">root_dag_id</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_DAG</span><span class="p">))</span>

        <span class="n">user</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">user</span>
        <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_readable_dag_ids</span><span class="p">(</span><span class="n">user</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_editable_dag_ids</span><span class="p">(</span><span class="n">user</span><span class="p">))</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.get_all_permissions"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.get_all_permissions">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return all permissions as a set of tuples with the action and resource names.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="n">select</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action_model</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_model</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">permission_model</span><span class="o">.</span><span class="n">action</span><span class="p">)</span>
                <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">permission_model</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.create_dag_specific_permissions"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.create_dag_specific_permissions">[docs]</a>    <span class="k">def</span> <span class="nf">create_dag_specific_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add permissions to all DAGs.</span>

<span class="sd">        Creates &#39;can_read&#39;, &#39;can_edit&#39;, and &#39;can_delete&#39; permissions for all</span>
<span class="sd">        DAGs, along with any `access_control` permissions provided in them.</span>

<span class="sd">        This does iterate through ALL the DAGs, which can be slow. See `sync_perm_for_dag`</span>
<span class="sd">        if you only need to sync a single DAG.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">perms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_permissions</span><span class="p">()</span>
        <span class="n">dagbag</span> <span class="o">=</span> <span class="n">DagBag</span><span class="p">(</span><span class="n">read_dags_from_db</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">dagbag</span><span class="o">.</span><span class="n">collect_dags_from_db</span><span class="p">()</span>
        <span class="n">dags</span> <span class="o">=</span> <span class="n">dagbag</span><span class="o">.</span><span class="n">dags</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">dag</span> <span class="ow">in</span> <span class="n">dags</span><span class="p">:</span>
            <span class="c1"># TODO: Remove this when the minimum version of Airflow is bumped to 3.0</span>
            <span class="n">root_dag_id</span> <span class="o">=</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">dag</span><span class="p">,</span> <span class="s2">&quot;parent_dag&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">dag</span><span class="p">)</span><span class="o">.</span><span class="n">dag_id</span>
            <span class="k">for</span> <span class="n">resource_name</span><span class="p">,</span> <span class="n">resource_values</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_DETAILS_MAP</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">dag_resource_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resource_name</span><span class="p">(</span><span class="n">root_dag_id</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">action_name</span> <span class="ow">in</span> <span class="n">resource_values</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">action_name</span><span class="p">,</span> <span class="n">dag_resource_name</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">perms</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_merge_perm</span><span class="p">(</span><span class="n">action_name</span><span class="p">,</span> <span class="n">dag_resource_name</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">dag</span><span class="o">.</span><span class="n">access_control</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sync_perm_for_dag</span><span class="p">(</span><span class="n">root_dag_id</span><span class="p">,</span> <span class="n">dag</span><span class="o">.</span><span class="n">access_control</span><span class="p">)</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.prefixed_dag_id"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.prefixed_dag_id">[docs]</a>    <span class="k">def</span> <span class="nf">prefixed_dag_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dag_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the permission name for a DAG id.&quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;`prefixed_dag_id` has been deprecated. &quot;</span>
            <span class="s2">&quot;Please use `airflow.security.permissions.resource_name` instead.&quot;</span><span class="p">,</span>
            <span class="n">RemovedInAirflow3Warning</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">root_dag_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_root_dag_id</span><span class="p">(</span><span class="n">dag_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resource_name</span><span class="p">(</span><span class="n">root_dag_id</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_DAG</span><span class="p">)</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.is_dag_resource"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.is_dag_resource">[docs]</a>    <span class="k">def</span> <span class="nf">is_dag_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine if a resource belongs to a DAG or all DAGs.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">resource_name</span> <span class="o">==</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_DAG</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">resource_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_DAG_PREFIX</span><span class="p">)</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.sync_perm_for_dag"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.sync_perm_for_dag">[docs]</a>    <span class="k">def</span> <span class="nf">sync_perm_for_dag</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dag_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">access_control</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sync permissions for given dag id.</span>

<span class="sd">        The dag id surely exists in our dag bag as only / refresh button or DagBag will call this function.</span>

<span class="sd">        :param dag_id: the ID of the DAG whose permissions should be updated</span>
<span class="sd">        :param access_control: a dict where each key is a role name and each value can be:</span>
<span class="sd">             - a set() of DAGs resource action names (e.g. `{&#39;can_read&#39;}`)</span>
<span class="sd">             - or a dict where each key is a resource name (&#39;DAGs&#39; or &#39;DAG Runs&#39;) and each value</span>
<span class="sd">             is a set() of action names (e.g., `{&#39;DAG Runs&#39;: {&#39;can_create&#39;}, &#39;DAGs&#39;: {&#39;can_read&#39;}}`)</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">resource_name</span><span class="p">,</span> <span class="n">resource_values</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_DETAILS_MAP</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">dag_resource_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resource_name</span><span class="p">(</span><span class="n">dag_id</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">dag_action_name</span> <span class="ow">in</span> <span class="n">resource_values</span><span class="p">[</span><span class="s2">&quot;actions&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_permission</span><span class="p">(</span><span class="n">dag_action_name</span><span class="p">,</span> <span class="n">dag_resource_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">access_control</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Syncing DAG-level permissions for DAG &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">dag_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sync_dag_view_permissions</span><span class="p">(</span><span class="n">dag_id</span><span class="p">,</span> <span class="n">access_control</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Not syncing DAG-level permissions for DAG &#39;</span><span class="si">%s</span><span class="s2">&#39; as access control is unset.&quot;</span><span class="p">,</span>
                <span class="n">dag_id</span><span class="p">,</span>
            <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_resource_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dag_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the resource name from permissions.</span>

<span class="sd">        This method is to keep compatibility with new FAB versions</span>
<span class="sd">        running with old airflow versions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">permissions</span><span class="p">,</span> <span class="s2">&quot;resource_name&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">permissions</span><span class="p">,</span> <span class="s2">&quot;resource_name&quot;</span><span class="p">)(</span><span class="n">dag_id</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">permissions</span><span class="p">,</span> <span class="s2">&quot;resource_name_for_dag&quot;</span><span class="p">)(</span><span class="n">dag_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sync_dag_view_permissions</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dag_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">access_control</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the access policy on the given DAG&#39;s ViewModel.</span>

<span class="sd">        :param dag_id: the ID of the DAG whose permissions should be updated</span>
<span class="sd">        :param access_control: a dict where each key is a role name and each value is:</span>
<span class="sd">            - a dict where each key is a resource name (&#39;DAGs&#39; or &#39;DAG Runs&#39;) and each value</span>
<span class="sd">            is a set() of action names (e.g., `{&#39;DAG Runs&#39;: {&#39;can_create&#39;}, &#39;DAGs&#39;: {&#39;can_read&#39;}}`)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">_get_or_create_dag_permission</span><span class="p">(</span><span class="n">action_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dag_resource_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Permission</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">perm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_permission</span><span class="p">(</span><span class="n">action_name</span><span class="p">,</span> <span class="n">dag_resource_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">perm</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating new action &#39;</span><span class="si">%s</span><span class="s2">&#39; on resource &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">dag_resource_name</span><span class="p">)</span>
                <span class="n">perm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_permission</span><span class="p">(</span><span class="n">action_name</span><span class="p">,</span> <span class="n">dag_resource_name</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">perm</span>

        <span class="c1"># Revoking stale permissions for all possible DAG level resources</span>
        <span class="k">for</span> <span class="n">resource_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_DETAILS_MAP</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">dag_resource_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resource_name</span><span class="p">(</span><span class="n">dag_id</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">resource</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource</span><span class="p">(</span><span class="n">dag_resource_name</span><span class="p">):</span>
                <span class="n">existing_dag_perms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource_permissions</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">perm</span> <span class="ow">in</span> <span class="n">existing_dag_perms</span><span class="p">:</span>
                    <span class="n">non_admin_roles</span> <span class="o">=</span> <span class="p">[</span><span class="n">role</span> <span class="k">for</span> <span class="n">role</span> <span class="ow">in</span> <span class="n">perm</span><span class="o">.</span><span class="n">role</span> <span class="k">if</span> <span class="n">role</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;Admin&quot;</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">role</span> <span class="ow">in</span> <span class="n">non_admin_roles</span><span class="p">:</span>
                        <span class="n">target_perms_for_role</span> <span class="o">=</span> <span class="n">access_control</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">role</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">resource_name</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>
                        <span class="k">if</span> <span class="n">perm</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">target_perms_for_role</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                                <span class="s2">&quot;Revoking &#39;</span><span class="si">%s</span><span class="s2">&#39; on DAG &#39;</span><span class="si">%s</span><span class="s2">&#39; for role &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
                                <span class="n">perm</span><span class="o">.</span><span class="n">action</span><span class="p">,</span>
                                <span class="n">dag_resource_name</span><span class="p">,</span>
                                <span class="n">role</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">remove_permission_from_role</span><span class="p">(</span><span class="n">role</span><span class="p">,</span> <span class="n">perm</span><span class="p">)</span>

        <span class="c1"># Adding the access control permissions</span>
        <span class="k">for</span> <span class="n">rolename</span><span class="p">,</span> <span class="n">resource_actions</span> <span class="ow">in</span> <span class="n">access_control</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">role</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_role</span><span class="p">(</span><span class="n">rolename</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">role</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">AirflowException</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The access_control mapping for DAG &#39;</span><span class="si">{</span><span class="n">dag_id</span><span class="si">}</span><span class="s2">&#39; includes a role named &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">rolename</span><span class="si">}</span><span class="s2">&#39;, but that role does not exist&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resource_actions</span><span class="p">,</span> <span class="p">(</span><span class="nb">set</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                <span class="c1"># Support for old-style access_control where only the actions are specified</span>
                <span class="n">resource_actions</span> <span class="o">=</span> <span class="p">{</span><span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_DAG</span><span class="p">:</span> <span class="nb">set</span><span class="p">(</span><span class="n">resource_actions</span><span class="p">)}</span>

            <span class="k">for</span> <span class="n">resource_name</span><span class="p">,</span> <span class="n">actions</span> <span class="ow">in</span> <span class="n">resource_actions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">resource_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_DETAILS_MAP</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">AirflowException</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;The access_control map for DAG &#39;</span><span class="si">{</span><span class="n">dag_id</span><span class="si">}</span><span class="s2">&#39; includes the following invalid &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;resource name: &#39;</span><span class="si">{</span><span class="n">resource_name</span><span class="si">}</span><span class="s2">&#39;; &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;The set of valid resource names is: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_DETAILS_MAP</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>

                <span class="n">dag_resource_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resource_name</span><span class="p">(</span><span class="n">dag_id</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Syncing DAG-level permissions for DAG &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">dag_resource_name</span><span class="p">)</span>

                <span class="n">invalid_actions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">actions</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_DETAILS_MAP</span><span class="p">[</span><span class="n">resource_name</span><span class="p">][</span><span class="s2">&quot;actions&quot;</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">invalid_actions</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">AirflowException</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;The access_control map for DAG &#39;</span><span class="si">{</span><span class="n">dag_resource_name</span><span class="si">}</span><span class="s2">&#39; includes &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;the following invalid permissions: </span><span class="si">{</span><span class="n">invalid_actions</span><span class="si">}</span><span class="s2">; &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;The set of valid permissions is: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">RESOURCE_DETAILS_MAP</span><span class="p">[</span><span class="n">resource_name</span><span class="p">][</span><span class="s1">&#39;actions&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>

                <span class="k">for</span> <span class="n">action_name</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
                    <span class="n">dag_perm</span> <span class="o">=</span> <span class="n">_get_or_create_dag_permission</span><span class="p">(</span><span class="n">action_name</span><span class="p">,</span> <span class="n">dag_resource_name</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">dag_perm</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">add_permission_to_role</span><span class="p">(</span><span class="n">role</span><span class="p">,</span> <span class="n">dag_perm</span><span class="p">)</span>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.add_permissions_view"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.add_permissions_view">[docs]</a>    <span class="k">def</span> <span class="nf">add_permissions_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base_action_names</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">):</span>  <span class="c1"># Keep name for compatibility with FAB.</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an action on a resource to the backend.</span>

<span class="sd">        :param base_action_names:</span>
<span class="sd">            list of permissions from view (all exposed methods):</span>
<span class="sd">             &#39;can_add&#39;,&#39;can_edit&#39; etc...</span>
<span class="sd">        :param resource_name:</span>
<span class="sd">            name of the resource to add</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_resource</span><span class="p">(</span><span class="n">resource_name</span><span class="p">)</span>
        <span class="n">perms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource_permissions</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">perms</span><span class="p">:</span>
            <span class="c1"># No permissions yet on this view</span>
            <span class="k">for</span> <span class="n">action_name</span> <span class="ow">in</span> <span class="n">base_action_names</span><span class="p">:</span>
                <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_permission</span><span class="p">(</span><span class="n">action_name</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_role_admin</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">builtin_roles</span><span class="p">:</span>
                    <span class="n">admin_role</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_role</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_role_admin</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_permission_to_role</span><span class="p">(</span><span class="n">admin_role</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Permissions on this view exist but....</span>
            <span class="n">admin_role</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_role</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_role_admin</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">action_name</span> <span class="ow">in</span> <span class="n">base_action_names</span><span class="p">:</span>
                <span class="c1"># Check if base view permissions exist</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">perms_include_action</span><span class="p">(</span><span class="n">perms</span><span class="p">,</span> <span class="n">action_name</span><span class="p">):</span>
                    <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_permission</span><span class="p">(</span><span class="n">action_name</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_role_admin</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">builtin_roles</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">add_permission_to_role</span><span class="p">(</span><span class="n">admin_role</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">perm</span> <span class="ow">in</span> <span class="n">perms</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">perm</span><span class="o">.</span><span class="n">action</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># Skip this perm, it has a null permission</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">perm</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">base_action_names</span><span class="p">:</span>
                    <span class="c1"># perm to delete</span>
                    <span class="n">roles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_roles</span><span class="p">()</span>
                    <span class="c1"># del permission from all roles</span>
                    <span class="k">for</span> <span class="n">role</span> <span class="ow">in</span> <span class="n">roles</span><span class="p">:</span>
                        <span class="c1"># TODO: An action can&#39;t be removed from a role.</span>
                        <span class="c1"># This is a bug in FAB. It has been reported.</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">remove_permission_from_role</span><span class="p">(</span><span class="n">role</span><span class="p">,</span> <span class="n">perm</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">delete_permission</span><span class="p">(</span><span class="n">perm</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_role_admin</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">builtin_roles</span> <span class="ow">and</span> <span class="n">perm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">admin_role</span><span class="o">.</span><span class="n">permissions</span><span class="p">:</span>
                    <span class="c1"># Role Admin must have all permissions</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_permission_to_role</span><span class="p">(</span><span class="n">admin_role</span><span class="p">,</span> <span class="n">perm</span><span class="p">)</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.add_permissions_menu"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.add_permissions_menu">[docs]</a>    <span class="k">def</span> <span class="nf">add_permissions_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add menu_access to resource on permission_resource.</span>

<span class="sd">        :param resource_name:</span>
<span class="sd">            The resource name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_resource</span><span class="p">(</span><span class="n">resource_name</span><span class="p">)</span>
        <span class="n">perm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_permission</span><span class="p">(</span><span class="s2">&quot;menu_access&quot;</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">perm</span><span class="p">:</span>
            <span class="n">perm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_permission</span><span class="p">(</span><span class="s2">&quot;menu_access&quot;</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_role_admin</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">builtin_roles</span><span class="p">:</span>
            <span class="n">role_admin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_role</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_role_admin</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_permission_to_role</span><span class="p">(</span><span class="n">role_admin</span><span class="p">,</span> <span class="n">perm</span><span class="p">)</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.security_cleanup"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.security_cleanup">[docs]</a>    <span class="k">def</span> <span class="nf">security_cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">baseviews</span><span class="p">,</span> <span class="n">menus</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cleanup all unused permissions from the database.</span>

<span class="sd">        :param baseviews: A list of BaseViews class</span>
<span class="sd">        :param menus: Menu class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resources</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_resources</span><span class="p">()</span>
        <span class="n">roles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_roles</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">resources</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">baseview</span> <span class="ow">in</span> <span class="n">baseviews</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">resource</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">baseview</span><span class="o">.</span><span class="n">class_permission_name</span><span class="p">:</span>
                    <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">menus</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
                <span class="n">permissions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource_permissions</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">permission</span> <span class="ow">in</span> <span class="n">permissions</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">role</span> <span class="ow">in</span> <span class="n">roles</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">remove_permission_from_role</span><span class="p">(</span><span class="n">role</span><span class="p">,</span> <span class="n">permission</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">delete_permission</span><span class="p">(</span><span class="n">permission</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">resource</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delete_resource</span><span class="p">(</span><span class="n">resource</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.sync_roles"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.sync_roles">[docs]</a>    <span class="k">def</span> <span class="nf">sync_roles</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize default and custom roles with related permissions.</span>

<span class="sd">        1. Init the default role(Admin, Viewer, User, Op, public)</span>
<span class="sd">           with related permissions.</span>
<span class="sd">        2. Init the custom role(dag-user) with related permissions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create global all-dag permissions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_perm_vm_for_all_dag</span><span class="p">()</span>

        <span class="c1"># Sync the default roles (Admin, Viewer, User, Op, public) with related permissions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bulk_sync_roles</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ROLE_CONFIGS</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_homepage_access_to_custom_roles</span><span class="p">()</span>
        <span class="c1"># init existing roles, the rest role could be created through UI.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_admin_permission</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clean_perms</span><span class="p">()</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.create_perm_vm_for_all_dag"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.create_perm_vm_for_all_dag">[docs]</a>    <span class="k">def</span> <span class="nf">create_perm_vm_for_all_dag</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create perm-vm if not exist and insert into FAB security model for all-dags.&quot;&quot;&quot;</span>
        <span class="c1"># create perm for global logical dag</span>
        <span class="k">for</span> <span class="n">resource_name</span><span class="p">,</span> <span class="n">action_name</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DAG_RESOURCES</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">DAG_ACTIONS</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_merge_perm</span><span class="p">(</span><span class="n">action_name</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.add_homepage_access_to_custom_roles"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.add_homepage_access_to_custom_roles">[docs]</a>    <span class="k">def</span> <span class="nf">add_homepage_access_to_custom_roles</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add Website.can_read access to all custom roles.&quot;&quot;&quot;</span>
        <span class="n">website_permission</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_permission</span><span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_WEBSITE</span><span class="p">)</span>
        <span class="n">custom_roles</span> <span class="o">=</span> <span class="p">[</span><span class="n">role</span> <span class="k">for</span> <span class="n">role</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_roles</span><span class="p">()</span> <span class="k">if</span> <span class="n">role</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">EXISTING_ROLES</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">role</span> <span class="ow">in</span> <span class="n">custom_roles</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_permission_to_role</span><span class="p">(</span><span class="n">role</span><span class="p">,</span> <span class="n">website_permission</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.update_admin_permission"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.update_admin_permission">[docs]</a>    <span class="k">def</span> <span class="nf">update_admin_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add missing permissions to the table for admin.</span>

<span class="sd">        Admin should get all the permissions, except the dag permissions</span>
<span class="sd">        because Admin already has Dags permission.</span>
<span class="sd">        Add the missing ones to the table for admin.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_session</span>
        <span class="n">prefixes</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">permissions</span><span class="p">,</span> <span class="s2">&quot;PREFIX_LIST&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_DAG_PREFIX</span><span class="p">])</span>
        <span class="n">dag_resources</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span>
            <span class="n">select</span><span class="p">(</span><span class="n">Resource</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">or_</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">Resource</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">prefixes</span><span class="p">]))</span>
        <span class="p">)</span>
        <span class="n">resource_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">resource</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">resource</span> <span class="ow">in</span> <span class="n">dag_resources</span><span class="p">]</span>

        <span class="n">perms</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span><span class="n">select</span><span class="p">(</span><span class="n">Permission</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">Permission</span><span class="o">.</span><span class="n">resource_id</span><span class="o">.</span><span class="n">in_</span><span class="p">(</span><span class="n">resource_ids</span><span class="p">)))</span>
        <span class="n">perms</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">perms</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">action</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">resource</span><span class="p">]</span>

        <span class="n">admin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_role</span><span class="p">(</span><span class="s2">&quot;Admin&quot;</span><span class="p">)</span>
        <span class="n">admin</span><span class="o">.</span><span class="n">permissions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">permissions</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">perms</span><span class="p">))</span>

        <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.clean_perms"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.clean_perms">[docs]</a>    <span class="k">def</span> <span class="nf">clean_perms</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;FAB leaves faulty permissions that need to be cleaned up.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Cleaning faulty perms&quot;</span><span class="p">)</span>
        <span class="n">sesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_session</span>
        <span class="n">perms</span> <span class="o">=</span> <span class="n">sesh</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Permission</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
            <span class="n">or_</span><span class="p">(</span>
                <span class="n">Permission</span><span class="o">.</span><span class="n">action</span> <span class="o">==</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># noqa: E711</span>
                <span class="n">Permission</span><span class="o">.</span><span class="n">resource</span> <span class="o">==</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># noqa: E711</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># Since FAB doesn&#39;t define ON DELETE CASCADE on these tables, we need</span>
        <span class="c1"># to delete the _object_ so that SQLA knows to delete the many-to-many</span>
        <span class="c1"># relationship object too. :(</span>

        <span class="n">deleted_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">perm</span> <span class="ow">in</span> <span class="n">perms</span><span class="p">:</span>
            <span class="n">sesh</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">perm</span><span class="p">)</span>
            <span class="n">deleted_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">sesh</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">deleted_count</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleted </span><span class="si">%s</span><span class="s2"> faulty permissions&quot;</span><span class="p">,</span> <span class="n">deleted_count</span><span class="p">)</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.permission_exists_in_one_or_more_roles"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.permission_exists_in_one_or_more_roles">[docs]</a>    <span class="k">def</span> <span class="nf">permission_exists_in_one_or_more_roles</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">action_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">role_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Efficiently check if a certain permission exists on a list of role ids; used by `has_access`.</span>

<span class="sd">        :param resource_name: The view&#39;s name to check if exists on one of the roles</span>
<span class="sd">        :param action_name: The permission name to check if exists</span>
<span class="sd">        :param role_ids: a list of Role ids</span>
<span class="sd">        :return: Boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">q</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">permission_model</span><span class="p">)</span>
            <span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">assoc_permission_role</span><span class="p">,</span>
                <span class="n">and_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">permission_model</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">assoc_permission_role</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">permission_view_id</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">role_model</span><span class="p">)</span>
            <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action_model</span><span class="p">)</span>
            <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resource_model</span><span class="p">)</span>
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resource_model</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">resource_name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">action_model</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">action_name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">role_model</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">in_</span><span class="p">(</span><span class="n">role_ids</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">exists</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="c1"># Special case for MSSQL/Oracle (works on PG and MySQL &gt; 8)</span>
        <span class="c1"># Note: We need to keep MSSQL compatibility as long as this provider package</span>
        <span class="c1">#       might still be updated by Airflow prior 2.9.0 users with MSSQL</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">bind</span><span class="o">.</span><span class="n">dialect</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;mssql&quot;</span><span class="p">,</span> <span class="s2">&quot;oracle&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">literal</span><span class="p">(</span><span class="kc">True</span><span class="p">))</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">scalar</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">.</span><span class="n">scalar</span><span class="p">()</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.perms_include_action"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.perms_include_action">[docs]</a>    <span class="k">def</span> <span class="nf">perms_include_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">perms</span><span class="p">,</span> <span class="n">action_name</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">perm</span><span class="o">.</span><span class="n">action</span> <span class="ow">and</span> <span class="n">perm</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">action_name</span> <span class="k">for</span> <span class="n">perm</span> <span class="ow">in</span> <span class="n">perms</span><span class="p">)</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.init_role"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.init_role">[docs]</a>    <span class="k">def</span> <span class="nf">init_role</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">role_name</span><span class="p">,</span> <span class="n">perms</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the role with actions and related resources.</span>

<span class="sd">        :param role_name:</span>
<span class="sd">        :param perms:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;`init_role` has been deprecated. Please use `bulk_sync_roles` instead.&quot;</span><span class="p">,</span>
            <span class="n">RemovedInAirflow3Warning</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bulk_sync_roles</span><span class="p">([{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="n">role_name</span><span class="p">,</span> <span class="s2">&quot;perms&quot;</span><span class="p">:</span> <span class="n">perms</span><span class="p">}])</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.bulk_sync_roles"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.bulk_sync_roles">[docs]</a>    <span class="k">def</span> <span class="nf">bulk_sync_roles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">roles</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sync the provided roles and permissions.&quot;&quot;&quot;</span>
        <span class="n">existing_roles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_all_roles_with_permissions</span><span class="p">()</span>
        <span class="n">non_dag_perms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_all_non_dag_permissions</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">config</span> <span class="ow">in</span> <span class="n">roles</span><span class="p">:</span>
            <span class="n">role_name</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;role&quot;</span><span class="p">]</span>
            <span class="n">perms</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;perms&quot;</span><span class="p">]</span>
            <span class="n">role</span> <span class="o">=</span> <span class="n">existing_roles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">role_name</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_role</span><span class="p">(</span><span class="n">role_name</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">resource_name</span> <span class="ow">in</span> <span class="n">perms</span><span class="p">:</span>
                <span class="n">perm</span> <span class="o">=</span> <span class="n">non_dag_perms</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">action_name</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">))</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_permission</span><span class="p">(</span>
                    <span class="n">action_name</span><span class="p">,</span> <span class="n">resource_name</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">perm</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">role</span><span class="o">.</span><span class="n">permissions</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_permission_to_role</span><span class="p">(</span><span class="n">role</span><span class="p">,</span> <span class="n">perm</span><span class="p">)</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.sync_resource_permissions"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.sync_resource_permissions">[docs]</a>    <span class="k">def</span> <span class="nf">sync_resource_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">perms</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Populate resource-based permissions.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">perms</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">resource_name</span> <span class="ow">in</span> <span class="n">perms</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_resource</span><span class="p">(</span><span class="n">resource_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_permission</span><span class="p">(</span><span class="n">action_name</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">)</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    -----------</span>
<span class="sd">    Role entity</span>
<span class="sd">    -----------</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.update_role"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.update_role">[docs]</a>    <span class="k">def</span> <span class="nf">update_role</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">role_id</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Role</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update a role in the database.&quot;&quot;&quot;</span>
        <span class="n">role</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">role_model</span><span class="p">,</span> <span class="n">role_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">role</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">role</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">role</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">LOGMSG_INF_SEC_UPD_ROLE</span><span class="p">,</span> <span class="n">role</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">LOGMSG_ERR_SEC_UPD_ROLE</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">role</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.add_role"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.add_role">[docs]</a>    <span class="k">def</span> <span class="nf">add_role</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Role</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a role in the database.&quot;&quot;&quot;</span>
        <span class="n">role</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_role</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">role</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">role</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">role_model</span><span class="p">()</span>
                <span class="n">role</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">role</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">LOGMSG_INF_SEC_ADD_ROLE</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">role</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">LOGMSG_ERR_SEC_ADD_ROLE</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">role</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.find_role"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.find_role">[docs]</a>    <span class="k">def</span> <span class="nf">find_role</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find a role in the database.</span>

<span class="sd">        :param name: the role name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">role_model</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">one_or_none</span><span class="p">()</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.get_all_roles"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.get_all_roles">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_roles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">role_model</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.delete_role"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.delete_role">[docs]</a>    <span class="k">def</span> <span class="nf">delete_role</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">role_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete the given Role.</span>

<span class="sd">        :param role_name: the name of a role in the ab_role table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span>
        <span class="n">role</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Role</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Role</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">role_name</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">role</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Deleting role &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">role_name</span><span class="p">)</span>
            <span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">role</span><span class="p">)</span>
            <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">AirflowException</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Role named &#39;</span><span class="si">{</span><span class="n">role_name</span><span class="si">}</span><span class="s2">&#39; does not exist&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.get_roles_from_keys"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.get_roles_from_keys">[docs]</a>    <span class="k">def</span> <span class="nf">get_roles_from_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">role_keys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="n">Role</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct a list of FAB role objects, from a list of keys.</span>

<span class="sd">        NOTE:</span>
<span class="sd">        - keys are things like: &quot;LDAP group DNs&quot; or &quot;OAUTH group names&quot;</span>
<span class="sd">        - we use AUTH_ROLES_MAPPING to map from keys, to FAB role names</span>

<span class="sd">        :param role_keys: the list of FAB role keys</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_roles</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">_role_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">role_keys</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">role_key</span><span class="p">,</span> <span class="n">fab_role_names</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_roles_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">role_key</span> <span class="ow">in</span> <span class="n">_role_keys</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">fab_role_name</span> <span class="ow">in</span> <span class="n">fab_role_names</span><span class="p">:</span>
                    <span class="n">fab_role</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_role</span><span class="p">(</span><span class="n">fab_role_name</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">fab_role</span><span class="p">:</span>
                        <span class="n">_roles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">fab_role</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Can&#39;t find role specified in AUTH_ROLES_MAPPING: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fab_role_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_roles</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.get_public_role"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.get_public_role">[docs]</a>    <span class="k">def</span> <span class="nf">get_public_role</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">role_model</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_role_public</span><span class="p">)</span><span class="o">.</span><span class="n">one_or_none</span><span class="p">()</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    -----------</span>
<span class="sd">    User entity</span>
<span class="sd">    -----------</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.add_user"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.add_user">[docs]</a>    <span class="k">def</span> <span class="nf">add_user</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">username</span><span class="p">,</span>
        <span class="n">first_name</span><span class="p">,</span>
        <span class="n">last_name</span><span class="p">,</span>
        <span class="n">email</span><span class="p">,</span>
        <span class="n">role</span><span class="p">,</span>
        <span class="n">password</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">hashed_password</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a user.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_model</span><span class="p">()</span>
            <span class="n">user</span><span class="o">.</span><span class="n">first_name</span> <span class="o">=</span> <span class="n">first_name</span>
            <span class="n">user</span><span class="o">.</span><span class="n">last_name</span> <span class="o">=</span> <span class="n">last_name</span>
            <span class="n">user</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
            <span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span>
            <span class="n">user</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
            <span class="n">user</span><span class="o">.</span><span class="n">roles</span> <span class="o">=</span> <span class="n">role</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">role</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">role</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">hashed_password</span><span class="p">:</span>
                <span class="n">user</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">hashed_password</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">user</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">generate_password_hash</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">LOGMSG_INF_SEC_ADD_USER</span><span class="p">,</span> <span class="n">username</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">user</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">LOGMSG_ERR_SEC_ADD_USER</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.load_user"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.load_user">[docs]</a>    <span class="k">def</span> <span class="nf">load_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_by_id</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">user_id</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">is_active</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">user</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.get_user_by_id"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.get_user_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_user_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_model</span><span class="p">,</span> <span class="n">pk</span><span class="p">)</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.count_users"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.count_users">[docs]</a>    <span class="k">def</span> <span class="nf">count_users</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the number of users in the database.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_model</span><span class="o">.</span><span class="n">id</span><span class="p">))</span><span class="o">.</span><span class="n">scalar</span><span class="p">()</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.add_register_user"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.add_register_user">[docs]</a>    <span class="k">def</span> <span class="nf">add_register_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">hashed_password</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a registration request for the user.</span>

<span class="sd">        :rtype : RegisterUser</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">register_user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">registeruser_model</span><span class="p">()</span>
        <span class="n">register_user</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="n">register_user</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span>
        <span class="n">register_user</span><span class="o">.</span><span class="n">first_name</span> <span class="o">=</span> <span class="n">first_name</span>
        <span class="n">register_user</span><span class="o">.</span><span class="n">last_name</span> <span class="o">=</span> <span class="n">last_name</span>
        <span class="k">if</span> <span class="n">hashed_password</span><span class="p">:</span>
            <span class="n">register_user</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">hashed_password</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">register_user</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">generate_password_hash</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
        <span class="n">register_user</span><span class="o">.</span><span class="n">registration_hash</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid1</span><span class="p">())</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">register_user</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">register_user</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">LOGMSG_ERR_SEC_ADD_REGISTER_USER</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.find_user"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.find_user">[docs]</a>    <span class="k">def</span> <span class="nf">find_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find user by username or email.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">username</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_username_ci</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_model</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">lower</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_model</span><span class="o">.</span><span class="n">username</span><span class="p">)</span> <span class="o">==</span> <span class="n">func</span><span class="o">.</span><span class="n">lower</span><span class="p">(</span><span class="n">username</span><span class="p">))</span>
                        <span class="o">.</span><span class="n">one_or_none</span><span class="p">()</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_model</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">lower</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_model</span><span class="o">.</span><span class="n">username</span><span class="p">)</span> <span class="o">==</span> <span class="n">func</span><span class="o">.</span><span class="n">lower</span><span class="p">(</span><span class="n">username</span><span class="p">))</span>
                        <span class="o">.</span><span class="n">one_or_none</span><span class="p">()</span>
                    <span class="p">)</span>
            <span class="k">except</span> <span class="n">MultipleResultsFound</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Multiple results found for user </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">username</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">email</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_model</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">)</span><span class="o">.</span><span class="n">one_or_none</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">MultipleResultsFound</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Multiple results found for user with email </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">email</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.find_register_user"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.find_register_user">[docs]</a>    <span class="k">def</span> <span class="nf">find_register_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">registration_hash</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span>
            <span class="n">select</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">registeruser_mode</span><span class="p">)</span>
            <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">registeruser_model</span><span class="o">.</span><span class="n">registration_hash</span> <span class="o">==</span> <span class="n">registration_hash</span><span class="p">)</span>
            <span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.update_user"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.update_user">[docs]</a>    <span class="k">def</span> <span class="nf">update_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="n">User</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">LOGMSG_INF_SEC_UPD_USER</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">LOGMSG_ERR_SEC_UPD_USER</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.del_register_user"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.del_register_user">[docs]</a>    <span class="k">def</span> <span class="nf">del_register_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">register_user</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete registration object from database.</span>

<span class="sd">        :param register_user: RegisterUser object to delete</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">register_user</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">LOGMSG_ERR_SEC_DEL_REGISTER_USER</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.get_all_users"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.get_all_users">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_users</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_model</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.update_user_auth_stat"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.update_user_auth_stat">[docs]</a>    <span class="k">def</span> <span class="nf">update_user_auth_stat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">success</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update user authentication stats.</span>

<span class="sd">        This is done upon successful/unsuccessful authentication attempts.</span>

<span class="sd">        :param user:</span>
<span class="sd">            The identified (but possibly not successfully authenticated) user</span>
<span class="sd">            model</span>
<span class="sd">        :param success:</span>
<span class="sd">            Defaults to true, if true increments login_count, updates</span>
<span class="sd">            last_login, and resets fail_login_count to 0, if false increments</span>
<span class="sd">            fail_login_count on user model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">login_count</span><span class="p">:</span>
            <span class="n">user</span><span class="o">.</span><span class="n">login_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">fail_login_count</span><span class="p">:</span>
            <span class="n">user</span><span class="o">.</span><span class="n">fail_login_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
            <span class="n">user</span><span class="o">.</span><span class="n">login_count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">user</span><span class="o">.</span><span class="n">last_login</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="n">user</span><span class="o">.</span><span class="n">fail_login_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">user</span><span class="o">.</span><span class="n">fail_login_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_user</span><span class="p">(</span><span class="n">user</span><span class="p">)</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    -------------</span>
<span class="sd">    Action entity</span>
<span class="sd">    -------------</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.get_action"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.get_action">[docs]</a>    <span class="k">def</span> <span class="nf">get_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Action</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get an existing action record.</span>

<span class="sd">        :param name: name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action_model</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">one_or_none</span><span class="p">()</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.create_action"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.create_action">[docs]</a>    <span class="k">def</span> <span class="nf">create_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an action to the backend, model action.</span>

<span class="sd">        :param name:</span>
<span class="sd">            name of the action: &#39;can_add&#39;,&#39;can_edit&#39; etc...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_action</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">action</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_model</span><span class="p">()</span>
                <span class="n">action</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">action</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">LOGMSG_ERR_SEC_ADD_PERMISSION</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">action</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.delete_action"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.delete_action">[docs]</a>    <span class="k">def</span> <span class="nf">delete_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete a permission action.</span>

<span class="sd">        :param name: Name of action to delete (e.g. can_read).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_action</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">action</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">LOGMSG_WAR_SEC_DEL_PERMISSION</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">perms</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">permission_model</span><span class="p">)</span>
                <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">permission_model</span><span class="o">.</span><span class="n">action</span> <span class="o">==</span> <span class="n">action</span><span class="p">)</span>
                <span class="o">.</span><span class="n">all</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">perms</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">LOGMSG_WAR_SEC_DEL_PERM_PVM</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">perms</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">LOGMSG_ERR_SEC_DEL_PERMISSION</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ---------------</span>
<span class="sd">    Resource entity</span>
<span class="sd">    ---------------</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.get_resource"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.get_resource">[docs]</a>    <span class="k">def</span> <span class="nf">get_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Resource</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a resource record by name, if it exists.</span>

<span class="sd">        :param name: Name of resource</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resource_model</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">one_or_none</span><span class="p">()</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.create_resource"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.create_resource">[docs]</a>    <span class="k">def</span> <span class="nf">create_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Resource</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a resource with the given name.</span>

<span class="sd">        :param name: The name of the resource to create created.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resource</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_model</span><span class="p">()</span>
                <span class="n">resource</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="k">return</span> <span class="n">resource</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">LOGMSG_ERR_SEC_ADD_VIEWMENU</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">resource</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.get_all_resources"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.get_all_resources">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Resource</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all existing resource records.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resource_model</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.delete_resource"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.delete_resource">[docs]</a>    <span class="k">def</span> <span class="nf">delete_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete a Resource from the backend.</span>

<span class="sd">        :param name:</span>
<span class="sd">            name of the resource</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">resource</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">LOGMSG_WAR_SEC_DEL_VIEWMENU</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">perms</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">permission_model</span><span class="p">)</span>
                <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">permission_model</span><span class="o">.</span><span class="n">resource</span> <span class="o">==</span> <span class="n">resource</span><span class="p">)</span>
                <span class="o">.</span><span class="n">all</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">perms</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">LOGMSG_WAR_SEC_DEL_VIEWMENU_PVM</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">perms</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">LOGMSG_ERR_SEC_DEL_PERMISSION</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ---------------</span>
<span class="sd">    Permission entity</span>
<span class="sd">    ---------------</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.get_permission"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.get_permission">[docs]</a>    <span class="k">def</span> <span class="nf">get_permission</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">action_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">resource_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Permission</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a permission made with the given action-&gt;resource pair, if the permission already exists.</span>

<span class="sd">        :param action_name: Name of action</span>
<span class="sd">        :param resource_name: Name of resource</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_action</span><span class="p">(</span><span class="n">action_name</span><span class="p">)</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource</span><span class="p">(</span><span class="n">resource_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">action</span> <span class="ow">and</span> <span class="n">resource</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">permission_model</span><span class="p">)</span>
                <span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">,</span> <span class="n">resource</span><span class="o">=</span><span class="n">resource</span><span class="p">)</span>
                <span class="o">.</span><span class="n">one_or_none</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.get_resource_permissions"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.get_resource_permissions">[docs]</a>    <span class="k">def</span> <span class="nf">get_resource_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">:</span> <span class="n">Resource</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Permission</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve permission pairs associated with a specific resource object.</span>

<span class="sd">        :param resource: Object representing a single resource.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">permission_model</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">resource_id</span><span class="o">=</span><span class="n">resource</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.create_permission"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.create_permission">[docs]</a>    <span class="k">def</span> <span class="nf">create_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Permission</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a permission on a resource to the backend.</span>

<span class="sd">        :param action_name:</span>
<span class="sd">            name of the action to add: &#39;can_add&#39;,&#39;can_edit&#39; etc...</span>
<span class="sd">        :param resource_name:</span>
<span class="sd">            name of the resource to add</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">action_name</span> <span class="ow">and</span> <span class="n">resource_name</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">perm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_permission</span><span class="p">(</span><span class="n">action_name</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">perm</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">perm</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_resource</span><span class="p">(</span><span class="n">resource_name</span><span class="p">)</span>
        <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_action</span><span class="p">(</span><span class="n">action_name</span><span class="p">)</span>
        <span class="n">perm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">permission_model</span><span class="p">()</span>
        <span class="n">perm</span><span class="o">.</span><span class="n">resource_id</span><span class="p">,</span> <span class="n">perm</span><span class="o">.</span><span class="n">action_id</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">action</span><span class="o">.</span><span class="n">id</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">perm</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">LOGMSG_INF_SEC_ADD_PERMVIEW</span><span class="p">,</span> <span class="n">perm</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">perm</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">LOGMSG_ERR_SEC_ADD_PERMVIEW</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.delete_permission"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.delete_permission">[docs]</a>    <span class="k">def</span> <span class="nf">delete_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete the permission linking an action-&gt;resource pair.</span>

<span class="sd">        Doesn&#39;t delete the underlying action or resource.</span>

<span class="sd">        :param action_name: Name of existing action</span>
<span class="sd">        :param resource_name: Name of existing resource</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">action_name</span> <span class="ow">and</span> <span class="n">resource_name</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="n">perm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_permission</span><span class="p">(</span><span class="n">action_name</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">perm</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">roles</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">role_model</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">role_model</span><span class="o">.</span><span class="n">permissions</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">perm</span><span class="p">))</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">roles</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">LOGMSG_WAR_SEC_DEL_PERMVIEW</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">roles</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># delete permission on resource</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">perm</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="c1"># if no more permission on permission view, delete permission</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">permission_model</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">perm</span><span class="o">.</span><span class="n">action</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">delete_action</span><span class="p">(</span><span class="n">perm</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">LOGMSG_INF_SEC_DEL_PERMVIEW</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">LOGMSG_ERR_SEC_DEL_PERMVIEW</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.add_permission_to_role"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.add_permission_to_role">[docs]</a>    <span class="k">def</span> <span class="nf">add_permission_to_role</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">role</span><span class="p">:</span> <span class="n">Role</span><span class="p">,</span> <span class="n">permission</span><span class="p">:</span> <span class="n">Permission</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add an existing permission pair to a role.</span>

<span class="sd">        :param role: The role about to get a new permission.</span>
<span class="sd">        :param permission: The permission pair to add to a role.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">permission</span> <span class="ow">and</span> <span class="n">permission</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">role</span><span class="o">.</span><span class="n">permissions</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">role</span><span class="o">.</span><span class="n">permissions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">permission</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">role</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">LOGMSG_INF_SEC_ADD_PERMROLE</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="n">role</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">LOGMSG_ERR_SEC_ADD_PERMROLE</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.remove_permission_from_role"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.remove_permission_from_role">[docs]</a>    <span class="k">def</span> <span class="nf">remove_permission_from_role</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">role</span><span class="p">:</span> <span class="n">Role</span><span class="p">,</span> <span class="n">permission</span><span class="p">:</span> <span class="n">Permission</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove a permission pair from a role.</span>

<span class="sd">        :param role: User role containing permissions.</span>
<span class="sd">        :param permission: Object representing resource-&gt; action pair</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">permission</span> <span class="ow">in</span> <span class="n">role</span><span class="o">.</span><span class="n">permissions</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">role</span><span class="o">.</span><span class="n">permissions</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">permission</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">role</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">LOGMSG_INF_SEC_DEL_PERMROLE</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="n">role</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">LOGMSG_ERR_SEC_DEL_PERMROLE</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.get_oid_identity_url"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.get_oid_identity_url">[docs]</a>    <span class="k">def</span> <span class="nf">get_oid_identity_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">provider_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the OIDC identity provider URL.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">provider</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">openid_providers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">provider</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">provider_name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">provider</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.get_user_roles"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.get_user_roles">[docs]</a>    <span class="k">def</span> <span class="nf">get_user_roles</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get all the roles associated with the user.</span>

<span class="sd">        :param user: the ab_user in FAB model.</span>
<span class="sd">        :return: a list of roles associated with the user.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">user</span>
        <span class="k">return</span> <span class="n">user</span><span class="o">.</span><span class="n">roles</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    --------------------</span>
<span class="sd">    Auth related methods</span>
<span class="sd">    --------------------</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_user_ldap"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_user_ldap">[docs]</a>    <span class="k">def</span> <span class="nf">auth_user_ldap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Authenticate user with LDAP.</span>

<span class="sd">        NOTE: this depends on python-ldap module.</span>

<span class="sd">        :param username: the username</span>
<span class="sd">        :param password: the password</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If no username is provided, go away</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">username</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">username</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Search the DB for this user</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_user</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span>

        <span class="c1"># If user is not active, go away</span>
        <span class="k">if</span> <span class="n">user</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">is_active</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># If user is not registered, and not self-registration, go away</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">user</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_user_registration</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Ensure python-ldap is installed</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">ldap</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;python-ldap library is not installed&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># LDAP certificate settings</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_tls_cacertdir</span><span class="p">:</span>
                <span class="n">ldap</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="n">ldap</span><span class="o">.</span><span class="n">OPT_X_TLS_CACERTDIR</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_tls_cacertdir</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_tls_cacertfile</span><span class="p">:</span>
                <span class="n">ldap</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="n">ldap</span><span class="o">.</span><span class="n">OPT_X_TLS_CACERTFILE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_tls_cacertfile</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_tls_certfile</span><span class="p">:</span>
                <span class="n">ldap</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="n">ldap</span><span class="o">.</span><span class="n">OPT_X_TLS_CERTFILE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_tls_certfile</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_tls_keyfile</span><span class="p">:</span>
                <span class="n">ldap</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="n">ldap</span><span class="o">.</span><span class="n">OPT_X_TLS_KEYFILE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_tls_keyfile</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_allow_self_signed</span><span class="p">:</span>
                <span class="n">ldap</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="n">ldap</span><span class="o">.</span><span class="n">OPT_X_TLS_REQUIRE_CERT</span><span class="p">,</span> <span class="n">ldap</span><span class="o">.</span><span class="n">OPT_X_TLS_ALLOW</span><span class="p">)</span>
                <span class="n">ldap</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="n">ldap</span><span class="o">.</span><span class="n">OPT_X_TLS_NEWCTX</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_tls_demand</span><span class="p">:</span>
                <span class="n">ldap</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="n">ldap</span><span class="o">.</span><span class="n">OPT_X_TLS_REQUIRE_CERT</span><span class="p">,</span> <span class="n">ldap</span><span class="o">.</span><span class="n">OPT_X_TLS_DEMAND</span><span class="p">)</span>
                <span class="n">ldap</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="n">ldap</span><span class="o">.</span><span class="n">OPT_X_TLS_NEWCTX</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="c1"># Initialise LDAP connection</span>
            <span class="n">con</span> <span class="o">=</span> <span class="n">ldap</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_server</span><span class="p">)</span>
            <span class="n">con</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="n">ldap</span><span class="o">.</span><span class="n">OPT_REFERRALS</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_use_tls</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">con</span><span class="o">.</span><span class="n">start_tls_s</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">LOGMSG_ERR_SEC_AUTH_LDAP_TLS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_server</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>

            <span class="c1"># Define variables, so we can check if they are set in later steps</span>
            <span class="n">user_dn</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">user_attributes</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="c1"># Flow 1 - (Indirect Search Bind):</span>
            <span class="c1">#  - in this flow, special bind credentials are used to perform the</span>
            <span class="c1">#    LDAP search</span>
            <span class="c1">#  - in this flow, AUTH_LDAP_SEARCH must be set</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_bind_user</span><span class="p">:</span>
                <span class="c1"># Bind with AUTH_LDAP_BIND_USER/AUTH_LDAP_BIND_PASSWORD</span>
                <span class="c1"># (authorizes for LDAP search)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ldap_bind_indirect</span><span class="p">(</span><span class="n">ldap</span><span class="p">,</span> <span class="n">con</span><span class="p">)</span>

                <span class="c1"># Search for `username`</span>
                <span class="c1">#  - returns the `user_dn` needed for binding to validate credentials</span>
                <span class="c1">#  - returns the `user_attributes` needed for</span>
                <span class="c1">#    AUTH_USER_REGISTRATION/AUTH_ROLES_SYNC_AT_LOGIN</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_search</span><span class="p">:</span>
                    <span class="n">user_dn</span><span class="p">,</span> <span class="n">user_attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_ldap</span><span class="p">(</span><span class="n">ldap</span><span class="p">,</span> <span class="n">con</span><span class="p">,</span> <span class="n">username</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;AUTH_LDAP_SEARCH must be set when using AUTH_LDAP_BIND_USER&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>

                <span class="c1"># If search failed, go away</span>
                <span class="k">if</span> <span class="n">user_dn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">LOGMSG_WAR_SEC_NOLDAP_OBJ</span><span class="p">,</span> <span class="n">username</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>

                <span class="c1"># Bind with user_dn/password (validates credentials)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ldap_bind</span><span class="p">(</span><span class="n">ldap</span><span class="p">,</span> <span class="n">con</span><span class="p">,</span> <span class="n">user_dn</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">update_user_auth_stat</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

                    <span class="c1"># Invalid credentials, go away</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">LOGMSG_WAR_SEC_LOGIN_FAILED</span><span class="p">,</span> <span class="n">username</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>

            <span class="c1"># Flow 2 - (Direct Search Bind):</span>
            <span class="c1">#  - in this flow, the credentials provided by the end-user are used</span>
            <span class="c1">#    to perform the LDAP search</span>
            <span class="c1">#  - in this flow, we only search LDAP if AUTH_LDAP_SEARCH is set</span>
            <span class="c1">#     - features like AUTH_USER_REGISTRATION &amp; AUTH_ROLES_SYNC_AT_LOGIN</span>
            <span class="c1">#       will only work if AUTH_LDAP_SEARCH is set</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Copy the provided username (so we can apply formatters)</span>
                <span class="n">bind_username</span> <span class="o">=</span> <span class="n">username</span>

                <span class="c1"># update `bind_username` by applying AUTH_LDAP_APPEND_DOMAIN</span>
                <span class="c1">#  - for Microsoft AD, which allows binding with userPrincipalName</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_append_domain</span><span class="p">:</span>
                    <span class="n">bind_username</span> <span class="o">=</span> <span class="n">bind_username</span> <span class="o">+</span> <span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_append_domain</span>

                <span class="c1"># Update `bind_username` by applying AUTH_LDAP_USERNAME_FORMAT</span>
                <span class="c1">#  - for transforming the username into a DN,</span>
                <span class="c1">#    for example: &quot;uid=%s,ou=example,o=test&quot;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_username_format</span><span class="p">:</span>
                    <span class="n">bind_username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_username_format</span> <span class="o">%</span> <span class="n">bind_username</span>

                <span class="c1"># Bind with bind_username/password</span>
                <span class="c1"># (validates credentials &amp; authorizes for LDAP search)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ldap_bind</span><span class="p">(</span><span class="n">ldap</span><span class="p">,</span> <span class="n">con</span><span class="p">,</span> <span class="n">bind_username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">update_user_auth_stat</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

                    <span class="c1"># Invalid credentials, go away</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">LOGMSG_WAR_SEC_LOGIN_FAILED</span><span class="p">,</span> <span class="n">bind_username</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>

                <span class="c1"># Search for `username` (if AUTH_LDAP_SEARCH is set)</span>
                <span class="c1">#  - returns the `user_attributes`</span>
                <span class="c1">#    needed for AUTH_USER_REGISTRATION/AUTH_ROLES_SYNC_AT_LOGIN</span>
                <span class="c1">#  - we search on `username` not `bind_username`,</span>
                <span class="c1">#    because AUTH_LDAP_APPEND_DOMAIN and AUTH_LDAP_USERNAME_FORMAT</span>
                <span class="c1">#    would result in an invalid search filter</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_search</span><span class="p">:</span>
                    <span class="n">user_dn</span><span class="p">,</span> <span class="n">user_attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search_ldap</span><span class="p">(</span><span class="n">ldap</span><span class="p">,</span> <span class="n">con</span><span class="p">,</span> <span class="n">username</span><span class="p">)</span>

                    <span class="c1"># If search failed, go away</span>
                    <span class="k">if</span> <span class="n">user_dn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">LOGMSG_WAR_SEC_NOLDAP_OBJ</span><span class="p">,</span> <span class="n">username</span><span class="p">)</span>
                        <span class="k">return</span> <span class="kc">None</span>

            <span class="c1"># Sync the user&#39;s roles</span>
            <span class="k">if</span> <span class="n">user</span> <span class="ow">and</span> <span class="n">user_attributes</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_roles_sync_at_login</span><span class="p">:</span>
                <span class="n">user</span><span class="o">.</span><span class="n">roles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ldap_calculate_user_roles</span><span class="p">(</span><span class="n">user_attributes</span><span class="p">)</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Calculated new roles for user=</span><span class="si">%r</span><span class="s2"> as: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">user_dn</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">roles</span><span class="p">)</span>

            <span class="c1"># If the user is new, register them</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">user</span><span class="p">)</span> <span class="ow">and</span> <span class="n">user_attributes</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_user_registration</span><span class="p">:</span>
                <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_user</span><span class="p">(</span>
                    <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
                    <span class="n">first_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ldap_extract</span><span class="p">(</span><span class="n">user_attributes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_firstname_field</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">last_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ldap_extract</span><span class="p">(</span><span class="n">user_attributes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_lastname_field</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="n">email</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ldap_extract</span><span class="p">(</span>
                        <span class="n">user_attributes</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_email_field</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">@email.notfound&quot;</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="n">role</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ldap_calculate_user_roles</span><span class="p">(</span><span class="n">user_attributes</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;New user registered: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>

                <span class="c1"># If user registration failed, go away</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">LOGMSG_ERR_SEC_ADD_REGISTER_USER</span><span class="p">,</span> <span class="n">username</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>

            <span class="c1"># LOGIN SUCCESS (only if user is now registered)</span>
            <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rotate_session_id</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_user_auth_stat</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">user</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="k">except</span> <span class="n">ldap</span><span class="o">.</span><span class="n">LDAPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">msg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;desc&quot;</span> <span class="ow">in</span> <span class="n">msg</span><span class="p">):</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">LOGMSG_ERR_SEC_AUTH_LDAP</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="p">[</span><span class="s2">&quot;desc&quot;</span><span class="p">])</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_user_db"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_user_db">[docs]</a>    <span class="k">def</span> <span class="nf">auth_user_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Authenticate user, auth db style.</span>

<span class="sd">        :param username:</span>
<span class="sd">            The username or registered email address</span>
<span class="sd">        :param password:</span>
<span class="sd">            The password, will be tested against hashed password on db</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">username</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">username</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_user</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_user</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">username</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">is_active</span><span class="p">):</span>
            <span class="c1"># Balance failure and success</span>
            <span class="n">check_password_hash</span><span class="p">(</span>
                <span class="s2">&quot;pbkdf2:sha256:150000$Z3t6fmj2$22da622d94a1f8118&quot;</span>
                <span class="s2">&quot;c0976a03d2f18f680bfff877c9a965db9eedc51bc0be87c&quot;</span><span class="p">,</span>
                <span class="s2">&quot;password&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">LOGMSG_WAR_SEC_LOGIN_FAILED</span><span class="p">,</span> <span class="n">username</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">check_password_hash</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">password</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rotate_session_id</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_user_auth_stat</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">user</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_user_auth_stat</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">LOGMSG_WAR_SEC_LOGIN_FAILED</span><span class="p">,</span> <span class="n">username</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.oauth_user_info_getter"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.oauth_user_info_getter">[docs]</a>    <span class="k">def</span> <span class="nf">oauth_user_info_getter</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">AirflowSecurityManagerV2</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get OAuth user info for all the providers.</span>

<span class="sd">        Receives provider and response return a dict with the information returned from the provider.</span>
<span class="sd">        The returned user info dict should have its keys with the same name as the User Model.</span>

<span class="sd">        Use it like this an example for GitHub ::</span>

<span class="sd">            @appbuilder.sm.oauth_user_info_getter</span>
<span class="sd">            def my_oauth_user_info(sm, provider, response=None):</span>
<span class="sd">                if provider == &quot;github&quot;:</span>
<span class="sd">                    me = sm.oauth_remotes[provider].get(&quot;user&quot;)</span>
<span class="sd">                    return {&quot;username&quot;: me.data.get(&quot;login&quot;)}</span>
<span class="sd">                return {}</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">wraps</span><span class="p">(</span><span class="n">provider</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">provider</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">oauth_user_info</span> <span class="o">=</span> <span class="n">wraps</span>
        <span class="k">return</span> <span class="n">wraps</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.get_oauth_user_info"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.get_oauth_user_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_oauth_user_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">provider</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">resp</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        There are different OAuth APIs with different ways to retrieve user info.</span>

<span class="sd">        All providers have different ways to retrieve user info.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># for GITHUB</span>
        <span class="k">if</span> <span class="n">provider</span> <span class="o">==</span> <span class="s2">&quot;github&quot;</span> <span class="ow">or</span> <span class="n">provider</span> <span class="o">==</span> <span class="s2">&quot;githublocal&quot;</span><span class="p">:</span>
            <span class="n">me</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oauth_remotes</span><span class="p">[</span><span class="n">provider</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">me</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;User info from GitHub: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;github_&quot;</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;login&quot;</span><span class="p">)}</span>
        <span class="c1"># for twitter</span>
        <span class="k">if</span> <span class="n">provider</span> <span class="o">==</span> <span class="s2">&quot;twitter&quot;</span><span class="p">:</span>
            <span class="n">me</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oauth_remotes</span><span class="p">[</span><span class="n">provider</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;account/settings.json&quot;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">me</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;User info from Twitter: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;twitter_&quot;</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;screen_name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)}</span>
        <span class="c1"># for linkedin</span>
        <span class="k">if</span> <span class="n">provider</span> <span class="o">==</span> <span class="s2">&quot;linkedin&quot;</span><span class="p">:</span>
            <span class="n">me</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oauth_remotes</span><span class="p">[</span><span class="n">provider</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;people/~:(id,email-address,first-name,last-name)?format=json&quot;</span>
            <span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">me</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;User info from LinkedIn: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;linkedin_&quot;</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;email-address&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="s2">&quot;first_name&quot;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;firstName&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="s2">&quot;last_name&quot;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lastName&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
            <span class="p">}</span>
        <span class="c1"># for Google</span>
        <span class="k">if</span> <span class="n">provider</span> <span class="o">==</span> <span class="s2">&quot;google&quot;</span><span class="p">:</span>
            <span class="n">me</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oauth_remotes</span><span class="p">[</span><span class="n">provider</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;userinfo&quot;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">me</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;User info from Google: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;google_&quot;</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="s2">&quot;first_name&quot;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;given_name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="s2">&quot;last_name&quot;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;family_name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;email&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
            <span class="p">}</span>
        <span class="k">if</span> <span class="n">provider</span> <span class="o">==</span> <span class="s2">&quot;azure&quot;</span><span class="p">:</span>
            <span class="n">me</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decode_and_validate_azure_jwt</span><span class="p">(</span><span class="n">resp</span><span class="p">[</span><span class="s2">&quot;id_token&quot;</span><span class="p">])</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;User info from Azure: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">me</span><span class="p">)</span>
            <span class="c1"># https://learn.microsoft.com/en-us/azure/active-directory/develop/id-token-claims-reference#payload-claims</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">me</span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;email&quot;</span> <span class="ow">in</span> <span class="n">me</span> <span class="k">else</span> <span class="n">me</span><span class="p">[</span><span class="s2">&quot;upn&quot;</span><span class="p">],</span>
                <span class="s2">&quot;first_name&quot;</span><span class="p">:</span> <span class="n">me</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;given_name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="s2">&quot;last_name&quot;</span><span class="p">:</span> <span class="n">me</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;family_name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="n">me</span><span class="p">[</span><span class="s2">&quot;oid&quot;</span><span class="p">],</span>
                <span class="s2">&quot;role_keys&quot;</span><span class="p">:</span> <span class="n">me</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;roles&quot;</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="p">}</span>
        <span class="c1"># for OpenShift</span>
        <span class="k">if</span> <span class="n">provider</span> <span class="o">==</span> <span class="s2">&quot;openshift&quot;</span><span class="p">:</span>
            <span class="n">me</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oauth_remotes</span><span class="p">[</span><span class="n">provider</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;apis/user.openshift.io/v1/users/~&quot;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">me</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;User info from OpenShift: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;openshift_&quot;</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;metadata&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)}</span>
        <span class="c1"># for Okta</span>
        <span class="k">if</span> <span class="n">provider</span> <span class="o">==</span> <span class="s2">&quot;okta&quot;</span><span class="p">:</span>
            <span class="n">me</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oauth_remotes</span><span class="p">[</span><span class="n">provider</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;userinfo&quot;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">me</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;User info from Okta: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;error&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span>
                    <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">provider</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;sub&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;first_name&quot;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;given_name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;last_name&quot;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;family_name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;role_keys&quot;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;groups&quot;</span><span class="p">,</span> <span class="p">[]),</span>
                <span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error_description&quot;</span><span class="p">))</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="c1"># for Auth0</span>
        <span class="k">if</span> <span class="n">provider</span> <span class="o">==</span> <span class="s2">&quot;auth0&quot;</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">sm</span><span class="o">.</span><span class="n">oauth_remotes</span><span class="p">[</span><span class="n">provider</span><span class="p">]</span><span class="o">.</span><span class="n">userinfo</span><span class="p">()</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;User info from Auth0: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">provider</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;sub&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;first_name&quot;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;given_name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="s2">&quot;last_name&quot;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;family_name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">],</span>
                <span class="s2">&quot;role_keys&quot;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;groups&quot;</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="p">}</span>
        <span class="c1"># for Keycloak</span>
        <span class="k">if</span> <span class="n">provider</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;keycloak&quot;</span><span class="p">,</span> <span class="s2">&quot;keycloak_before_17&quot;</span><span class="p">]:</span>
            <span class="n">me</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oauth_remotes</span><span class="p">[</span><span class="n">provider</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;openid-connect/userinfo&quot;</span><span class="p">)</span>
            <span class="n">me</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">me</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;User info from Keycloak: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;preferred_username&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="s2">&quot;first_name&quot;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;given_name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="s2">&quot;last_name&quot;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;family_name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;email&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="s2">&quot;role_keys&quot;</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;groups&quot;</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="p">}</span>
        <span class="c1"># for Authentik</span>
        <span class="k">if</span> <span class="n">provider</span> <span class="o">==</span> <span class="s2">&quot;authentik&quot;</span><span class="p">:</span>
            <span class="n">id_token</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="s2">&quot;id_token&quot;</span><span class="p">]</span>
            <span class="n">me</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_authentik_token_info</span><span class="p">(</span><span class="n">id_token</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;User info from authentik: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">me</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">me</span><span class="p">[</span><span class="s2">&quot;preferred_username&quot;</span><span class="p">],</span>
                <span class="s2">&quot;first_name&quot;</span><span class="p">:</span> <span class="n">me</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;given_name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="n">me</span><span class="p">[</span><span class="s2">&quot;nickname&quot;</span><span class="p">],</span>
                <span class="s2">&quot;role_keys&quot;</span><span class="p">:</span> <span class="n">me</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;groups&quot;</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="p">}</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.oauth_token_getter"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.oauth_token_getter">[docs]</a>    <span class="k">def</span> <span class="nf">oauth_token_getter</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get authentication (OAuth) token.&quot;&quot;&quot;</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;oauth&quot;</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Token Get: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">token</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.check_authorization"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.check_authorization">[docs]</a>    <span class="k">def</span> <span class="nf">check_authorization</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">perms</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dag_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check the logged-in user has the specified permissions.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">perms</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">for</span> <span class="n">perm</span> <span class="ow">in</span> <span class="n">perms</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">perm</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_READ</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_DAG</span><span class="p">),</span>
                <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_EDIT</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_DAG</span><span class="p">),</span>
                <span class="p">(</span><span class="n">permissions</span><span class="o">.</span><span class="n">ACTION_CAN_DELETE</span><span class="p">,</span> <span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_DAG</span><span class="p">),</span>
            <span class="p">):</span>
                <span class="n">can_access_all_dags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_access</span><span class="p">(</span><span class="o">*</span><span class="n">perm</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">can_access_all_dags</span><span class="p">:</span>
                    <span class="n">action</span> <span class="o">=</span> <span class="n">perm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">can_access_some_dags</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">dag_id</span><span class="p">):</span>
                        <span class="k">return</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_access</span><span class="p">(</span><span class="o">*</span><span class="n">perm</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.set_oauth_session"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.set_oauth_session">[docs]</a>    <span class="k">def</span> <span class="nf">set_oauth_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">provider</span><span class="p">,</span> <span class="n">oauth_response</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the current session with OAuth user secrets.&quot;&quot;&quot;</span>
        <span class="c1"># Get this provider key names for token_key and token_secret</span>
        <span class="n">token_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_oauth_token_key_name</span><span class="p">(</span><span class="n">provider</span><span class="p">)</span>
        <span class="n">token_secret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_oauth_token_secret_name</span><span class="p">(</span><span class="n">provider</span><span class="p">)</span>
        <span class="c1"># Save users token on encrypted session cookie</span>
        <span class="n">session</span><span class="p">[</span><span class="s2">&quot;oauth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">oauth_response</span><span class="p">[</span><span class="n">token_key</span><span class="p">],</span>
            <span class="n">oauth_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">token_secret</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s2">&quot;oauth_provider&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">provider</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.get_oauth_token_key_name"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.get_oauth_token_key_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_oauth_token_key_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">provider</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the token_key name for the oauth provider.</span>

<span class="sd">        If none is configured defaults to oauth_token</span>
<span class="sd">        this is configured using OAUTH_PROVIDERS and token_key key.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">_provider</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">oauth_providers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_provider</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">provider</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_provider</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;token_key&quot;</span><span class="p">,</span> <span class="s2">&quot;oauth_token&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.get_oauth_token_secret_name"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.get_oauth_token_secret_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_oauth_token_secret_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">provider</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the ``token_secret`` name for the oauth provider.</span>

<span class="sd">        If none is configured, defaults to ``oauth_secret``. This is configured</span>
<span class="sd">        using ``OAUTH_PROVIDERS`` and ``token_secret``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">_provider</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">oauth_providers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_provider</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">provider</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_provider</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;token_secret&quot;</span><span class="p">,</span> <span class="s2">&quot;oauth_token_secret&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_user_oauth"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_user_oauth">[docs]</a>    <span class="k">def</span> <span class="nf">auth_user_oauth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userinfo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Authenticate user with OAuth.</span>

<span class="sd">        :userinfo: dict with user information</span>
<span class="sd">                   (keys are the same as User model columns)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># extract the username from `userinfo`</span>
        <span class="k">if</span> <span class="s2">&quot;username&quot;</span> <span class="ow">in</span> <span class="n">userinfo</span><span class="p">:</span>
            <span class="n">username</span> <span class="o">=</span> <span class="n">userinfo</span><span class="p">[</span><span class="s2">&quot;username&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s2">&quot;email&quot;</span> <span class="ow">in</span> <span class="n">userinfo</span><span class="p">:</span>
            <span class="n">username</span> <span class="o">=</span> <span class="n">userinfo</span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;OAUTH userinfo does not have username or email </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">userinfo</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># If username is empty, go away</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">username</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">username</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Search the DB for this user</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_user</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span>

        <span class="c1"># If user is not active, go away</span>
        <span class="k">if</span> <span class="n">user</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">is_active</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># If user is not registered, and not self-registration, go away</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">user</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_user_registration</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Sync the user&#39;s roles</span>
        <span class="k">if</span> <span class="n">user</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_roles_sync_at_login</span><span class="p">:</span>
            <span class="n">user</span><span class="o">.</span><span class="n">roles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oauth_calculate_user_roles</span><span class="p">(</span><span class="n">userinfo</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Calculated new roles for user=</span><span class="si">%r</span><span class="s2"> as: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">roles</span><span class="p">)</span>

        <span class="c1"># If the user is new, register them</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">user</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_user_registration</span><span class="p">:</span>
            <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_user</span><span class="p">(</span>
                <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
                <span class="n">first_name</span><span class="o">=</span><span class="n">userinfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;first_name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="n">last_name</span><span class="o">=</span><span class="n">userinfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;last_name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="n">email</span><span class="o">=</span><span class="n">userinfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;email&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">@email.notfound&quot;</span><span class="p">,</span>
                <span class="n">role</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_oauth_calculate_user_roles</span><span class="p">(</span><span class="n">userinfo</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;New user registered: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>

            <span class="c1"># If user registration failed, go away</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error creating a new OAuth user </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">username</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># LOGIN SUCCESS (only if user is now registered)</span>
        <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rotate_session_id</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_user_auth_stat</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">user</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_user_oid"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_user_oid">[docs]</a>    <span class="k">def</span> <span class="nf">auth_user_oid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Openid user Authentication.</span>

<span class="sd">        :param email: user&#39;s email to authenticate</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_user</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">is_active</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">LOGMSG_WAR_SEC_LOGIN_FAILED</span><span class="p">,</span> <span class="n">email</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rotate_session_id</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_user_auth_stat</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">user</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.auth_user_remote_user"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.auth_user_remote_user">[docs]</a>    <span class="k">def</span> <span class="nf">auth_user_remote_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        REMOTE_USER user Authentication.</span>

<span class="sd">        :param username: user&#39;s username for remote auth</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_user</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span>

        <span class="c1"># User does not exist, create one if auto user registration.</span>
        <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_user_registration</span><span class="p">:</span>
            <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_user</span><span class="p">(</span>
                <span class="c1"># All we have is REMOTE_USER, so we set</span>
                <span class="c1"># the other fields to blank.</span>
                <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
                <span class="n">first_name</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
                <span class="n">last_name</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
                <span class="n">email</span><span class="o">=</span><span class="n">username</span> <span class="o">+</span> <span class="s2">&quot;@email.notfound&quot;</span><span class="p">,</span>
                <span class="n">role</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">find_role</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_user_registration_role</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="c1"># If user does not exist on the DB and not auto user registration,</span>
        <span class="c1"># or user is inactive, go away.</span>
        <span class="k">elif</span> <span class="n">user</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">is_active</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">LOGMSG_WAR_SEC_LOGIN_FAILED</span><span class="p">,</span> <span class="n">username</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_rotate_session_id</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_user_auth_stat</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">user</span></div>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.get_user_menu_access"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.get_user_menu_access">[docs]</a>    <span class="k">def</span> <span class="nf">get_user_menu_access</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">menu_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">get_auth_manager</span><span class="p">()</span><span class="o">.</span><span class="n">is_logged_in</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_user_permission_resources</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="s2">&quot;menu_access&quot;</span><span class="p">,</span> <span class="n">resource_names</span><span class="o">=</span><span class="n">menu_names</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">current_user_jwt</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_user_permission_resources</span><span class="p">(</span>
                <span class="c1"># the current_user_jwt is a lazy proxy, so we need to ignore type checking</span>
                <span class="n">current_user_jwt</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
                <span class="s2">&quot;menu_access&quot;</span><span class="p">,</span>
                <span class="n">resource_names</span><span class="o">=</span><span class="n">menu_names</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_user_permission_resources</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;menu_access&quot;</span><span class="p">,</span> <span class="n">resource_names</span><span class="o">=</span><span class="n">menu_names</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.ldap_extract_list"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.ldap_extract_list">[docs]</a>    <span class="k">def</span> <span class="nf">ldap_extract_list</span><span class="p">(</span><span class="n">ldap_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]],</span> <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">raw_list</span> <span class="o">=</span> <span class="n">ldap_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="p">[])</span>
        <span class="c1"># decode - removing empty strings</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">raw_list</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)]</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.ldap_extract"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.ldap_extract">[docs]</a>    <span class="k">def</span> <span class="nf">ldap_extract</span><span class="p">(</span><span class="n">ldap_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]],</span> <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">fallback</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">raw_value</span> <span class="o">=</span> <span class="n">ldap_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="p">[</span><span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">])</span>
        <span class="c1"># decode - if empty string, default to fallback, otherwise take first element</span>
        <span class="k">return</span> <span class="n">raw_value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">fallback</span></div>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ---------------</span>
<span class="sd">    Private methods</span>
<span class="sd">    ---------------</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_rotate_session_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotate the session ID.</span>

<span class="sd">        We need to do this upon successful authentication when using the</span>
<span class="sd">        database session backend.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">conf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;webserver&quot;</span><span class="p">,</span> <span class="s2">&quot;SESSION_BACKEND&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;database&quot;</span><span class="p">:</span>
            <span class="n">session</span><span class="o">.</span><span class="n">sid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_get_microsoft_jwks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="kn">import</span> <span class="nn">requests</span>

        <span class="k">return</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">MICROSOFT_KEY_SET_URL</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_decode_and_validate_azure_jwt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">id_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="n">verify_signature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oauth_remotes</span><span class="p">[</span><span class="s2">&quot;azure&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">client_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;verify_signature&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verify_signature</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">authlib.jose</span> <span class="kn">import</span> <span class="n">JsonWebKey</span><span class="p">,</span> <span class="n">jwt</span> <span class="k">as</span> <span class="n">authlib_jwt</span>

            <span class="n">keyset</span> <span class="o">=</span> <span class="n">JsonWebKey</span><span class="o">.</span><span class="n">import_key_set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_microsoft_jwks</span><span class="p">())</span>
            <span class="n">claims</span> <span class="o">=</span> <span class="n">authlib_jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">id_token</span><span class="p">,</span> <span class="n">keyset</span><span class="p">)</span>
            <span class="n">claims</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">claims</span>

        <span class="k">return</span> <span class="n">jwt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">id_token</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;verify_signature&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">_ldap_bind_indirect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ldap</span><span class="p">,</span> <span class="n">con</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attempt to bind to LDAP using the AUTH_LDAP_BIND_USER.</span>

<span class="sd">        :param ldap: The ldap module reference</span>
<span class="sd">        :param con: The ldap connection</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_bind_user</span><span class="p">:</span>
            <span class="c1"># always check AUTH_LDAP_BIND_USER is set before calling this method</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;AUTH_LDAP_BIND_USER must be set&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;LDAP bind indirect TRY with username: </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_bind_user</span><span class="p">)</span>
            <span class="n">con</span><span class="o">.</span><span class="n">simple_bind_s</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_bind_user</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_bind_password</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;LDAP bind indirect SUCCESS with username: </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_bind_user</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ldap</span><span class="o">.</span><span class="n">INVALID_CREDENTIALS</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;AUTH_LDAP_BIND_USER and AUTH_LDAP_BIND_PASSWORD are not valid LDAP bind credentials&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">ex</span>

    <span class="k">def</span> <span class="nf">_search_ldap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ldap</span><span class="p">,</span> <span class="n">con</span><span class="p">,</span> <span class="n">username</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Search LDAP for user.</span>

<span class="sd">        :param ldap: The ldap module reference</span>
<span class="sd">        :param con: The ldap connection</span>
<span class="sd">        :param username: username to match with AUTH_LDAP_UID_FIELD</span>
<span class="sd">        :return: ldap object array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_search</span><span class="p">:</span>
            <span class="c1"># always check AUTH_LDAP_SEARCH is set before calling this method</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;AUTH_LDAP_SEARCH must be set&quot;</span><span class="p">)</span>

        <span class="c1"># build the filter string for the LDAP search</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_search_filter</span><span class="p">:</span>
            <span class="n">filter_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(&amp;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_search_filter</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_uid_field</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">))&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filter_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_uid_field</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="c1"># build what fields to request in the LDAP search</span>
        <span class="n">request_fields</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_firstname_field</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_lastname_field</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_email_field</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_roles_mapping</span><span class="p">:</span>
            <span class="n">request_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_group_field</span><span class="p">)</span>

        <span class="c1"># perform the LDAP search</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;LDAP search for </span><span class="si">%r</span><span class="s2"> with fields </span><span class="si">%s</span><span class="s2"> in scope </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">filter_str</span><span class="p">,</span> <span class="n">request_fields</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_search</span>
        <span class="p">)</span>
        <span class="n">raw_search_result</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">search_s</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_search</span><span class="p">,</span> <span class="n">ldap</span><span class="o">.</span><span class="n">SCOPE_SUBTREE</span><span class="p">,</span> <span class="n">filter_str</span><span class="p">,</span> <span class="n">request_fields</span>
        <span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;LDAP search returned: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">raw_search_result</span><span class="p">)</span>

        <span class="c1"># Remove any search referrals from results</span>
        <span class="n">search_result</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">dn</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span> <span class="k">for</span> <span class="n">dn</span><span class="p">,</span> <span class="n">attrs</span> <span class="ow">in</span> <span class="n">raw_search_result</span> <span class="k">if</span> <span class="n">dn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="c1"># only continue if 0 or 1 results were returned</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">search_result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;LDAP search for </span><span class="si">%r</span><span class="s2"> in scope &#39;</span><span class="si">%a</span><span class="s2">&#39; returned multiple results&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_search</span><span class="p">,</span>
                <span class="n">filter_str</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># extract the DN</span>
            <span class="n">user_dn</span> <span class="o">=</span> <span class="n">search_result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># extract the other attributes</span>
            <span class="n">user_info</span> <span class="o">=</span> <span class="n">search_result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1"># return</span>
            <span class="k">return</span> <span class="n">user_dn</span><span class="p">,</span> <span class="n">user_info</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">NameError</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_ldap_bind</span><span class="p">(</span><span class="n">ldap</span><span class="p">,</span> <span class="n">con</span><span class="p">,</span> <span class="n">dn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validates/binds the provided dn/password with the LDAP sever.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;LDAP bind TRY with username: </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">dn</span><span class="p">)</span>
            <span class="n">con</span><span class="o">.</span><span class="n">simple_bind_s</span><span class="p">(</span><span class="n">dn</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;LDAP bind SUCCESS with username: </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">dn</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="n">ldap</span><span class="o">.</span><span class="n">INVALID_CREDENTIALS</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_ldap_calculate_user_roles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_attributes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">user_role_objects</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="c1"># apply AUTH_ROLES_MAPPING</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_roles_mapping</span><span class="p">:</span>
            <span class="n">user_role_keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ldap_extract_list</span><span class="p">(</span><span class="n">user_attributes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_ldap_group_field</span><span class="p">)</span>
            <span class="n">user_role_objects</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_roles_from_keys</span><span class="p">(</span><span class="n">user_role_keys</span><span class="p">))</span>

        <span class="c1"># apply AUTH_USER_REGISTRATION</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_user_registration</span><span class="p">:</span>
            <span class="n">registration_role_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_user_registration_role</span>

            <span class="c1"># lookup registration role in flask db</span>
            <span class="n">fab_role</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_role</span><span class="p">(</span><span class="n">registration_role_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fab_role</span><span class="p">:</span>
                <span class="n">user_role_objects</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">fab_role</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Can&#39;t find AUTH_USER_REGISTRATION role: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">registration_role_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">user_role_objects</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_oauth_calculate_user_roles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userinfo</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">user_role_objects</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="c1"># apply AUTH_ROLES_MAPPING</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_roles_mapping</span><span class="p">:</span>
            <span class="n">user_role_keys</span> <span class="o">=</span> <span class="n">userinfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;role_keys&quot;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">user_role_objects</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_roles_from_keys</span><span class="p">(</span><span class="n">user_role_keys</span><span class="p">))</span>

        <span class="c1"># apply AUTH_USER_REGISTRATION_ROLE</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_user_registration</span><span class="p">:</span>
            <span class="n">registration_role_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_user_registration_role</span>

            <span class="c1"># if AUTH_USER_REGISTRATION_ROLE_JMESPATH is set,</span>
            <span class="c1"># use it for the registration role</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auth_user_registration_role_jmespath</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">jmespath</span>

                <span class="n">registration_role_name</span> <span class="o">=</span> <span class="n">jmespath</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">auth_user_registration_role_jmespath</span><span class="p">,</span> <span class="n">userinfo</span><span class="p">)</span>

            <span class="c1"># lookup registration role in flask db</span>
            <span class="n">fab_role</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_role</span><span class="p">(</span><span class="n">registration_role_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fab_role</span><span class="p">:</span>
                <span class="n">user_role_objects</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">fab_role</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Can&#39;t find AUTH_USER_REGISTRATION role: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">registration_role_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">user_role_objects</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_user_permission_resources</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="n">User</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">action_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">resource_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get resource names with a certain action name that a user has access to.</span>

<span class="sd">        Mainly used to fetch all menu permissions on a single db call, will also</span>
<span class="sd">        check public permissions and builtin roles</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">resource_names</span><span class="p">:</span>
            <span class="n">resource_names</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">db_role_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># include public role</span>
            <span class="n">roles</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_public_role</span><span class="p">()]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">roles</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">roles</span>
        <span class="c1"># First check against builtin (statically configured) roles</span>
        <span class="c1"># because no database query is needed</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">role</span> <span class="ow">in</span> <span class="n">roles</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">role</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">builtin_roles</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">resource_name</span> <span class="ow">in</span> <span class="n">resource_names</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_access_builtin_roles</span><span class="p">(</span><span class="n">role</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">):</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">resource_name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">db_role_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">role</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="c1"># Then check against database-stored roles</span>
        <span class="n">role_resource_names</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">perm</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">perm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter_roles_by_perm_with_action</span><span class="p">(</span><span class="n">action_name</span><span class="p">,</span> <span class="n">db_role_ids</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">role_resource_names</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_has_access_builtin_roles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">role</span><span class="p">,</span> <span class="n">action_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check permission on builtin role.&quot;&quot;&quot;</span>
        <span class="n">perms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">builtin_roles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">role</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">_resource_name</span><span class="p">,</span> <span class="n">_action_name</span> <span class="ow">in</span> <span class="n">perms</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">re2</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">_resource_name</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">)</span> <span class="ow">and</span> <span class="n">re2</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">_action_name</span><span class="p">,</span> <span class="n">action_name</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_merge_perm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add the new (action, resource) to assoc_permission_role if it doesn&#39;t exist.</span>

<span class="sd">        It will add the related entry to ab_permission and ab_resource two meta tables as well.</span>

<span class="sd">        :param action_name: Name of the action</span>
<span class="sd">        :param resource_name: Name of the resource</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_action</span><span class="p">(</span><span class="n">action_name</span><span class="p">)</span>
        <span class="n">resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource</span><span class="p">(</span><span class="n">resource_name</span><span class="p">)</span>
        <span class="n">perm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">action</span> <span class="ow">and</span> <span class="n">resource</span><span class="p">:</span>
            <span class="n">perm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span>
                <span class="n">select</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">permission_model</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">,</span> <span class="n">resource</span><span class="o">=</span><span class="n">resource</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">perm</span> <span class="ow">and</span> <span class="n">action_name</span> <span class="ow">and</span> <span class="n">resource_name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_permission</span><span class="p">(</span><span class="n">action_name</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_all_roles_with_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Role</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a dict with a key of role name and value of role with early loaded permissions.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="n">r</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">r</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">scalars</span><span class="p">(</span>
                <span class="n">select</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">role_model</span><span class="p">)</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">joinedload</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">role_model</span><span class="o">.</span><span class="n">permissions</span><span class="p">))</span>
            <span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_get_all_non_dag_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">Permission</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get permissions except those that are for specific DAGs.</span>

<span class="sd">        Return a dict with a key of (action_name, resource_name) and value of permission</span>
<span class="sd">        with all permissions except those that are for specific DAGs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="p">(</span><span class="n">action_name</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">):</span> <span class="n">viewmodel</span>
            <span class="k">for</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">resource_name</span><span class="p">,</span> <span class="n">viewmodel</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                    <span class="n">select</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action_model</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resource_model</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">permission_model</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">permission_model</span><span class="o">.</span><span class="n">action</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">permission_model</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">resource_model</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">permissions</span><span class="o">.</span><span class="n">RESOURCE_DAG_PREFIX</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">))</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">}</span>

<div class="viewcode-block" id="FabAirflowSecurityManagerOverride.filter_roles_by_perm_with_action"><a class="viewcode-back" href="../../../../../../_api/airflow/providers/fab/auth_manager/security_manager/override/index.html#airflow.providers.fab.auth_manager.security_manager.override.FabAirflowSecurityManagerOverride.filter_roles_by_perm_with_action">[docs]</a>    <span class="k">def</span> <span class="nf">filter_roles_by_perm_with_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">role_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find roles with permission.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">permission_model</span><span class="p">)</span>
            <span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">assoc_permission_role</span><span class="p">,</span>
                <span class="n">and_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">permission_model</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">assoc_permission_role</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">permission_view_id</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">role_model</span><span class="p">)</span>
            <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action_model</span><span class="p">)</span>
            <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resource_model</span><span class="p">)</span>
            <span class="o">.</span><span class="n">filter</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">action_model</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">action_name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">role_model</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">in_</span><span class="p">(</span><span class="n">role_ids</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_get_root_dag_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dag_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># TODO: The &quot;root_dag_id&quot; check can be remove when the minimum version of Airflow is bumped to 3.0</span>
        <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">dag_id</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">DagModel</span><span class="p">,</span> <span class="s2">&quot;root_dag_id&quot;</span><span class="p">):</span>
            <span class="n">dm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">appbuilder</span><span class="o">.</span><span class="n">get_session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="n">select</span><span class="p">(</span><span class="n">DagModel</span><span class="o">.</span><span class="n">dag_id</span><span class="p">,</span> <span class="n">DagModel</span><span class="o">.</span><span class="n">root_dag_id</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">DagModel</span><span class="o">.</span><span class="n">dag_id</span> <span class="o">==</span> <span class="n">dag_id</span><span class="p">)</span>
            <span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">dm</span><span class="o">.</span><span class="n">root_dag_id</span> <span class="ow">or</span> <span class="n">dm</span><span class="o">.</span><span class="n">dag_id</span>
        <span class="k">return</span> <span class="n">dag_id</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_cli_safe_flash</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">level</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Show a flash in a web context or prints a message if not.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">has_request_context</span><span class="p">():</span>
            <span class="n">flash</span><span class="p">(</span><span class="n">Markup</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">level</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">level</span><span class="p">)(</span><span class="n">text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;b&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;/b&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">))</span></div>
</pre></div>

    <div class="pager" role="navigation" aria-label="related navigation"><button class="btn-hollow btn-blue bodytext__medium--cerulean-blue" disabled>Previous</button><button class="btn-hollow btn-blue bodytext__medium--cerulean-blue" disabled>Next</button>
    </div>
                                    </div>

                                </div>
                            </div>
                    </div>
                </div>
    <div class="rating-container">
        <p class="bodytext__medium--greyish-brown font-weight-500">Was this entry helpful?</p>
        <div class="rating">

            <div id="rate-star-5" class="rate-star">
                <svg xmlns="http://www.w3.org/2000/svg" width="21.05" height="20.02" viewBox="0 0 21.05 20.02">
                    <g id="Group_806" data-name="Group 806" transform="translate(-774.404 -13.178)">
                        <path id="Path_715" d="M791.434 33.2l-6.5-3.42-6.5 3.42 1.242-7.243-5.262-5.13 7.273-1.057 3.252-6.59 3.252 6.59 7.273 1.057-5.262 5.13z" fill="#017cee" data-name="Path 715"></path>
                    </g>
                </svg>

            </div>

            <div id="rate-star-4" class="rate-star">
                <svg xmlns="http://www.w3.org/2000/svg" width="21.05" height="20.02" viewBox="0 0 21.05 20.02">
                    <g id="Group_806" data-name="Group 806" transform="translate(-774.404 -13.178)">
                        <path id="Path_715" d="M791.434 33.2l-6.5-3.42-6.5 3.42 1.242-7.243-5.262-5.13 7.273-1.057 3.252-6.59 3.252 6.59 7.273 1.057-5.262 5.13z" fill="#017cee" data-name="Path 715"></path>
                    </g>
                </svg>

            </div>

            <div id="rate-star-3" class="rate-star">
                <svg xmlns="http://www.w3.org/2000/svg" width="21.05" height="20.02" viewBox="0 0 21.05 20.02">
                    <g id="Group_806" data-name="Group 806" transform="translate(-774.404 -13.178)">
                        <path id="Path_715" d="M791.434 33.2l-6.5-3.42-6.5 3.42 1.242-7.243-5.262-5.13 7.273-1.057 3.252-6.59 3.252 6.59 7.273 1.057-5.262 5.13z" fill="#017cee" data-name="Path 715"></path>
                    </g>
                </svg>

            </div>

            <div id="rate-star-2" class="rate-star">
                <svg xmlns="http://www.w3.org/2000/svg" width="21.05" height="20.02" viewBox="0 0 21.05 20.02">
                    <g id="Group_806" data-name="Group 806" transform="translate(-774.404 -13.178)">
                        <path id="Path_715" d="M791.434 33.2l-6.5-3.42-6.5 3.42 1.242-7.243-5.262-5.13 7.273-1.057 3.252-6.59 3.252 6.59 7.273 1.057-5.262 5.13z" fill="#017cee" data-name="Path 715"></path>
                    </g>
                </svg>

            </div>

            <div id="rate-star-1" class="rate-star">
                <svg xmlns="http://www.w3.org/2000/svg" width="21.05" height="20.02" viewBox="0 0 21.05 20.02">
                    <g id="Group_806" data-name="Group 806" transform="translate(-774.404 -13.178)">
                        <path id="Path_715" d="M791.434 33.2l-6.5-3.42-6.5 3.42 1.242-7.243-5.262-5.13 7.273-1.057 3.252-6.59 3.252 6.59 7.273 1.057-5.262 5.13z" fill="#017cee" data-name="Path 715"></path>
                    </g>
                </svg>

            </div>

        </div>
    </div>
                
            </main>
            

            
            
    <nav class="wy-nav-side-toc">
        <div class="wy-menu-vertical">
            
        </div>
    </nav>
            
        </div>
        


    







    </div>


    

<footer>
    <div class="footer-section footer-section__media-section">
        <div class="d-flex align-items-center">

            <a class="footer-section__media-section--link" target="_blank" href="https://github.com/apache/airflow">
                <svg xmlns="http://www.w3.org/2000/svg" width="46.14" height="45" viewBox="0 0 46.14 45">
                    <path id="Path_207" d="M228.962 1078.578a23.072 23.072 0 0 0-7.29 44.96c1.154.212 1.574-.5 1.574-1.112 0-.548-.02-2-.031-3.924-6.417 1.394-7.771-3.093-7.771-3.093a6.109 6.109 0 0 0-2.562-3.375c-2.095-1.431.159-1.4.159-1.4a4.846 4.846 0 0 1 3.533 2.377c2.058 3.525 5.4 2.507 6.714 1.917a4.926 4.926 0 0 1 1.464-3.084c-5.123-.582-10.508-2.562-10.508-11.4a8.919 8.919 0 0 1 2.374-6.191 8.3 8.3 0 0 1 .226-6.105s1.937-.62 6.344 2.365a21.857 21.857 0 0 1 11.551 0c4.4-2.985 6.338-2.365 6.338-2.365a8.284 8.284 0 0 1 .23 6.105 8.9 8.9 0 0 1 2.371 6.191c0 8.862-5.393 10.812-10.533 11.384a5.506 5.506 0 0 1 1.566 4.272c0 3.084-.028 5.572-.028 6.329 0 .617.415 1.334 1.586 1.109a23.073 23.073 0 0 0-7.308-44.958z" fill="#fff" fill-rule="evenodd" data-name="Path 207" transform="translate(-205.894 -1078.578)"></path>
                </svg>

            </a>

            <a class="footer-section__media-section--link" target="_blank" href="https://github.com/apache/airflow/issues">
                <svg xmlns="http://www.w3.org/2000/svg" width="45" height="45" viewBox="0 0 45 45">
                    <g id="Group_210" data-name="Group 210" transform="translate(-339.789 -1315.282)">
                        <path id="Path_218" d="M394.82 1315.282h-21.671a9.784 9.784 0 0 0 9.784 9.778h3.986v3.857a9.784 9.784 0 0 0 9.784 9.771v-21.523a1.884 1.884 0 0 0-1.883-1.883z" fill="#fff" data-name="Path 218" transform="translate(-11.914)"></path>
                        <path id="Path_219" d="M378.14 1332.072h-21.671a9.778 9.778 0 0 0 9.778 9.778h4.018v3.857a9.784 9.784 0 0 0 9.752 9.778v-21.536a1.877 1.877 0 0 0-1.877-1.877z" fill="#fff" data-name="Path 219" transform="translate(-5.957 -5.996)"></path>
                        <path id="Path_220" d="M361.46 1348.862h-21.671a9.778 9.778 0 0 0 9.778 9.778h3.992v3.857a9.778 9.778 0 0 0 9.778 9.778v-21.529a1.883 1.883 0 0 0-1.877-1.884z" fill="#fff" data-name="Path 220" transform="translate(0 -11.993)"></path>
                    </g>
                </svg>

            </a>

            <a class="footer-section__media-section--link" target="_blank" href="https://s.apache.org/airflow-slack">
                <svg xmlns="http://www.w3.org/2000/svg" width="45.073" height="45.073" viewBox="0 0 45.073 45.073">
                    <g id="Group_208" data-name="Group 208" transform="translate(-661.145 -806.287)">
                        <g id="Group_204" data-name="Group 204" transform="translate(661.145 830.01)">
                            <path id="Path_208" d="M670.634 856.859a4.744 4.744 0 1 1-4.744-4.744h4.744z" fill="#fff" data-name="Path 208" transform="translate(-661.145 -852.115)"></path>
                            <path id="Path_209" d="M684.059 856.859a4.744 4.744 0 0 1 9.489 0v11.861a4.744 4.744 0 1 1-9.489 0z" fill="#fff" data-name="Path 209" transform="translate(-672.198 -852.115)"></path>
                        </g>
                        <g id="Group_205" data-name="Group 205" transform="translate(661.145 806.287)">
                            <path id="Path_210" d="M688.8 815.776a4.744 4.744 0 1 1 4.744-4.745v4.745z" fill="#fff" data-name="Path 210" transform="translate(-672.198 -806.287)"></path>
                            <path id="Path_211" d="M677.751 829.2a4.744 4.744 0 0 1 0 9.489H665.89a4.744 4.744 0 1 1 0-9.489z" fill="#fff" data-name="Path 211" transform="translate(-661.145 -817.34)"></path>
                        </g>
                        <g id="Group_206" data-name="Group 206" transform="translate(684.868 806.287)">
                            <path id="Path_212" d="M729.887 833.945a4.744 4.744 0 1 1 4.745 4.745h-4.745z" fill="#fff" data-name="Path 212" transform="translate(-718.026 -817.34)"></path>
                            <path id="Path_213" d="M716.462 822.893a4.744 4.744 0 1 1-9.489 0v-11.862a4.744 4.744 0 0 1 9.489 0z" fill="#fff" data-name="Path 213" transform="translate(-706.973 -806.287)"></path>
                        </g>
                        <g id="Group_207" data-name="Group 207" transform="translate(684.868 830.01)">
                            <path id="Path_214" d="M711.718 875.029a4.744 4.744 0 1 1-4.745 4.744v-4.744z" fill="#fff" data-name="Path 214" transform="translate(-706.973 -863.168)"></path>
                            <path id="Path_215" d="M711.718 861.6a4.744 4.744 0 1 1 0-9.489h11.861a4.744 4.744 0 0 1 0 9.489z" fill="#fff" data-name="Path 215" transform="translate(-706.973 -852.115)"></path>
                        </g>
                    </g>
                </svg>

            </a>

            <a class="footer-section__media-section--link" target="_blank" href="https://stackoverflow.com/questions/tagged/airflow">
                <svg xmlns="http://www.w3.org/2000/svg" width="37.647" height="44.6" viewBox="0 0 37.647 44.6">
                    <g id="Group_209" data-name="Group 209" transform="translate(-645.2 -975.455)">
                        <path id="Path_216" d="M677.028 1043.1v-11.948h3.966v15.914H645.2v-15.914h3.966v11.948z" fill="#fff" data-name="Path 216" transform="translate(0 -27.014)"></path>
                        <path id="Path_217" d="M661.012 1003.008l19.467 4.069.824-3.914-19.467-4.069zm2.575-9.27l18.025 8.395 1.648-3.605-18.025-8.446zm5-8.858l15.3 12.721 2.524-3.039-15.3-12.721zm9.888-9.425l-3.193 2.369 11.845 15.965 3.193-2.369zm-17.875 36.617h19.879v-3.966H660.6z" fill="#fff" data-name="Path 217" transform="translate(-7.469)"></path>
                    </g>
                </svg>

            </a>

            <a class="footer-section__media-section--link" target="_blank" href="https://twitter.com/ApacheAirflow">
                <svg xmlns="http://www.w3.org/2000/svg" width="44.355" height="44.355" viewBox="0 0 44.355 44.355">
                    <g id="Group_211" data-name="Group 211" transform="translate(-503 -1382.2)">
                        <path id="Path_221" d="M541.811 1382.2h-33.267a5.546 5.546 0 0 0-5.544 5.544v33.266a5.547 5.547 0 0 0 5.544 5.545h33.267a5.546 5.546 0 0 0 5.544-5.545v-33.266a5.546 5.546 0 0 0-5.544-5.544zm-5.611 16.533c.011.244.011.488.011.732 0 7.507-5.722 16.178-16.179 16.178a16.173 16.173 0 0 1-8.7-2.539 10.92 10.92 0 0 0 1.353.078 11.4 11.4 0 0 0 7.064-2.44 5.685 5.685 0 0 1-5.311-3.947 5.725 5.725 0 0 0 2.561-.1 5.7 5.7 0 0 1-4.557-5.578v-.078a5.752 5.752 0 0 0 2.572.71 5.709 5.709 0 0 1-1.763-7.6 16.146 16.146 0 0 0 11.721 5.944 6.282 6.282 0 0 1-.144-1.3 5.688 5.688 0 0 1 9.836-3.892 11.3 11.3 0 0 0 3.615-1.375 5.721 5.721 0 0 1-2.506 3.149 11.538 11.538 0 0 0 3.271-.9 11.585 11.585 0 0 1-2.844 2.958z" fill="#fff" data-name="Path 221"></path>
                    </g>
                </svg>

            </a>

            <a class="footer-section__media-section--link" target="_blank" href="https://www.youtube.com/channel/UCSXwxpWZQ7XZ1WL3wqevChA">
                <svg xmlns="http://www.w3.org/2000/svg" width="49.594" height="34.941" viewBox="0 0 49.594 34.941">
                    <path id="Path_223" d="M1124.557 1230a6.232 6.232 0 0 0-4.385-4.413c-3.867-1.043-19.376-1.043-19.376-1.043s-15.508 0-19.376 1.043a6.232 6.232 0 0 0-4.385 4.413c-1.036 3.893-1.036 12.014-1.036 12.014s0 8.122 1.036 12.015a6.232 6.232 0 0 0 4.385 4.413c3.867 1.043 19.376 1.043 19.376 1.043s15.509 0 19.376-1.043a6.232 6.232 0 0 0 4.385-4.413c1.036-3.893 1.036-12.015 1.036-12.015s.001-8.123-1.036-12.014zm-28.833 19.388v-14.748l12.962 7.374z" fill="#fff" data-name="Path 223" transform="translate(-1076 -1224.542)"></path>
                </svg>

            </a>

        </div>
        

        <div class="footer-section__media-section--button-with-text">
            <span class="footer-section__media-section--text">Want to be a part of Apache Airflow?</span>
            <a href="/community">

                <button id="" class="btn-filled bodytext__medium--white ">Join community</button>

            </a>
        </div>
        

    </div>
    <div class="footer-section footer-section__policies-section">
        <div class="footer-section">
            <span> The Apache Software Foundation <script>document.write(new Date().getFullYear())</script></span>
            <div class="footer-section__policies-section--policies">

                <a href="https://www.apache.org/licenses/" class="footer-section__policies-section--policy-item">
                    <span>License</span>
                </a>

                <a href="https://www.apache.org/foundation/sponsorship.html" class="footer-section__policies-section--policy-item">
                    <span>Donate</span>
                </a>

                <a href="https://www.apache.org/foundation/thanks.html" class="footer-section__policies-section--policy-item">
                    <span>Thanks</span>
                </a>

                <a href="https://www.apache.org/security/" class="footer-section__policies-section--policy-item">
                    <span>Security</span>
                </a>
                

            </div>
        </div>
        <span class="footer-section__policies-section--disclaimer">
            Apache Airflow, Apache, Airflow, the Airflow logo, and the Apache feather logo are either registered trademarks or trademarks of The Apache Software Foundation.
            All other products or name brands are trademarks of their respective holders, including The Apache Software Foundation.
        </span>
    </div>
</footer>
    <script type="text/javascript" src="../../../../../../_static/_gen/js/docs.js"></script>
    <script type="text/javascript" id="documentation_options" data-url_root="../../../../../../" src="../../../../../../_static/documentation_options.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
        <script data-url_root="../../../../../../" id="documentation_options" src="../../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../../_static/jquery.js"></script>
        <script src="../../../../../../_static/underscore.js"></script>
        <script src="../../../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../../../_static/doctools.js"></script>
        <script src="../../../../../../_static/sphinx_highlight.js"></script>
        <script src="../../../../../../_static/clipboard.min.js"></script>
        <script src="../../../../../../_static/copybutton.js"></script>
        <script src="../../../../../../_static/js/globaltoc.js"></script>
        <script src="../../../../../../_static/design-tabs.js"></script>
</body>
</html>